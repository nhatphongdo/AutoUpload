using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Net;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Text;
using System.Text.RegularExpressions;
using System.Windows.Forms;
using AutoUpload.Shared;
using AutoUpload.Shared.Models;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using AutoUpload.Photoshop;
using System.Drawing.Imaging;
using ExcelDataReader;

namespace AutoUpload.Windows
{
    public partial class FormMain : Form
    {
        private static readonly string EmptyImage =
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAANsAAAF3CAYAAAAsKj5hAAAIWElEQVR4Xu3TQQ0AAAgDMebfNC7uVQwsabidI0AgEViyYoQAgRObJyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApGA2CJoMwTE5gcIRAJii6DNEBCbHyAQCYgtgjZDQGx+gEAkILYI2gwBsfkBApHAA6nLAXiiw6fuAAAAAElFTkSuQmCC"
            ;

        private static readonly string UpscaledEmptyImage =
                "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABEcAAAdTCAYAAAC4iVeeAAAgAElEQVR4XuzYQQEAAAgCMelf2iA3GzB8sXMECBAgQIAAAQIECBAgQIAAgbDAwtlFJ0CAAAECBAgQIECAAAECBAicccQTECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB45RogjIAACAASURBVIgfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLDsgWoQAAIABJREFUGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgAABAgQIECBAgAAB44gfIECAAAECBAgQIECAAAECBNICxpF0/cITIECAAAECBAgQIECAAAECxhE/QIAAAQIECBAgQIAAAQIECKQFjCPp+oUnQIAAAQIECBAgQIAAAQIEjCN+gAABAgQIECBAgAABAgQIEEgLGEfS9QtPgAABAgQIECBAgAABAgQIGEf8AAECBAgQIECAAAECBAgQIJAWMI6k6xeeAAECBAgQIECAAAECBAgQMI74AQIECBAgQIAAAQIECBAgQCAtYBxJ1y88AQIECBAgQIAAAQIECBAgYBzxAwQIECBAgAABAgQIECBAgEBawDiSrl94AgQIECBAgAABAgQIECBAwDjiBwgQIECAAAECBAgQIECAAIG0gHEkXb/wBAgQIECAAAECBAgQIECAgHHEDxAgQIAAAQIECBAgQIAAAQJpAeNIun7hCRAgQIAAAQIECBAgQIAAAeOIHyBAgAABAgQIECBAgAABAgTSAsaRdP3CEyBAgAABAgQIECBAgAABAsYRP0CAAAECBAgQIECAAAECBAikBYwj6fqFJ0CAAAECBAgQIECAAAECBIwjfoAAAQIECBAgQIAAAQIECBBICxhH0vULT4AAAQIECBAgQIAAAQIECBhH/AABAgQIECBAgAABAgQIECCQFjCOpOsXngABAgQIECBAgAABAgQIEDCO+AECBAgQIECAAAECBAgQIEAgLWAcSdcvPAECBAgQIECAAAECBAgQIGAc8QMECBAgQIAAAQIECBAgQIBAWsA4kq5feAIECBAgQIAAAQIECBAgQMA44gcIECBAgAABAgQIECBAgACBtIBxJF2/8AQIECBAgAABAgQIECBAgIBxxA8QIECAAAECBAgQIECAAAECaQHjSLp+4QkQIECAAAECBAgQIECAAAHjiB8gQIAAAQIECBAgQIAAAQIE0gLGkXT9whMgQIAAAQIECBAgQIAAAQLGET9AgAABAgQIECBAgAABAgQIpAWMI+n6hSdAgAABAgQIECBAgAABAgSMI36AAAECBAgQIECAAAECBAgQSAsYR9L1C0+AAAECBAgQIECAAAECBAgYR/wAAQIECBAgQIAAAQIECBAgkBYwjqTrF54AAQIECBAgQIAAAQIECBAwjvgBAgQIECBAgAABAgQIECBAIC1gHEnXLzwBAgQIECBAgAABAgQIECBgHPEDBAgQIECAAAECBAgQIECAQFrAOJKuX3gCBAgQIECAAAECBAgQIEDAOOIHCBAgQIAAAQIECBAgQIAAgbSAcSRdv/AECBAgQIAAAQIECBAgQICAccQPECBAgAABAgQIECBAgAABAmkB40i6fuEJECBAgMC3Y8cEAAAwDML8u0YIkbCsFwQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBJ03+ZAAAgAElEQVRAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgJ8WW6QAABo0SURBVAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gLiyPr9jidAgAABAgQIECBAgAABAgTEERsgQIAAAQIECBAgQIAAAQIE1gIBiJMHVGg78MQAAAAASUVORK5CYII="
            ;

        private static readonly Random random = new Random((int) DateTime.Now.Ticks);

        private DataGridViewImageColumn FrontImage;
        private DataGridViewTextBoxColumn FrontImagePath;
        private DataGridViewImageColumn BackImage;
        private DataGridViewTextBoxColumn BackImagePath;
        private DataGridViewComboBoxColumn FrontLeft;
        private DataGridViewComboBoxColumn FrontTop;
        private DataGridViewComboBoxColumn BackLeft;
        private DataGridViewComboBoxColumn BackTop;
        private DataGridViewTextBoxColumn Title;
        private TextAreaColumn Description;
        private DataGridViewComboBoxColumn SunfrogCategory;
        private DataGridViewComboBoxColumn TeespringCategory;
        private DataGridViewComboBoxColumn ViralstyleCategory;
        private MultipleComboBoxesColumn TeezilyCategory;
        private DataGridViewTextBoxColumn Keywords;
        private NumericColumn Duration;
        private DataGridViewTextBoxColumn Url;
        private DataGridViewCheckBoxColumn Private;
        private DataGridViewCheckBoxColumn AutoRestart;
        private NumericColumn Goal;
        private DataGridViewTextBoxColumn FacebookPixel;
        private DataGridViewTextBoxColumn GoogleAnalyticsId;
        private DataGridViewTextBoxColumn PlatformUploadInfo;

        private FormLoading loadingForm;
        private static readonly Size ThumbnailSize = new Size(48, 48);
        private static readonly string NewLine = char.ConvertFromUtf32(13) + char.ConvertFromUtf32(10);

        private CookieContainer sunfrogCookies;
        private CookieContainer teechipCookies;
        private CookieContainer teespringCookies;
        private CookieContainer viralstyleCookies;
        private CookieContainer teezilyCookies;

        private JArray sunfrogProducts;
        private ProductsInfo teechipProductsInfo;
        private JToken teespringProductsInfo;
        private JToken teespringBootstrap;
        private List<Color> teespringPalette;
        private JToken viralstyleProductsInfo;
        private JToken viralstylePricing;
        private List<JToken> viralstyleProducts;
        private JToken viralstyleAccount;
        private List<JToken> teezilyProducts;
        private JToken teezilyInfo;

        private List<string> sunfrogCampaigns;

        private int selectedRow = -1;
        private int completedRows;

        private JToken licenseData = null;
        private static int counter = 0;

        private List<List<string>> failedItems = new List<List<string>>();
        private DateTime? lastFailedTime;

        private List<string[]> designList = new List<string[]>();
        private List<MockupTemplate> mockupTemplates = new List<Shared.MockupTemplate>();
        private int afterDownloadMockupTemplate = 0;
        private Point selectedMockupCell;

        public FormMain()
        {
            InitializeComponent();

#if SUNFROG
            ButtonRemoveSunfrogAccount.Click += ButtonRemoveSunfrogAccount_Click;
            CheckedListBoxSunfrogProducts.ItemCheck += CheckedListBoxSunfrogProducts_ItemCheck;
            ButtonAddSunfrogAccount.Click += ButtonAddSunfrogAccount_Click;
            ButtonImportSunfrogAccounts.Click += ButtonImportSunfrogAccounts_Click;
            ComboBoxSunfrogAccounts.SelectedIndexChanged += ComboBoxSunfrogAccounts_SelectedIndexChanged;
            CheckBoxSunfrog.CheckedChanged += CheckBoxSunfrog_CheckedChanged;
            ButtonRemoveAllSunfrogAccounts.Click += ButtonRemoveAllSunfrogAccounts_Click;
#endif
#if TEESPRING
            ButtonRemoveTeespringAccount.Click += ButtonRemoveTeespringAccount_Click;
            CheckedListBoxTeespringProducts.ItemCheck += CheckedListBoxTeespringProducts_ItemCheck;
            ButtonAddTeespringAccount.Click += ButtonAddTeespringAccount_Click;
            ButtonImportTeespringAccounts.Click += ButtonImportTeespringAccounts_Click;
            ComboBoxTeespringAccounts.SelectedIndexChanged += ComboBoxTeespringAccounts_SelectedIndexChanged;
            CheckBoxTeespring.CheckedChanged += CheckBoxTeespring_CheckedChanged;
            ComboBoxTeespringRegion.SelectedIndexChanged += ComboBoxTeespringRegion_SelectedIndexChanged;
            ButtonRemoveAllTeespringAccounts.Click += ButtonRemoveAllTeespringAccounts_Click;
#endif
#if TEECHIP
            ButtonRemoveTeechipAccount.Click += ButtonRemoveTeechipAccount_Click;
            CheckedListBoxTeechipProducts.ItemCheck += CheckedListBoxTeechipProducts_ItemCheck;
            ButtonAddTeechipAccount.Click += ButtonAddTeechipAccount_Click;
            ButtonImportTeechipAccounts.Click += ButtonImportTeechipAccounts_Click;
            ComboBoxTeechipAccounts.SelectedIndexChanged += ComboBoxTeechipAccounts_SelectedIndexChanged;
            CheckBoxTeechip.CheckedChanged += CheckBoxTeechip_CheckedChanged;
            ButtonRemoveAllTeechipAccounts.Click += ButtonRemoveAllTeechipAccounts_Click;
#endif
#if VIRALSTYLE
            ButtonRemoveViralstyleAccount.Click += ButtonRemoveViralstyleAccount_Click;
            CheckedListBoxViralstyleProducts.ItemCheck += CheckedListBoxViralstyleProducts_ItemCheck;
            ButtonAddViralstyleAccount.Click += ButtonAddViralstyleAccount_Click;
            ButtonImportViralstyleAccounts.Click += ButtonImportViralstyleAccounts_Click;
            ComboBoxViralstyleAccounts.SelectedIndexChanged += ComboBoxViralstyleAccounts_SelectedIndexChanged;
            CheckBoxViralstyle.CheckedChanged += CheckBoxViralstyle_CheckedChanged;
            ButtonRemoveAllViralstyleAccounts.Click += ButtonRemoveAllViralstyleAccounts_Click;
#endif
#if TEEZILY
            ButtonRemoveTeezilyAccount.Click += ButtonRemoveTeezilyAccount_Click;
            CheckedListBoxTeezilyProducts.ItemCheck += CheckedListBoxTeezilyProducts_ItemCheck;
            ButtonAddTeezilyAccount.Click += ButtonAddTeezilyAccount_Click;
            ButtonImportTeezilyAccounts.Click += ButtonImportTeezilyAccounts_Click;
            ComboBoxTeezilyAccounts.SelectedIndexChanged += ComboBoxTeezilyAccounts_SelectedIndexChanged;
            CheckBoxTeezily.CheckedChanged += CheckBoxTeezily_CheckedChanged;
            ButtonRemoveAllTeezilyAccounts.Click += ButtonRemoveAllTeezilyAccounts_Click;
#endif
#if MOCKUP
            ButtonCreateMockups.Click += ButtonCreateMockups_Click;
            ButtonDownloadMissingTemplates.Click += ButtonDownloadMissingTemplates_Click;
            ButtonCheckTemplatesUpdate.Click += ButtonCheckTemplatesUpdate_Click;
            TextBoxSearchMockupTemplates.TextChanged += TextBoxSearchMockupTemplates_TextChanged;
            ButtonAddDesign.Click += ButtonAddDesign_Click;
            ButtonRemoveDesigns.Click += ButtonRemoveDesigns_Click;
            ButtonAddMockups.Click += ButtonAddMockups_Click;
            ButtonRemoveMockups.Click += ButtonRemoveMockups_Click;
            ButtonSaveToFolder.Click += ButtonSaveToFolder_Click;
            GridViewMockupResults.CellContentClick += GridViewMockupResults_CellContentClick;
            GridViewMockupResults.MouseMove += GridViewMockupResults_MouseMove;
            BackgroundWorkerDownloadMockupTemplates.DoWork += BackgroundWorkerDownloadMockupTemplates_DoWork;
            BackgroundWorkerDownloadMockupTemplates.ProgressChanged += BackgroundWorkerDownloadMockupTemplates_ProgressChanged;
            BackgroundWorkerDownloadMockupTemplates.RunWorkerCompleted += BackgroundWorkerDownloadMockupTemplates_RunWorkerCompleted;
            BackgroundWorkerCreateMockups.DoWork += BackgroundWorkerCreateMockups_DoWork;
            BackgroundWorkerCreateMockups.ProgressChanged += BackgroundWorkerCreateMockups_ProgressChanged;
            BackgroundWorkerCreateMockups.RunWorkerCompleted += BackgroundWorkerCreateMockups_RunWorkerCompleted;
            ButtonPreviewMockup.Click += ButtonPreviewMockup_Click;
            ButtonPreviousDesign.Click += ButtonPreviousDesign_Click;
            ButtonNextDesign.Click += ButtonNextDesign_Click;
            ToolStripMenuItemRedownloadTemplate.Click += ToolStripMenuItemRedownloadTemplate_Click;
            ToolStripMenuItemClearColor.Click += ToolStripMenuItemClearColor_Click;
            ToolStripMenuItemCopyColorToSameDesign.Click += ToolStripMenuItemCopyColorToSameDesign_Click;
            ToolStripMenuItemCopyColorToAllDesigns.Click += ToolStripMenuItemCopyColorToAllDesigns_Click;
            ButtonPostToFacebook.Click += ButtonPostToFacebook_Click;
#endif

            counter = 0;

            // Init log
            var count = 0;
            do
            {
                try
                {
                    Logger.LogStream = new FileStream($"Log-{DateTime.Now:yyyyMMdd}{(count == 0 ? "" : ("-" + count.ToString()))}.log", FileMode.Append, FileAccess.Write,
                                                      FileShare.Read);
                    break;
                }
                catch (Exception exc)
                {
                    // Cannot create log file
                    ++count;
                    if (count >= 10)
                    {
                        MessageBox.Show("Cannot create log file. Application will work without log.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                        break;
                    }
                }
            } while (true);
        }

        private void FormMain_Load(object sender, EventArgs e)
        {
            FrontImage = new DataGridViewImageColumn
                         {
                             Frozen = true,
                             HeaderText = "Front Image",
                             Name = "FrontImage",
                             Width = 128
                         };
            FrontImagePath = new DataGridViewTextBoxColumn
                             {
                                 HeaderText = "Front Image Path",
                                 Name = "FrontImagePath",
                                 ReadOnly = true,
                                 Visible = false,
                                 Width = 221
                             };
            BackImage = new DataGridViewImageColumn
                        {
                            Frozen = true,
                            HeaderText = "Back Image",
                            Name = "BackImage",
                            Width = 128
                        };
            BackImagePath = new DataGridViewTextBoxColumn
                            {
                                Frozen = true,
                                HeaderText = "Back Image Path",
                                Name = "BackImagePath",
                                ReadOnly = true,
                                Visible = false,
                                Width = 219
                            };
            FrontLeft = new DataGridViewComboBoxColumn
                        {
                            HeaderText = "Front Horizontal Align",
                            Name = "FrontLeft",
                            Width = 152,
                            Items = {"Left", "Center", "Right"}
                        };
            FrontTop = new DataGridViewComboBoxColumn
                       {
                           HeaderText = "Front Vertical Align",
                           Name = "FrontTop",
                           Width = 130,
                           Items = {"Top", "Middle", "Bottom"}
                       };
            BackLeft = new DataGridViewComboBoxColumn
                       {
                           HeaderText = "Back Horizontal Align",
                           Name = "BackLeft",
                           Width = 152,
                           Items = {"Left", "Center", "Right"}
                       };
            BackTop = new DataGridViewComboBoxColumn
                      {
                          HeaderText = "Back Vertical Align",
                          Name = "BackTop",
                          Width = 130,
                          Items = {"Top", "Middle", "Bottom"}
                      };
            Title = new DataGridViewTextBoxColumn
                    {
                        HeaderText = "Title",
                        MaxInputLength = 100,
                        Name = "Title",
                        Width = 200
                    };
            Description = new TextAreaColumn
                          {
                              HeaderText = "Description",
                              MaxInputLength = 5000,
                              Name = "Description",
                              Width = 400
                          };
            SunfrogCategory = new DataGridViewComboBoxColumn
                              {
                                  HeaderText = "Sunfrog Category",
                                  Name = "SunfrogCategory",
                                  Width = 200,
#if !SUNFROG
                                  Visible = false
#endif
                              };
            TeespringCategory = new DataGridViewComboBoxColumn
                                {
                                    HeaderText = "Teespring Category",
                                    Name = "TeespringCategory",
                                    Width = 250,
#if !TEESPRING
                                    Visible = false
#endif
                                };
            ViralstyleCategory = new DataGridViewComboBoxColumn
                                 {
                                     HeaderText = "Viralstyle Category",
                                     Name = "ViralstyleCategory",
                                     Width = 250,
#if !VIRALSTYLE
                                     Visible = false
#endif
                                 };
            TeezilyCategory = new MultipleComboBoxesColumn()
                              {
                                  HeaderText = "Teezily Category",
                                  Name = "TeezilyCategory",
                                  Width = 250,
#if !TEEZILY
                                  Visible = false
#endif
                              };
            Keywords = new DataGridViewTextBoxColumn
                       {
                           HeaderText = "Keywords",
                           Name = "Keywords",
                           Width = 200
                       };
            Duration = new NumericColumn
                       {
                           HeaderText = "Duration",
                           Name = "Duration",
                           Width = 150,
                           Minimum = 1,
                           Maximum = 30
                       };
            Url = new DataGridViewTextBoxColumn
                  {
                      HeaderText = "Url",
                      MaxInputLength = 4000,
                      Name = "Url",
                      Width = 200
                  };
            Private = new DataGridViewCheckBoxColumn
                      {
                          HeaderText = "Private",
                          Name = "Private",
                          Width = 100
                      };
            AutoRestart = new DataGridViewCheckBoxColumn
                          {
                              HeaderText = "Auto Restart",
                              Name = "AutoRestart",
                              Width = 100
                          };
            Goal = new NumericColumn
                   {
                       HeaderText = "Goal",
                       Name = "Goal",
                       Width = 150,
                       Minimum = 1,
                       Maximum = 10000
                   };
            FacebookPixel = new DataGridViewTextBoxColumn
                            {
                                HeaderText = "Facebook Pixel",
                                Name = "FacebookPixel",
                                Width = 200
                            };
            GoogleAnalyticsId = new DataGridViewTextBoxColumn
                                {
                                    HeaderText = "Google Analytics ID",
                                    Name = "GoogleAnalytics",
                                    Width = 200
                                };
            PlatformUploadInfo = new DataGridViewTextBoxColumn
                                 {
                                     Visible = false,
                                     HeaderText = "PlatformUploadInfo",
                                     Name = "PlatformUploadInfo",
                                 };

            GridViewImages.Columns.AddRange(
                                            FrontImage,
                                            FrontImagePath,
                                            BackImage,
                                            BackImagePath,
                                            FrontLeft,
                                            FrontTop,
                                            BackLeft,
                                            BackTop,
                                            Title,
                                            Description,
                                            SunfrogCategory,
                                            TeespringCategory,
                                            ViralstyleCategory,
                                            TeezilyCategory,
                                            Keywords,
                                            Duration,
                                            Url,
                                            Private,
                                            AutoRestart,
                                            Goal,
                                            FacebookPixel,
                                            GoogleAnalyticsId,
                                            PlatformUploadInfo);

#if !SUNFROG
            TabControlPlatforms.TabPages[1].Enabled = false;
#endif
#if !TEESPRING
            TabControlPlatforms.TabPages[2].Enabled = false;
#endif
#if !TEECHIP
            TabControlPlatforms.TabPages[3].Enabled = false;
#endif
#if !VIRALSTYLE
            TabControlPlatforms.TabPages[4].Enabled = false;
#endif
#if !TEEZILY
            TabControlPlatforms.TabPages[5].Enabled = false;
#endif
#if !GEARBUBBLE
            //TabControlPlatforms.TabPages[6].Enabled = false;
#endif
#if !MOCKUP
            MainTabControl.TabPages[1].Enabled = false;
            ButtonCreateMockups.Enabled = false;
#endif

            try
            {
                licenseData = JsonConvert.DeserializeObject<JToken>(License.DecodeChunk(License.Chunk, License.Key, License.IV));
                if (!licenseData["code"].ToObject<string>().Equals(License.Code, StringComparison.Ordinal))
                {
                    licenseData = null;
                }
            }
            catch (Exception exc)
            {
                licenseData = null;
            }

            if (licenseData == null)
            {
                MessageBox.Show("Your license is invalid. Application will quit immediately.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                Close();
                return;
            }

            if (licenseData["sunfrog"] == null)
            {
                TabControlPlatforms.TabPages[1].Enabled = false;
                SunfrogCategory.Visible = false;
            }
            if (licenseData["teespring"] == null)
            {
                TabControlPlatforms.TabPages[2].Enabled = false;
                TeespringCategory.Visible = false;
            }
            if (licenseData["teechip"] == null)
            {
                TabControlPlatforms.TabPages[3].Enabled = false;
            }
            if (licenseData["viralstyle"] == null)
            {
                TabControlPlatforms.TabPages[4].Enabled = false;
                ViralstyleCategory.Visible = false;
            }
            if (licenseData["teezily"] == null)
            {
                TabControlPlatforms.TabPages[5].Enabled = false;
                TeezilyCategory.Visible = false;
            }

            if (licenseData["mockup"] == null)
            {
                MainTabControl.TabPages[1].Enabled = false;
                ButtonCreateMockups.Enabled = false;
            }

            ToolStripStatusLabelExpiredTime.Text = $"Your current license will be expired on {License.ExpiredTime:dd/MM/yyyy HH:mm:ss}";
            if (licenseData["is_trial"].ToObject<bool>() == true)
            {
                ToolStripStatusLabelExpiredTime.Text += " - Trial mode";
            }
            ToolStripStatusLabelVersion.Text = Assembly.GetExecutingAssembly().GetName().Version.ToString(3);
        }

        private void FormMain_FormClosed(object sender, FormClosedEventArgs e)
        {
            if (Logger.LogStream != null)
            {
                Logger.LogStream.Close();
            }
            Application.Exit();
        }

        #region Common events

        private void FormMain_Shown(object sender, EventArgs e)
        {
            Cursor = Cursors.WaitCursor;
            Enabled = false;
            loadingForm = new FormLoading();
            BackgroundWorkerInit.RunWorkerAsync();
#if SUNFROG
            if (licenseData?["sunfrog"] != null)
            {
                InitSunfrog();
            }
#endif
#if TEECHIP
            if (licenseData?["teechip"] != null)
            {
                InitTeechip();
            }
#endif
#if TEESPRING
            if (licenseData?["teespring"] != null)
            {
                InitTeespring();
            }
#endif
#if VIRALSTYLE
            if (licenseData?["viralstyle"] != null)
            {
                InitViralstyle();
            }
#endif
#if TEEZILY
            if (licenseData?["teezily"] != null)
            {
                InitTeezily();
            }
#endif
#if MOCKUP
            if (licenseData?["mockup"] != null)
            {
                InitMockup();
            }
#endif

            Cursor = Cursors.Default;
            Enabled = true;
            if (loadingForm.InvokeRequired)
            {
                loadingForm.Invoke(new MethodInvoker(delegate { loadingForm.Hide(); }));
            }
            else
            {
                loadingForm.Hide();
            }

            if ((License.ExpiredTime - DateTime.Now).TotalDays <= 3)
            {
                MessageBox.Show(
                                $@"Your license will be expired in next {
                                        (int) (License.ExpiredTime - DateTime.Now).TotalDays
                                    } day(s). Please extend your subscription to not interrupt your work.",
                                "Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Warning);
            }

            if (!string.IsNullOrEmpty(License.Message))
            {
                MessageBox.Show(License.Message, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Information);
            }
        }

        private object[] CreateArtRow(Image frontImage, string frontPath, Image backImage, string backPath)
        {
            return new object[]
                   {
                       frontImage,
                       frontPath,
                       backImage,
                       backPath,
                       "Center",
                       "Top",
                       "Center",
                       "Top",
                       "{FILE}",
                       "{FILE}",
                       "",
                       "",
                       "",
                       "",
                       "{File}",
                       "7",
                       "{File}",
                       false,
                       false,
                       "50",
                       "",
                       ""
                   };
        }

        private List<DataGridViewRow> GetSelectedRows(DataGridViewSelectedCellCollection cells)
        {
            var rows = new List<DataGridViewRow>();
            foreach (DataGridViewCell cell in cells)
            {
                if (!rows.Contains(cell.OwningRow))
                {
                    rows.Add(cell.OwningRow);
                }
            }

            return rows.OrderBy(x => x.Index).ToList();
        }

        private void ButtonAddImages_Click(object sender, EventArgs e)
        {
            if (OpenFileDialogImages.ShowDialog() == DialogResult.OK)
            {
                foreach (var file in OpenFileDialogImages.FileNames)
                {
                    var index = GridViewImages.Rows.Add(CreateArtRow(PhotoshopHelper.CreateThumbnail(file, ThumbnailSize.Width, ThumbnailSize.Height), file, null, ""));
                    GridViewImages.Rows[index].ContextMenuStrip = ContextMenuStripImagesView;
                    GridViewImages.Rows[index].HeaderCell.Value = string.Format("{0}", index + 1);
                }

                GridViewImages.ClearSelection();
                selectedRow = -1;
            }
        }

        private void ButtonAddBackImages_Click(object sender, EventArgs e)
        {
            if (OpenFileDialogImages.ShowDialog() == DialogResult.OK)
            {
                foreach (var file in OpenFileDialogImages.FileNames)
                {
                    var index = GridViewImages.Rows.Add(CreateArtRow(null, "", PhotoshopHelper.CreateThumbnail(file, ThumbnailSize.Width, ThumbnailSize.Height), file));
                    GridViewImages.Rows[index].ContextMenuStrip = ContextMenuStripImagesView;
                    GridViewImages.Rows[index].HeaderCell.Value = string.Format("{0}", index + 1);
                }

                GridViewImages.ClearSelection();
                selectedRow = -1;
            }
        }

        private void ButtonUpdateFrontImages_Click(object sender, EventArgs e)
        {
            var selectedRows = GetSelectedRows(GridViewImages.SelectedCells);
            if (selectedRows.Count == 0)
            {
                MessageBox.Show("Please select files to update front images.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (OpenFileDialogImages.ShowDialog() == DialogResult.OK)
            {
                for (var i = 0; i < selectedRows.Count; i++)
                {
                    var file = i >= OpenFileDialogImages.FileNames.Length
                                   ? OpenFileDialogImages.FileNames[OpenFileDialogImages.FileNames.Length - 1]
                                   : OpenFileDialogImages.FileNames[i];

                    selectedRows[i].Cells["FrontImage"].Value = PhotoshopHelper.CreateThumbnail(file, ThumbnailSize.Width, ThumbnailSize.Height);
                    selectedRows[i].Cells["FrontImagePath"].Value = file;
                }

                GridViewImages.ClearSelection();
                selectedRow = -1;
            }
        }

        private void ButtonUpdateBackImages_Click(object sender, EventArgs e)
        {
            var selectedRows = GetSelectedRows(GridViewImages.SelectedCells);
            if (selectedRows.Count == 0)
            {
                MessageBox.Show("Please select files to update back images.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            if (OpenFileDialogImages.ShowDialog() == DialogResult.OK)
            {
                for (var i = 0; i < selectedRows.Count; i++)
                {
                    var file = i >= OpenFileDialogImages.FileNames.Length
                                   ? OpenFileDialogImages.FileNames[OpenFileDialogImages.FileNames.Length - 1]
                                   : OpenFileDialogImages.FileNames[i];

                    selectedRows[i].Cells["BackImage"].Value = PhotoshopHelper.CreateThumbnail(file, ThumbnailSize.Width, ThumbnailSize.Height);
                    selectedRows[i].Cells["BackImagePath"].Value = file;
                }

                GridViewImages.ClearSelection();
                selectedRow = -1;
            }
        }

        private void ButtonRemoveImages_Click(object sender, EventArgs e)
        {
            var selectedRows = GetSelectedRows(GridViewImages.SelectedCells);
            if (MessageBox.Show(
                                $"Do you really want to remove these {selectedRows.Count} files",
                                "Auto Upload",
                                MessageBoxButtons.YesNo,
                                MessageBoxIcon.Warning) == DialogResult.Yes)
            {
                foreach (var row in selectedRows)
                {
                    GridViewImages.Rows.Remove(row);
                }
            }
        }

        private void UpdateFrontImageMenu_Click(object sender, EventArgs e)
        {
            ButtonUpdateFrontImages.PerformClick();
        }

        private void UpdateBackImageMenu_Click(object sender, EventArgs e)
        {
            ButtonUpdateBackImages.PerformClick();
        }

        private void RemoveFrontImageMenu_Click(object sender, EventArgs e)
        {
            var selectedRows = GetSelectedRows(GridViewImages.SelectedCells);
            if (selectedRows.Count == 0)
            {
                MessageBox.Show("Please select rows to remove front images.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            foreach (var row in selectedRows)
            {
                row.Cells["FrontImage"].Value = null;
                row.Cells["FrontImagePath"].Value = "";
            }

            GridViewImages.ClearSelection();
            selectedRow = -1;
        }

        private void RemoveBackImageMenu_Click(object sender, EventArgs e)
        {
            var selectedRows = GetSelectedRows(GridViewImages.SelectedCells);
            if (selectedRows.Count == 0)
            {
                MessageBox.Show("Please select rows to remove back images.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            foreach (var row in selectedRows)
            {
                row.Cells["BackImage"].Value = null;
                row.Cells["BackImagePath"].Value = "";
            }

            GridViewImages.ClearSelection();
            selectedRow = -1;
        }

        private void GridViewImages_CellStateChanged(object sender, DataGridViewCellStateChangedEventArgs e)
        {
            if (e.StateChanged != DataGridViewElementStates.Selected || e.Cell == null)
            {
                return;
            }

            Image artImage = null;
            Image backArtImage = null;
            if (!string.IsNullOrEmpty(e.Cell.OwningRow.Cells["FrontImagePath"].Value as string))
            {
                try
                {
                    artImage = Image.FromStream(new MemoryStream(File.ReadAllBytes((string) e.Cell.OwningRow.Cells["FrontImagePath"].Value)));
                }
                catch (Exception ex)
                {
                }
            }
            if (!string.IsNullOrEmpty(e.Cell.OwningRow.Cells["BackImagePath"].Value as string))
            {
                try
                {
                    backArtImage = Image.FromStream(new MemoryStream(File.ReadAllBytes((string) e.Cell.OwningRow.Cells["BackImagePath"].Value)));
                }
                catch (Exception)
                {
                }
            }

#if SUNFROG
            foreach (var control in FlowLayoutSunfrog.Controls)
            {
                var sunfrogControl = control as SunfrogProduct;
                if (sunfrogControl != null)
                {
                    sunfrogControl.ArtImage?.Dispose();
                    sunfrogControl.BackArtImage?.Dispose();

                    var diff = sunfrogControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                               sunfrogControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                               sunfrogControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                               sunfrogControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                               e.Cell.OwningRow.Index != selectedRow;
                    sunfrogControl.ArtImage = artImage;
                    sunfrogControl.BackArtImage = backArtImage;
                    sunfrogControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                    sunfrogControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                    sunfrogControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                    sunfrogControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                    sunfrogControl.ReloadSample(diff);
                }
            }
#endif
#if TEECHIP
            foreach (var control in FlowLayoutTeechip.Controls)
            {
                var teechipControl = control as TeechipProduct;
                if (teechipControl != null)
                {
                    teechipControl.ArtImage?.Dispose();
                    teechipControl.BackArtImage?.Dispose();

                    var diff = teechipControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                               teechipControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                               teechipControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                               teechipControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                               e.Cell.OwningRow.Index != selectedRow;
                    teechipControl.ArtImage = artImage;
                    teechipControl.BackArtImage = backArtImage;
                    if (!teechipControl.ProductType.Equals("garment", StringComparison.OrdinalIgnoreCase) &&
                        artImage == null)
                    {
                        teechipControl.ArtImage = backArtImage;
                    }
                    teechipControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                    teechipControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                    teechipControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                    teechipControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                    teechipControl.ReloadSample(diff);
                }
            }
#endif
#if TEESPRING
            foreach (var control in FlowLayoutTeespring.Controls)
            {
                var teespringControl = control as TeespringProduct;
                if (teespringControl != null)
                {
                    teespringControl.ArtImage?.Dispose();
                    teespringControl.BackArtImage?.Dispose();

                    var diff = teespringControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                               teespringControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                               teespringControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                               teespringControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                               e.Cell.OwningRow.Index != selectedRow;
                    teespringControl.ArtImage = artImage;
                    teespringControl.BackArtImage = backArtImage;
                    teespringControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                    teespringControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                    teespringControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                    teespringControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                    teespringControl.ReloadSample(diff);
                }
                else
                {
                    var teespringNewControl = control as TeespringNewProduct;
                    if (teespringNewControl != null)
                    {
                        teespringNewControl.ArtImage?.Dispose();
                        teespringNewControl.BackArtImage?.Dispose();

                        var diff = teespringNewControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                                   teespringNewControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                                   teespringNewControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                                   teespringNewControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                                   e.Cell.OwningRow.Index != selectedRow;
                        teespringNewControl.ArtImage = artImage;
                        teespringNewControl.BackArtImage = backArtImage;
                        teespringNewControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                        teespringNewControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                        teespringNewControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                        teespringNewControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                        teespringNewControl.ReloadSample(diff);
                    }
                }
            }
#endif
#if VIRALSTYLE
            foreach (var control in FlowLayoutViralstyle.Controls)
            {
                var viralstyleControl = control as ViralStyleProduct;
                if (viralstyleControl != null)
                {
                    viralstyleControl.ArtImage?.Dispose();
                    viralstyleControl.BackArtImage?.Dispose();

                    var diff = viralstyleControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                               viralstyleControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                               viralstyleControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                               viralstyleControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                               e.Cell.OwningRow.Index != selectedRow;
                    viralstyleControl.ArtImage = artImage;
                    viralstyleControl.BackArtImage = backArtImage;
                    viralstyleControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                    viralstyleControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                    viralstyleControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                    viralstyleControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                    viralstyleControl.ReloadSample(diff);
                }
            }
#endif
#if TEEZILY
            foreach (var control in FlowLayoutTeezily.Controls)
            {
                var teezilyControl = control as TeezilyProduct;
                if (teezilyControl != null)
                {
                    teezilyControl.ArtImage?.Dispose();
                    teezilyControl.BackArtImage?.Dispose();

                    var diff = teezilyControl.FrontLeftAlign != (string) e.Cell.OwningRow.Cells["FrontLeft"].Value ||
                               teezilyControl.FrontTopAlign != (string) e.Cell.OwningRow.Cells["FrontTop"].Value ||
                               teezilyControl.BackLeftAlign != (string) e.Cell.OwningRow.Cells["BackLeft"].Value ||
                               teezilyControl.BackTopAlign != (string) e.Cell.OwningRow.Cells["BackTop"].Value ||
                               e.Cell.OwningRow.Index != selectedRow;
                    teezilyControl.ArtImage = artImage;
                    teezilyControl.BackArtImage = backArtImage;
                    teezilyControl.FrontLeftAlign = (string) e.Cell.OwningRow.Cells["FrontLeft"].Value;
                    teezilyControl.FrontTopAlign = (string) e.Cell.OwningRow.Cells["FrontTop"].Value;
                    teezilyControl.BackLeftAlign = (string) e.Cell.OwningRow.Cells["BackLeft"].Value;
                    teezilyControl.BackTopAlign = (string) e.Cell.OwningRow.Cells["BackTop"].Value;
                    teezilyControl.ReloadSample(diff);
                }
            }
#endif

            selectedRow = e.Cell.OwningRow.Index;
        }

        private void TextBoxLinks_LinkClicked(object sender, LinkClickedEventArgs e)
        {
            Process.Start(e.LinkText);
        }

        private void BackgroundWorkerInit_DoWork(object sender, DoWorkEventArgs e)
        {
            if (loadingForm.InvokeRequired)
            {
                loadingForm.Invoke(new MethodInvoker(delegate { loadingForm.ShowDialog(); }));
            }
            else
            {
                loadingForm.ShowDialog();
            }
        }

        private void ButtonStartUploading_Click(object sender, EventArgs e)
        {
            // Run license checking
            LicenseTimer_Tick(LicenseTimer, new EventArgs());

            lastFailedTime = null;
            failedItems.Clear();

            TextBoxLog.Clear();
            TextBoxLinks.Clear();

            ProgressBarUploading.Value = 0;
            ButtonStartUploading.Enabled = false;
            Cursor = Cursors.WaitCursor;

            // Validate data first
            foreach (DataGridViewRow imageItem in GridViewImages.Rows)
            {
                imageItem.ErrorText = "";
                foreach (DataGridViewCell cell in imageItem.Cells)
                {
                    cell.ErrorText = "";
                }

                var path = imageItem.Cells["FrontImagePath"].Value as string;
                var backPath = imageItem.Cells["BackImagePath"].Value as string;
                var frontLeftAlign = imageItem.Cells["FrontLeft"].Value as string;
                var frontTopAlign = imageItem.Cells["FrontTop"].Value as string;
                var backLeftAlign = imageItem.Cells["BackLeft"].Value as string;
                var backTopAlign = imageItem.Cells["BackTop"].Value as string;
                var title = imageItem.Cells["Title"].Value as string;
                var description = imageItem.Cells["Description"].Value as string;
                var sunfrogCategory = imageItem.Cells["SunfrogCategory"].Value as string;
                var keywords = imageItem.Cells["Keywords"].Value as string;
                var duration = imageItem.Cells["Duration"].Value as string;
                var url = imageItem.Cells["Url"].Value as string ?? "";
                url = url.Replace("{File}", Path.GetFileNameWithoutExtension(string.IsNullOrEmpty(path) ? backPath : path));
                url = url.Replace("{FILE}", Path.GetFileNameWithoutExtension(string.IsNullOrEmpty(path) ? backPath : path).ToUpper());
                url = ToSeoFriendly(url);
                var isPrivate = (bool) imageItem.Cells["Private"].Value;
                var autoRestart = (bool) imageItem.Cells["AutoRestart"].Value;
                var goalStr = imageItem.Cells["Goal"].Value as string;
                var notCheckUrl = url.Contains("{Random}") || CheckBoxAutoGeneratedUrl.Checked;

                if (string.IsNullOrEmpty(title))
                {
                    imageItem.Cells["Title"].ErrorText = "You must input Title of all campaigns.";
                    MessageBox.Show(imageItem.Cells["Title"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }

                if (string.IsNullOrEmpty(description))
                {
                    imageItem.Cells["Description"].ErrorText = "You must input Description of all campaigns.";
                    MessageBox.Show(imageItem.Cells["Description"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }

#if SUNFROG
                if (CheckBoxSunfrog.Checked && string.IsNullOrEmpty(sunfrogCategory))
                {
                    imageItem.Cells["SunfrogCategory"].ErrorText = "You must select a Category of Sunfrog campaigns.";
                    MessageBox.Show(imageItem.Cells["SunfrogCategory"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }

                if (CheckBoxSunfrog.Checked && string.IsNullOrEmpty(keywords))
                {
                    imageItem.Cells["Keywords"].ErrorText = "You must input at least 1 keyword tag of all campaigns.";
                    MessageBox.Show(imageItem.Cells["Keywords"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }
#endif

#if TEECHIP
                if (CheckBoxTeechip.Checked && !string.IsNullOrEmpty(duration))
                {
                    var number = 0;
                    if (!int.TryParse(duration, out number) || number < 1 || number > 25)
                    {
                        imageItem.Cells["Duration"].ErrorText = "Campaign Duration must be a number between 1 and 25.";
                        MessageBox.Show(imageItem.Cells["Duration"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        ButtonStartUploading.Enabled = true;
                        Cursor = Cursors.Default;
                        return;
                    }
                }
#endif

                if ((CheckBoxTeechip.Checked || CheckBoxTeespring.Checked || CheckBoxViralstyle.Checked) && string.IsNullOrEmpty(url))
                {
                    imageItem.Cells["Url"].ErrorText = "You must input Url campaigns.";
                    MessageBox.Show(imageItem.Cells["Url"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }

#if SUNFROG
                if (CheckBoxSunfrog.Checked && sunfrogCookies == null)
                {
                    var selectedSunfrogAccount = (KeyValuePair<string, string>?) ComboBoxSunfrogAccounts.SelectedItem ?? new KeyValuePair<string, string>();
                    string affiliateRate;
                    sunfrogCookies = Sunfrog.Login(selectedSunfrogAccount.Key, selectedSunfrogAccount.Value, out affiliateRate);
                    UpdateSunfrogProducts(affiliateRate);
                }
#endif

#if TEECHIP
                if (CheckBoxTeechip.Checked && teechipCookies == null)
                {
                    var selectedTeechipAccount = (KeyValuePair<string, string>?) ComboBoxTeechipAccounts.SelectedItem ?? new KeyValuePair<string, string>();
                    teechipCookies = Teechip.Login(selectedTeechipAccount.Key, selectedTeechipAccount.Value);
                }
                if (!notCheckUrl && teechipCookies != null && CheckBoxTeechip.Checked && !Teechip.CheckUrl(url, teechipCookies))
                {
                    imageItem.Cells["Url"].ErrorText = "The Url of Teechip campaign is already used or not valid.";
                    MessageBox.Show(imageItem.Cells["Url"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }
#endif

#if TEESPRING
                if (CheckBoxTeespring.Checked && teespringCookies == null)
                {
                    var teespringRegion = ComboBoxTeespringRegion.SelectedItem as string ?? "USA";
                    teespringCookies = new CookieContainer();
                    teespringBootstrap = Teespring.GetBootstrap(teespringCookies);
                    LoadTeespringInks();
                    var selectedTeespringAccount = (KeyValuePair<string, string>?) ComboBoxTeespringAccounts.SelectedItem ?? new KeyValuePair<string, string>();
                    teespringCookies = Teespring.Login(selectedTeespringAccount.Key, selectedTeespringAccount.Value, teespringCookies);
                    teespringProductsInfo = Teespring.GetProducts(teespringCookies, teespringRegion);
                }
                if (!notCheckUrl && teespringCookies != null && CheckBoxTeespring.Checked && !Teespring.CheckUrl(url, teespringCookies))
                {
                    imageItem.Cells["Url"].ErrorText = "The Url of Teespring campaign is already used or not valid.";
                    MessageBox.Show(imageItem.Cells["Url"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }
#endif

#if VIRALSTYLE
                if (CheckBoxViralstyle.Checked && viralstyleCookies == null)
                {
                    viralstyleCookies = new CookieContainer();
                    Viralstyle.GetProductsInfo(viralstyleCookies);
                    Viralstyle.GetPricing(viralstyleCookies);
                    var selectedViralstyleAccount = (KeyValuePair<string, string>?) ComboBoxViralstyleAccounts.SelectedItem ?? new KeyValuePair<string, string>();
                    viralstyleAccount = Viralstyle.Login(selectedViralstyleAccount.Key, selectedViralstyleAccount.Value, viralstyleCookies);
                }
                if (!notCheckUrl && viralstyleCookies != null && CheckBoxViralstyle.Checked && !Viralstyle.CheckUrl(url, viralstyleCookies))
                {
                    imageItem.Cells["Url"].ErrorText = "The Url of Viralstyle campaign is already used or not valid.";
                    MessageBox.Show(imageItem.Cells["Url"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }
#endif

#if TEEZILY
                if (CheckBoxTeezily.Checked && teezilyCookies == null)
                {
                    var selectedTeezilyAccount = (KeyValuePair<string, string>?) ComboBoxTeezilyAccounts.SelectedItem ?? new KeyValuePair<string, string>();
                    teezilyCookies = new CookieContainer();
                    var result = Teezily.Login(selectedTeezilyAccount.Key, selectedTeezilyAccount.Value, teezilyCookies);
                    if (!result)
                    {
                        teezilyCookies = null;
                    }
                }
                if (!notCheckUrl && teezilyCookies != null && CheckBoxTeezily.Checked && !Teezily.CheckUrl(url, teezilyCookies))
                {
                    imageItem.Cells["Url"].ErrorText = "The Url of Teezily campaign is already used or not valid.";
                    MessageBox.Show(imageItem.Cells["Url"].ErrorText, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                    ButtonStartUploading.Enabled = true;
                    Cursor = Cursors.Default;
                    return;
                }
#endif

                var platforms = new List<string>();
#if SUNFROG
                if (CheckBoxSunfrog.Checked)
                {
                    platforms.Add("Sunfrog");
                }
#endif
#if TEESPRING
                if (CheckBoxTeespring.Checked)
                {
                    platforms.Add("Teespring");
                }
#endif
#if TEECHIP
                if (CheckBoxTeechip.Checked)
                {
                    platforms.Add("Teechip");
                }
#endif
#if VIRALSTYLE
                if (CheckBoxViralstyle.Checked)
                {
                    platforms.Add("Viralstyle");
                }
#endif
#if TEEZILY
                if (CheckBoxTeezily.Checked)
                {
                    platforms.Add("Teezily");
                }
#endif
                failedItems.Add(platforms);
            }

            ButtonStopUploading.Enabled = true;
            ButtonCreateMockups.Enabled = false;
            BackgroundWorkerUpload.RunWorkerAsync();
        }

        private void GridViewImages_CellMouseDown(object sender, DataGridViewCellMouseEventArgs e)
        {
            if (e.RowIndex < 0 || e.ColumnIndex < 0)
            {
                return;
            }

            if (e.Button == MouseButtons.Right)
            {
                GridViewImages.Rows[e.RowIndex].Cells[e.ColumnIndex].Selected = true;
            }
        }

        private void CopyToOtherRowsMenuItem_Click(object sender, EventArgs e)
        {
            if (GridViewImages.SelectedCells.Count == 0)
            {
                MessageBox.Show("Please select cells to copy.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            var rowIndex = GridViewImages.SelectedCells[0].RowIndex;
            foreach (DataGridViewCell cell in GridViewImages.SelectedCells)
            {
                if (cell.RowIndex != rowIndex)
                {
                    continue;
                }

                var value = cell.Value;
                var colIndex = cell.ColumnIndex;

                foreach (DataGridViewRow row in GridViewImages.Rows)
                {
                    if (row.Index != rowIndex)
                    {
                        row.Cells[colIndex].Value = value;
                    }
                }
            }
        }

        private void TabControlPlatforms_Selecting(object sender, TabControlCancelEventArgs e)
        {
            if (!e.TabPage.Enabled)
            {
                e.Cancel = true;
                MessageBox.Show("Your license does not include this platform.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Warning);
            }
        }

        private void MainTabControl_Selecting(object sender, TabControlCancelEventArgs e)
        {
            if (!e.TabPage.Enabled)
            {
                e.Cancel = true;
                MessageBox.Show("Your license does not include this feature.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Warning);
            }
        }

        private void ButtonSaveToFile_Click(object sender, EventArgs e)
        {
            if (licenseData == null)
            {
                return;
            }

            if (SaveFileDialogTemplate.ShowDialog() == DialogResult.OK)
            {
                var items = new List<object[]>();
                foreach (DataGridViewRow imageItem in GridViewImages.Rows)
                {
                    var path = CheckBoxSaveDesigns.Checked ? imageItem.Cells["FrontImagePath"].Value as string : "";
                    var backPath = CheckBoxSaveDesigns.Checked ? imageItem.Cells["BackImagePath"].Value as string : "";
                    var frontLeftAlign = imageItem.Cells["FrontLeft"].Value as string;
                    var frontTopAlign = imageItem.Cells["FrontTop"].Value as string;
                    var backLeftAlign = imageItem.Cells["BackLeft"].Value as string;
                    var backTopAlign = imageItem.Cells["BackTop"].Value as string;
                    var title = imageItem.Cells["Title"].Value as string;
                    var description = imageItem.Cells["Description"].Value as string;
                    var sunfrogCategory = imageItem.Cells["SunfrogCategory"].Value as string;
                    var teespringCategory = imageItem.Cells["TeespringCategory"].Value as string;
                    var viralstyleCategory = imageItem.Cells["ViralstyleCategory"].Value as string;
                    var teezilyCategory = imageItem.Cells["TeezilyCategory"].Value as string;
                    var keywords = imageItem.Cells["Keywords"].Value as string;
                    var duration = imageItem.Cells["Duration"].Value as string;
                    var url = imageItem.Cells["Url"].Value as string;
                    var isPrivate = (bool) imageItem.Cells["Private"].Value;
                    var autoRestart = (bool) imageItem.Cells["AutoRestart"].Value;
                    var goal = imageItem.Cells["Goal"].Value as string;
                    var facebookPixel = imageItem.Cells["FacebookPixel"].Value as string;
                    var googleAnalyticsId = imageItem.Cells["GoogleAnalytics"].Value as string;
                    items.Add(
                              new object[]
                              {
                                  path,
                                  backPath,
                                  frontLeftAlign,
                                  frontTopAlign,
                                  backLeftAlign,
                                  backTopAlign,
                                  title,
                                  description,
                                  sunfrogCategory,
                                  teespringCategory,
                                  viralstyleCategory,
                                  teezilyCategory,
                                  keywords,
                                  duration,
                                  url,
                                  isPrivate,
                                  autoRestart,
                                  goal,
                                  facebookPixel,
                                  googleAnalyticsId
                              });
                }

                var shirts = new List<Dictionary<string, object>>();
#if SUNFROG
// Save Sunfrog
                if (licenseData?["sunfrog"] != null)
                {
                    foreach (var control in FlowLayoutSunfrog.Controls)
                    {
                        if (control is SunfrogProduct)
                        {
                            var sunfrogProduct = (SunfrogProduct) control;
                            shirts.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"Type", "Sunfrog"},
                                           {"ProductId", sunfrogProduct.Product["id"].ToObject<string>()},
                                           {"Colors", sunfrogProduct.SelectedColors},
                                           {"Price", sunfrogProduct.NumericUpDownPrice.Value},
                                           {"Default", sunfrogProduct.CheckBoxIsDefault.Checked}
                                       });
                        }
                    }
                }
#endif
#if TEESPRING
                // Save Teespring
                if (licenseData?["teespring"] != null)
                {
                    foreach (var control in FlowLayoutTeespring.Controls)
                    {
                        if (control is TeespringProduct)
                        {
                            var teespringProduct = (TeespringProduct) control;
                            shirts.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"Type", "Teespring"},
                                           {"ProductId", teespringProduct.Product["id"].ToObject<string>()},
                                           {"Colors", teespringProduct.SelectedColors},
                                           {"Price", teespringProduct.NumericUpDownPrice.Value},
                                           {"Default", teespringProduct.CheckBoxIsDefault.Checked}
                                       });
                        }
                    }
                }
#endif
#if TEECHIP
// Save Teechip
                if (licenseData?["teechip"] != null)
                {
                    foreach (var control in FlowLayoutTeechip.Controls)
                    {
                        if (control is TeechipProduct)
                        {
                            var teechipProduct = (TeechipProduct) control;
                            shirts.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"Type", "Teechip"},
                                           {"ProductId", teechipProduct.ProductId},
                                           {"Colors", teechipProduct.SelectedColors},
                                           {"Price", teechipProduct.NumericUpDownPrice.Value},
                                           {"Default", teechipProduct.CheckBoxIsDefault.Checked}
                                       });
                        }
                    }
                }
#endif
#if VIRALSTYLE
// Save Viralstyle
                if (licenseData?["viralstyle"] != null)
                {
                    foreach (var control in FlowLayoutViralstyle.Controls)
                    {
                        if (control is ViralStyleProduct)
                        {
                            var viralstyleProduct = (ViralStyleProduct) control;
                            shirts.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"Type", "Viralstyle"},
                                           {"ProductId", viralstyleProduct.Product["id"].ToObject<string>()},
                                           {"Colors", viralstyleProduct.SelectedColors},
                                           {"Price", viralstyleProduct.NumericUpDownPrice.Value},
                                           {"Default", viralstyleProduct.CheckBoxIsDefault.Checked}
                                       });
                        }
                    }
                }
#endif
#if TEEZILY
// Save Teezily
                if (licenseData?["teezily"] != null)
                {
                    foreach (var control in FlowLayoutTeezily.Controls)
                    {
                        if (control is TeezilyProduct)
                        {
                            var teechipProduct = (TeezilyProduct) control;
                            shirts.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"Type", "Teezily"},
                                           {"ProductId", teechipProduct.Product["id"].ToObject<string>()},
                                           {"Colors", teechipProduct.SelectedColors},
                                           {"Price", teechipProduct.NumericUpDownPrice.Value},
                                           {"Default", teechipProduct.CheckBoxIsDefault.Checked}
                                       });
                        }
                    }
                }
#endif

                var settings = new Dictionary<string, object>();
#if SUNFROG
                if (licenseData?["sunfrog"] != null)
                {
                    settings.Add("Sunfrog", CheckBoxSunfrog.Checked);
                    if (ComboBoxSunfrogAccounts.SelectedItem != null)
                    {
                        settings.Add("SunfrogAccount", ((KeyValuePair<string, string>) ComboBoxSunfrogAccounts.SelectedItem).Key);
                    }
                }
#endif
#if TEESPRING
                if (licenseData?["teespring"] != null)
                {
                    settings.Add("Teespring", CheckBoxTeespring.Checked);
                    if (ComboBoxTeespringAccounts.SelectedItem != null)
                    {
                        settings.Add("TeespringAccount", ((KeyValuePair<string, string>) ComboBoxTeespringAccounts.SelectedItem).Key);
                    }
                    settings.Add("TeespringRegion", (ComboBoxTeespringRegion.SelectedItem as string) ?? "USA");
                }
#endif
#if TEECHIP
                if (licenseData?["teechip"] != null)
                {
                    settings.Add("Teechip", CheckBoxTeechip.Checked);
                    if (ComboBoxTeechipAccounts.SelectedItem != null)
                    {
                        settings.Add("TeechipAccount", ((KeyValuePair<string, string>) ComboBoxTeechipAccounts.SelectedItem).Key);
                    }
                }
#endif
#if VIRALSTYLE
                if (licenseData?["viralstyle"] != null)
                {
                    settings.Add("Viralstyle", CheckBoxViralstyle.Checked);
                    if (ComboBoxViralstyleAccounts.SelectedItem != null)
                    {
                        settings.Add("ViralstyleAccount", ((KeyValuePair<string, string>) ComboBoxViralstyleAccounts.SelectedItem).Key);
                    }
                }
#endif
#if TEEZILY
                if (licenseData?["teezily"] != null)
                {
                    settings.Add("Teezily", CheckBoxTeezily.Checked);
                    if (ComboBoxTeezilyAccounts.SelectedItem != null)
                    {
                        settings.Add("TeezilyAccount", ((KeyValuePair<string, string>) ComboBoxTeezilyAccounts.SelectedItem).Key);
                    }
                }
#endif

                File.WriteAllText(
                                  SaveFileDialogTemplate.FileName,
                                  JsonConvert.SerializeObject(
                                                              new Dictionary<string, object>()
                                                              {
                                                                  {"Designs", items},
                                                                  {"Shirts", shirts},
                                                                  {"Settings", settings}
                                                              }));
            }
        }

        private void ButtonLoadFromFile_Click(object sender, EventArgs e)
        {
            if (licenseData == null)
            {
                return;
            }

            if (OpenFileDialogTemplate.ShowDialog() == DialogResult.OK)
            {
                var extension = Path.GetExtension(OpenFileDialogTemplate.FileName);
                if (extension != null && (extension.ToLower() == ".xls" || extension.ToLower() == ".xlsx"))
                {
                    try
                    {
                        var stream = File.Open(OpenFileDialogTemplate.FileName, FileMode.Open, FileAccess.Read);
                        DataSet result = null;
                        using (var excelReader = ExcelReaderFactory.CreateReader(stream))
                        {
                            result = excelReader.AsDataSet(new ExcelDataSetConfiguration()
                                                           {
                                                               // Gets or sets a callback to obtain configuration options for a DataTable. 
                                                               ConfigureDataTable = (tableReader) => new ExcelDataTableConfiguration()
                                                                                                     {
                                                                                                         // Gets or sets a value indicating whether to use a row from the 
                                                                                                         // data as column names.
                                                                                                         UseHeaderRow = true,

                                                                                                         // Gets or sets a callback to determine which row is the header row. 
                                                                                                         // Only called when UseHeaderRow = true.
                                                                                                         ReadHeaderRow = (rowReader) =>
                                                                                                                         {
                                                                                                                         },

                                                                                                         // Gets or sets a callback to determine whether to include the 
                                                                                                         // current row in the DataTable.
                                                                                                         FilterRow = (rowReader) =>
                                                                                                                     {
                                                                                                                         return true;
                                                                                                                     },
                                                                                                     }
                                                           });
                            excelReader.Close();
                            stream.Close();
                        }

                        if (result == null || result.Tables.Count == 0)
                        {
                            MessageBox.Show("There is no data in file.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                            return;
                        }

                        GridViewImages.Rows.Clear();
                        foreach (DataRow item in result.Tables[0].Rows)
                        {
                            var resizedFrontImage = item[0] == DBNull.Value || string.IsNullOrEmpty((string) item[0]) || !File.Exists((string) item[0])
                                                        ? null
                                                        : PhotoshopHelper.CreateThumbnail((string) item[0], ThumbnailSize.Width, ThumbnailSize.Height);

                            var resizedBackImage = item[1] == DBNull.Value || string.IsNullOrEmpty((string) item[1]) || !File.Exists((string) item[1])
                                                       ? null
                                                       : PhotoshopHelper.CreateThumbnail((string) item[1], ThumbnailSize.Width, ThumbnailSize.Height);

                            var row = CreateArtRow(resizedFrontImage, item[0] == DBNull.Value ? "" : (string) item[0], resizedBackImage,
                                                   item[1] == DBNull.Value ? "" : (string) item[1]);
                            row[4] = item[2] == DBNull.Value ? "" : (string) item[2];
                            row[5] = item[3] == DBNull.Value ? "" : (string) item[3];
                            row[6] = item[4] == DBNull.Value ? "" : (string) item[4];
                            row[7] = item[5] == DBNull.Value ? "" : (string) item[5];
                            row[8] = item[6] == DBNull.Value ? "" : (string) item[6];
                            row[9] = item[7] == DBNull.Value ? "" : (string) item[7];
                            if (item[8] != DBNull.Value)
                            {
#if SUNFROG
                                var categories = LoadSunfrogCategories();
                                foreach (var cat in categories)
                                {
                                    if (cat.Value.ToLower() == item[8].ToString().ToLower())
                                    {
                                        row[10] = cat.Key;
                                        break;
                                    }
                                }
#else
                                row[10] = "";
#endif
                            }
                            if (item.ItemArray.Length == 15)
                            {
                                row[14] = item[9] == DBNull.Value ? "" : (string) item[9];
                                row[15] = item[10] == DBNull.Value ? "7" : item[10].ToString();
                                row[16] = item[11] == DBNull.Value ? "" : (string) item[11];
                                row[17] = item[12] != DBNull.Value && (bool) item[12];
                                row[18] = item[13] != DBNull.Value && (bool) item[13];
                                row[19] = item[14] == DBNull.Value ? "50" : item[14].ToString();
                            }
                            else if (item.ItemArray.Length >= 19)
                            {
                                if (item[9] != DBNull.Value)
                                {
#if TEESPRING
                                    var categories = LoadTeespringCategories();
                                    foreach (var cat in categories)
                                    {
                                        if (cat.Value.Trim(new char[] {'-', ' '}).ToLower() == item[9].ToString().ToLower())
                                        {
                                            row[11] = cat.Key;
                                            break;
                                        }
                                    }
#else
                                    row[11] = "";
#endif
                                }
                                if (item[10] != DBNull.Value)
                                {
#if VIRALSTYLE
                                    var categories = LoadViralstyleCategories();
                                    foreach (var cat in categories)
                                    {
                                        if (cat.Value.ToLower() == item[10].ToString().ToLower())
                                        {
                                            row[12] = cat.Key;
                                            break;
                                        }
                                    }
#else
                                    row[12] = "";
#endif
                                }
                                if (item.ItemArray.Length == 19)
                                {
                                    row[14] = item[11] == DBNull.Value ? "" : (string) item[11];
                                    row[15] = item[12] == DBNull.Value ? "7" : item[12].ToString();
                                    row[16] = item[13] == DBNull.Value ? "" : (string) item[13];
                                    row[17] = item[14] != DBNull.Value && (bool) item[14];
                                    row[18] = item[15] != DBNull.Value && (bool) item[15];
                                    row[19] = item[16] == DBNull.Value ? "50" : item[16].ToString();
                                    row[20] = item[17] == DBNull.Value ? "" : (string) item[17];
                                    row[21] = item[18] == DBNull.Value ? "" : (string) item[18];
                                }
                                else if (item.ItemArray.Length == 20)
                                {
                                    if (item[11] != DBNull.Value)
                                    {
#if TEEZILY
                                        var cat = "";
                                        var categories = item[11].ToString().ToLower().Split(new char[] {';', '\n', '\r'}, StringSplitOptions.RemoveEmptyEntries);
                                        foreach (var category in TeezilyCategory.Items)
                                        {
                                            if (categories.Any(x => x == category.Value.ToLower() || category.Value.ToLower().EndsWith("> " + x)))
                                            {
                                                cat += category.Key + ";";
                                            }
                                        }
                                        cat = cat.TrimEnd(';');
                                        row[13] = cat;
#else
                                        row[13] = "";
#endif
                                    }
                                    row[14] = item[12] == DBNull.Value ? "" : (string) item[12];
                                    row[15] = item[13] == DBNull.Value ? "7" : item[13].ToString();
                                    row[16] = item[14] == DBNull.Value ? "" : (string) item[14];
                                    row[17] = item[15] != DBNull.Value && (bool) item[15];
                                    row[18] = item[16] != DBNull.Value && (bool) item[16];
                                    row[19] = item[17] == DBNull.Value ? "50" : item[17].ToString();
                                    row[20] = item[18] == DBNull.Value ? "" : item[18].ToString();
                                    row[21] = item[19] == DBNull.Value ? "" : item[19].ToString();
                                }
                            }

                            var index = GridViewImages.Rows.Add(row);
                            GridViewImages.Rows[index].ContextMenuStrip = ContextMenuStripImagesView;
                            GridViewImages.Rows[index].HeaderCell.Value = string.Format("{0}", index + 1);
                        }
                    }
                    catch (Exception exc)
                    {
                        Logger.WriteLog(exc);
                        MessageBox.Show("Load from file failed. Maybe file has wrong format or cannot be opened.", "Auto Upload", MessageBoxButtons.OK,
                                        MessageBoxIcon.Error);
                    }
                }
                else
                {
                    try
                    {
                        var content = File.ReadAllText(OpenFileDialogTemplate.FileName);
                        GridViewImages.Rows.Clear();
                        var template = JsonConvert.DeserializeObject<JToken>(content);
                        foreach (var item in template["Designs"].ToObject<JArray>())
                        {
                            var resizedFrontImage = string.IsNullOrEmpty((string) item[0]) || !File.Exists((string) item[0])
                                                        ? null
                                                        : PhotoshopHelper.CreateThumbnail((string) item[0], ThumbnailSize.Width, ThumbnailSize.Height);
                            var resizedBackImage = string.IsNullOrEmpty((string) item[1]) || !File.Exists((string) item[1])
                                                       ? null
                                                       : PhotoshopHelper.CreateThumbnail((string) item[1], ThumbnailSize.Width, ThumbnailSize.Height);

                            var row = CreateArtRow(resizedFrontImage, (string) item[0], resizedBackImage, (string) item[1]);
                            row[4] = (string) item[2];
                            row[5] = (string) item[3];
                            row[6] = (string) item[4];
                            row[7] = (string) item[5];
                            row[8] = (string) item[6];
                            row[9] = (string) item[7];
                            row[10] = (string) item[8];
                            if (item.Count() == 15)
                            {
                                row[14] = (string) item[9];
                                row[15] = (string) item[10];
                                row[16] = (string) item[11];
                                row[17] = (bool) item[12];
                                row[18] = (bool) item[13];
                                row[19] = (string) item[14];
                            }
                            else if (item.Count() == 19)
                            {
                                row[11] = (string) item[9];
                                row[12] = (string) item[10];
                                row[14] = (string) item[11];
                                row[15] = (string) item[12];
                                row[16] = (string) item[13];
                                row[17] = (bool) item[14];
                                row[18] = (bool) item[15];
                                row[19] = (string) item[16];
                                row[20] = (string) item[17];
                                row[21] = (string) item[18];
                            }
                            else if (item.Count() == 20)
                            {
                                row[11] = (string) item[9];
                                row[12] = (string) item[10];
                                row[13] = (string) item[11];
                                row[14] = (string) item[12];
                                row[15] = (string) item[13];
                                row[16] = (string) item[14];
                                row[17] = (bool) item[15];
                                row[18] = (bool) item[16];
                                row[19] = (string) item[17];
                                row[20] = (string) item[18];
                                row[21] = (string) item[19];
                            }
                            var index = GridViewImages.Rows.Add(row);
                            GridViewImages.Rows[index].ContextMenuStrip = ContextMenuStripImagesView;
                            GridViewImages.Rows[index].HeaderCell.Value = $"{index + 1}";
                        }

#if SUNFROG
                        if (licenseData?["sunfrog"] != null)
                        {
                            CheckBoxSunfrog.Checked = template["Settings"]["Sunfrog"].ToObject<bool>();
                            ComboBoxSunfrogAccounts.SelectedIndex = (ComboBoxSunfrogAccounts.DataSource as List<KeyValuePair<string, string>>)?
                                                                    .FindIndex(x => x.Key
                                                                                     .Equals(template["Settings"]["SunfrogAccount"]?.ToObject<string>(),
                                                                                             StringComparison.OrdinalIgnoreCase)) ?? -1;
                            for (var i = 0; i < CheckedListBoxSunfrogProducts.Items.Count; i++)
                            {
                                CheckedListBoxSunfrogProducts.SetItemChecked(i, false);
                            }
                        }
                        else
                        {
                            CheckBoxSunfrog.Checked = false;
                        }
#endif
#if TEESPRING
                        if (licenseData?["teespring"] != null)
                        {
                            CheckBoxTeespring.Checked = template["Settings"]["Teespring"].ToObject<bool>();
                            ComboBoxTeespringAccounts.SelectedIndex = (ComboBoxTeespringAccounts.DataSource as List<KeyValuePair<string, string>>)?
                                                                      .FindIndex(x => x.Key
                                                                                       .Equals(template["Settings"]["TeespringAccount"]?.ToObject<string>(),
                                                                                               StringComparison.OrdinalIgnoreCase)) ?? -1;
                            for (var i = 0; i < CheckedListBoxTeespringProducts.Items.Count; i++)
                            {
                                CheckedListBoxTeespringProducts.SetItemChecked(i, false);
                            }

                            ComboBoxTeespringRegion.SelectedIndex =
                                ComboBoxTeespringRegion.Items.IndexOf(template["Settings"]["TeespringRegion"]?.ToObject<string>() ?? "USA");
                        }
                        else
                        {
                            CheckBoxTeespring.Checked = false;
                        }
#endif
#if TEECHIP
                        if (licenseData?["teechip"] != null)
                        {
                            CheckBoxTeechip.Checked = template["Settings"]["Teechip"].ToObject<bool>();
                            ComboBoxTeechipAccounts.SelectedIndex = (ComboBoxTeechipAccounts.DataSource as List<KeyValuePair<string, string>>)?
                                                                    .FindIndex(x => x.Key
                                                                                     .Equals(template["Settings"]["TeechipAccount"]?.ToObject<string>(),
                                                                                             StringComparison.OrdinalIgnoreCase)) ?? -1;
                            for (var i = 0; i < CheckedListBoxTeechipProducts.Items.Count; i++)
                            {
                                CheckedListBoxTeechipProducts.SetItemChecked(i, false);
                            }
                        }
                        else
                        {
                            CheckBoxTeechip.Checked = false;
                        }
#endif
#if VIRALSTYLE
                        if (licenseData?["viralstyle"] != null)
                        {
                            CheckBoxViralstyle.Checked = template["Settings"]["Viralstyle"].ToObject<bool>();
                            ComboBoxViralstyleAccounts.SelectedIndex = (ComboBoxViralstyleAccounts.DataSource as List<KeyValuePair<string, string>>)?
                                                                       .FindIndex(x => x.Key.Equals(template["Settings"]["ViralstyleAccount"]?.ToObject<string>(),
                                                                                                    StringComparison.OrdinalIgnoreCase)) ?? -1;
                            for (var i = 0; i < CheckedListBoxViralstyleProducts.Items.Count; i++)
                            {
                                CheckedListBoxViralstyleProducts.SetItemChecked(i, false);
                            }
                        }
                        else
                        {
                            CheckBoxViralstyle.Checked = false;
                        }
#endif
#if TEEZILY
                        if (licenseData?["teezily"] != null)
                        {
                            CheckBoxTeezily.Checked = template["Settings"]["Teezily"].ToObject<bool>();
                            ComboBoxTeezilyAccounts.SelectedIndex = (ComboBoxTeezilyAccounts.DataSource as List<KeyValuePair<string, string>>)?
                                                                    .FindIndex(x => x.Key.Equals(template["Settings"]["TeezilyAccount"]?.ToObject<string>(),
                                                                                                 StringComparison.OrdinalIgnoreCase)) ?? -1;
                            for (var i = 0; i < CheckedListBoxTeezilyProducts.Items.Count; i++)
                            {
                                CheckedListBoxTeezilyProducts.SetItemChecked(i, false);
                            }
                        }
                        else
                        {
                            CheckBoxTeezily.Checked = false;
                        }
#endif

                        foreach (var shirt in template["Shirts"].ToObject<JArray>())
                        {
#if SUNFROG
                            if (shirt["Type"].ToObject<string>() == "Sunfrog" && sunfrogProducts != null && licenseData?["sunfrog"] != null)
                            {
                                foreach (var product in sunfrogProducts)
                                {
                                    if (product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                    {
                                        var index = CheckedListBoxSunfrogProducts.Items.IndexOf(product["description"].ToObject<string>());
                                        if (index >= 0)
                                        {
                                            CheckedListBoxSunfrogProducts.SetItemChecked(index, true);
                                        }
                                    }
                                }

                                foreach (var control in FlowLayoutSunfrog.Controls)
                                {
                                    if (control is SunfrogProduct)
                                    {
                                        var sunfrogProduct = (SunfrogProduct) control;
                                        if (sunfrogProduct.Product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                        {
                                            sunfrogProduct.SetSelectedColors((shirt["Colors"].ToObject<JArray>()).Select(x => (int) x).ToArray());
                                            if (shirt["Price"].ToObject<decimal>() < sunfrogProduct.NumericUpDownPrice.Minimum)
                                            {
                                                sunfrogProduct.NumericUpDownPrice.Minimum = shirt["Price"].ToObject<decimal>();
                                            }
                                            if (shirt["Price"].ToObject<decimal>() > sunfrogProduct.NumericUpDownPrice.Maximum)
                                            {
                                                sunfrogProduct.NumericUpDownPrice.Maximum = shirt["Price"].ToObject<decimal>();
                                            }
                                            sunfrogProduct.NumericUpDownPrice.Value = shirt["Price"].ToObject<decimal>();
                                            if (shirt["Default"] != null)
                                            {
                                                sunfrogProduct.CheckBoxIsDefault.Checked = shirt["Default"].ToObject<bool>();
                                            }
                                        }
                                    }
                                }
                            }
#endif
#if TEESPRING
                            if (shirt["Type"].ToObject<string>() == "Teespring" && teespringProductsInfo != null && licenseData?["teespring"] != null)
                            {
                                foreach (var product in teespringProductsInfo["products"].ToObject<JArray>())
                                {
                                    if (product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                    {
                                        var index = CheckedListBoxTeespringProducts.Items.IndexOf(product["name"].ToObject<string>());
                                        if (index >= 0)
                                        {
                                            CheckedListBoxTeespringProducts.SetItemChecked(index, true);
                                        }
                                    }
                                }

                                foreach (var control in FlowLayoutTeespring.Controls)
                                {
                                    if (control is TeespringProduct)
                                    {
                                        var teespringProduct = (TeespringProduct) control;
                                        if (teespringProduct.Product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                        {
                                            teespringProduct.SetSelectedColors(shirt["Colors"].ToObject<JArray>().Select(x => (int) x).ToArray());
                                            if (shirt["Price"].ToObject<decimal>() < teespringProduct.NumericUpDownPrice.Minimum)
                                            {
                                                teespringProduct.NumericUpDownPrice.Minimum = shirt["Price"].ToObject<decimal>();
                                            }
                                            if (shirt["Price"].ToObject<decimal>() > teespringProduct.NumericUpDownPrice.Maximum)
                                            {
                                                teespringProduct.NumericUpDownPrice.Maximum = shirt["Price"].ToObject<decimal>();
                                            }
                                            teespringProduct.NumericUpDownPrice.Value = shirt["Price"].ToObject<decimal>();
                                            if (shirt["Default"] != null)
                                            {
                                                teespringProduct.CheckBoxIsDefault.Checked = shirt["Default"].ToObject<bool>();
                                            }
                                        }
                                    }
                                }
                            }
#endif
#if TEECHIP
                            if (shirt["Type"].ToObject<string>() == "Teechip" && teechipProductsInfo != null && licenseData?["teechip"] != null)
                            {
                                foreach (var product in teechipProductsInfo.Products)
                                {
                                    if ((string) product == shirt["ProductId"].ToObject<string>())
                                    {
                                        var index = CheckedListBoxTeechipProducts.Items.IndexOf(teechipProductsInfo.GetProductName((string) product));
                                        if (index >= 0)
                                        {
                                            CheckedListBoxTeechipProducts.SetItemChecked(index, true);
                                        }
                                    }
                                }

                                foreach (var control in FlowLayoutTeechip.Controls)
                                {
                                    if (control is TeechipProduct)
                                    {
                                        var teechipProduct = (TeechipProduct) control;
                                        if (teechipProduct.ProductId == shirt["ProductId"].ToObject<string>())
                                        {
                                            teechipProduct.SetSelectedColors(shirt["Colors"].ToObject<JArray>().Select(x => (string) x).ToArray());
                                            if (shirt["Price"].ToObject<decimal>() < teechipProduct.NumericUpDownPrice.Minimum)
                                            {
                                                teechipProduct.NumericUpDownPrice.Minimum = shirt["Price"].ToObject<decimal>();
                                            }
                                            if (shirt["Price"].ToObject<decimal>() > teechipProduct.NumericUpDownPrice.Maximum)
                                            {
                                                teechipProduct.NumericUpDownPrice.Maximum = shirt["Price"].ToObject<decimal>();
                                            }
                                            teechipProduct.NumericUpDownPrice.Value = shirt["Price"].ToObject<decimal>();
                                            if (shirt["Default"] != null)
                                            {
                                                teechipProduct.CheckBoxIsDefault.Checked = shirt["Default"].ToObject<bool>();
                                            }
                                        }
                                    }
                                }
                            }
#endif
#if VIRALSTYLE
                            if (shirt["Type"].ToObject<string>() == "Viralstyle" && viralstyleProducts != null && licenseData?["viralstyle"] != null)
                            {
                                foreach (var product in viralstyleProducts)
                                {
                                    if (product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                    {
                                        var index = CheckedListBoxViralstyleProducts.Items.IndexOf(product["name"].ToObject<string>());
                                        if (index >= 0)
                                        {
                                            CheckedListBoxViralstyleProducts.SetItemChecked(index, true);
                                        }
                                    }
                                }

                                foreach (var control in FlowLayoutViralstyle.Controls)
                                {
                                    if (control is ViralStyleProduct)
                                    {
                                        var viralstyleProduct = (ViralStyleProduct) control;
                                        if (viralstyleProduct.Product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                        {
                                            viralstyleProduct.SetSelectedColors(shirt["Colors"].ToObject<JArray>().Select(x => (int) x).ToArray());
                                            if (shirt["Price"].ToObject<decimal>() < viralstyleProduct.NumericUpDownPrice.Minimum)
                                            {
                                                viralstyleProduct.NumericUpDownPrice.Minimum = shirt["Price"].ToObject<decimal>();
                                            }
                                            if (shirt["Price"].ToObject<decimal>() > viralstyleProduct.NumericUpDownPrice.Maximum)
                                            {
                                                viralstyleProduct.NumericUpDownPrice.Maximum = shirt["Price"].ToObject<decimal>();
                                            }
                                            viralstyleProduct.NumericUpDownPrice.Value = shirt["Price"].ToObject<decimal>();
                                            if (shirt["Default"] != null)
                                            {
                                                viralstyleProduct.CheckBoxIsDefault.Checked = shirt["Default"].ToObject<bool>();
                                            }
                                        }
                                    }
                                }
                            }
#endif
#if TEEZILY
                            if (shirt["Type"].ToObject<string>() == "Teezily" && teezilyProducts != null && licenseData?["teezily"] != null)
                            {
                                foreach (var product in teezilyProducts)
                                {
                                    if (product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                    {
                                        var index =
                                            CheckedListBoxTeezilyProducts
                                                .Items
                                                .IndexOf($"{product["name"].ToObject<string>()} ({product["id"].ToObject<string>()})");
                                        if (index >= 0)
                                        {
                                            CheckedListBoxTeezilyProducts.SetItemChecked(index, true);
                                        }
                                    }
                                }

                                foreach (var control in FlowLayoutTeezily.Controls)
                                {
                                    if (control is TeezilyProduct)
                                    {
                                        var teezilyProduct = (TeezilyProduct) control;
                                        if (teezilyProduct.Product["id"].ToObject<string>() == shirt["ProductId"].ToObject<string>())
                                        {
                                            teezilyProduct.SetSelectedColors(shirt["Colors"].ToObject<JArray>().Select(x => x.ToObject<string>()).ToArray());
                                            if (shirt["Price"].ToObject<decimal>() < teezilyProduct.NumericUpDownPrice.Minimum)
                                            {
                                                teezilyProduct.NumericUpDownPrice.Minimum = shirt["Price"].ToObject<decimal>();
                                            }
                                            if (shirt["Price"].ToObject<decimal>() > teezilyProduct.NumericUpDownPrice.Maximum)
                                            {
                                                teezilyProduct.NumericUpDownPrice.Maximum = shirt["Price"].ToObject<decimal>();
                                            }
                                            teezilyProduct.NumericUpDownPrice.Value = shirt["Price"].ToObject<decimal>();
                                            if (shirt["Default"] != null)
                                            {
                                                teezilyProduct.CheckBoxIsDefault.Checked = shirt["Default"].ToObject<bool>();
                                            }
                                        }
                                    }
                                }
                            }
#endif
                        }
                    }
                    catch (Exception exc)
                    {
                        Logger.WriteLog(exc);
                        MessageBox.Show("Load from template file failed. Maybe file is corrupted or cannot be opened.", "Auto Upload", MessageBoxButtons.OK,
                                        MessageBoxIcon.Error);
                    }
                }
            }
        }

        private void LicenseTimer_Tick(object sender, EventArgs e)
        {
            // Update license info
            licenseData = null;
            var error = License.CheckLicense(License.Email, License.LicenseKey);
            if (!string.IsNullOrEmpty(error))
            {
                MessageBox.Show($"{error} Application will quit immediately.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                Close();
            }

            try
            {
                licenseData = JsonConvert.DeserializeObject<JToken>(License.DecodeChunk(License.Chunk, License.Key, License.IV));
                if (!licenseData["code"].ToObject<string>().Equals(License.Code, StringComparison.Ordinal))
                {
                    licenseData = null;
                }
            }
            catch (Exception exc)
            {
                licenseData = null;
            }

            if (licenseData == null)
            {
                MessageBox.Show("Your license is invalid. Application will quit immediately", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Exclamation);
                Close();
            }

            ToolStripStatusLabelExpiredTime.Text = $"Your current license will be expired on {License.ExpiredTime:dd/MM/yyyy HH:mm:ss}";
            if (licenseData["is_trial"].ToObject<bool>() == true)
            {
                ToolStripStatusLabelExpiredTime.Text += " - Trial mode";
            }
            ToolStripStatusLabelVersion.Text = Assembly.GetExecutingAssembly().GetName().Version.ToString(3);
        }

        private void ButtonStopUploading_Click(object sender, EventArgs e)
        {
            BackgroundWorkerUpload.CancelAsync();
            ButtonStopUploading.Enabled = false;
        }

        private void ScheduleTimer_Tick(object sender, EventArgs e)
        {
            if (CheckBoxAutoStart.Checked)
            {
                if (string.IsNullOrEmpty(ComboBoxHour.SelectedItem as string) || string.IsNullOrEmpty(ComboBoxMinute.SelectedItem as string) ||
                    BackgroundWorkerUpload.IsBusy)
                {
                    return;
                }

                var now = DateTime.Now.Hour + (float) DateTime.Now.Minute / 60;
                var runTime = int.Parse(ComboBoxHour.SelectedItem as string) + float.Parse(ComboBoxMinute.SelectedItem as string) / 60;
                if (now >= runTime)
                {
                    CheckBoxAutoStart.Checked = false;
                    ButtonStartUploading.PerformClick();
                }
            }

            if (CheckBoxAutoReset.Checked && lastFailedTime != null && !BackgroundWorkerUpload.IsBusy && failedItems.Count(x => x.Count > 0) > 0)
            {
                var now = DateTime.Now;
                if (now >= lastFailedTime.Value.AddMinutes((double) NumericUpDownRerunDelay.Value))
                {
                    foreach (DataGridViewRow imageItem in GridViewImages.Rows)
                    {
                        imageItem.ErrorText = "";
                        foreach (DataGridViewCell cell in imageItem.Cells)
                        {
                            cell.ErrorText = "";
                        }
                    }

                    lastFailedTime = null;
                    ProgressBarUploading.Value = 0;
                    ButtonStartUploading.Enabled = false;
                    Cursor = Cursors.WaitCursor;
                    ButtonStopUploading.Enabled = true;
                    BackgroundWorkerUpload.RunWorkerAsync();
                }
            }
        }

        private void ButtonSaveCampaigns_Click(object sender, EventArgs e)
        {
            var savedFilter = SaveFileDialogTemplate.Filter;
            SaveFileDialogTemplate.Filter = "Text files (*.txt)|*.txt";
            // Save result to text file
            if (SaveFileDialogTemplate.ShowDialog() == DialogResult.OK)
            {
                File.AppendAllText(SaveFileDialogTemplate.FileName, TextBoxLinks.Text);

                // Update current file
                CheckBoxAutoSave.Text = $"Auto Save to selected file ({Path.GetFileName(SaveFileDialogTemplate.FileName)})";
                toolTip1.SetToolTip(CheckBoxAutoSave,
                                    $"Links will be saved automatically to file that is selected from next button. Current selected file is: {SaveFileDialogTemplate.FileName}");
                CheckBoxAutoSave.Tag = SaveFileDialogTemplate.FileName;
            }
            SaveFileDialogTemplate.Filter = savedFilter;
        }

        private void ButtonCreateTemplate_Click(object sender, EventArgs e)
        {
            var form = new FormTemplate();
            foreach (var item in SunfrogCategory.Items)
            {
                form.ComboBoxSunfrogCategory.Items.Add(item);
            }
            foreach (var item in TeespringCategory.Items)
            {
                form.ComboBoxTeespringCategory.Items.Add(item);
            }
            foreach (var item in ViralstyleCategory.Items)
            {
                form.ComboBoxViralstyleCategory.Items.Add(item);
            }

            form.ShowDialog();
        }

        private void ButtonApplyTemplate_Click(object sender, EventArgs e)
        {
            var savedFilter = OpenFileDialogTemplate.Filter;
            OpenFileDialogTemplate.Filter = "Template files (*.txt)|*.txt";
            if (OpenFileDialogTemplate.ShowDialog() == DialogResult.OK)
            {
                try
                {
                    var content = File.ReadAllText(OpenFileDialogTemplate.FileName);
                    var json = (JObject) JsonConvert.DeserializeObject(content);
                    // Apply to all lines
                    foreach (DataGridViewRow imageItem in GridViewImages.Rows)
                    {
                        imageItem.Cells["FrontLeft"].Value = json["FrontHAlign"].ToObject<string>();
                        imageItem.Cells["FrontTop"].Value = json["FrontVAlign"].ToObject<string>();
                        imageItem.Cells["BackLeft"].Value = json["BackHAlign"].ToObject<string>();
                        imageItem.Cells["BackTop"].Value = json["BackVAlign"].ToObject<string>();
                        imageItem.Cells["Title"].Value = json["Title"].ToObject<string>();
                        imageItem.Cells["Description"].Value = json["Description"].ToObject<string>();
                        if (json["SunfrogCategory"] != null && !string.IsNullOrEmpty(json["SunfrogCategory"].ToObject<string>()))
                        {
                            imageItem.Cells["SunfrogCategory"].Value = json["SunfrogCategory"].ToObject<string>();
                        }
                        if (json["TeespringCategory"] != null && !string.IsNullOrEmpty(json["TeespringCategory"].ToObject<string>()))
                        {
                            imageItem.Cells["TeespringCategory"].Value = json["TeespringCategory"].ToObject<string>();
                        }
                        if (json["ViralstyleCategory"] != null && !string.IsNullOrEmpty(json["ViralstyleCategory"].ToObject<string>()))
                        {
                            imageItem.Cells["ViralstyleCategory"].Value = json["ViralstyleCategory"].ToObject<string>();
                        }
                        if (json["TeezilyCategory"] != null && !string.IsNullOrEmpty(json["TeezilyCategory"].ToObject<string>()))
                        {
                            imageItem.Cells["TeezilyCategory"].Value = json["TeezilyCategory"].ToObject<string>();
                        }
                        imageItem.Cells["Keywords"].Value = json["Keywords"].ToObject<string>();
                        imageItem.Cells["Duration"].Value = json["Duration"].ToObject<decimal>().ToString("#######");
                        imageItem.Cells["Url"].Value = json["Url"].ToObject<string>();
                        imageItem.Cells["Private"].Value = json["IsPrivate"].ToObject<bool>();
                        imageItem.Cells["AutoRestart"].Value = json["AutoRestart"].ToObject<bool>();
                        imageItem.Cells["Goal"].Value = json["Goal"].ToObject<decimal>().ToString("#######");
                    }
                }
                catch (Exception exc)
                {
                    Logger.WriteLog(exc);
                    MessageBox.Show("There is error in reading file.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                }
            }

            OpenFileDialogTemplate.Filter = savedFilter;
        }

        private void MenuItemSettings_Click(object sender, EventArgs e)
        {
            var form = new FormSettings();
            form.ShowDialog();
        }

        private void ImportAccounts(Action<string, string> addMethod)
        {
            var savedFilter = OpenFileDialogTemplate.Filter;
            OpenFileDialogTemplate.Filter = "Excel files (*.xls, *.xlsx)|*.xls;*.xlsx";
            if (OpenFileDialogTemplate.ShowDialog() == DialogResult.OK)
            {
                try
                {
                    var stream = File.Open(OpenFileDialogTemplate.FileName, FileMode.Open, FileAccess.Read);
                    DataSet result = null;
                    using (var excelReader = ExcelReaderFactory.CreateReader(stream))
                    {
                        result = excelReader.AsDataSet(new ExcelDataSetConfiguration()
                                                       {
                                                           // Gets or sets a callback to obtain configuration options for a DataTable. 
                                                           ConfigureDataTable = (tableReader) => new ExcelDataTableConfiguration()
                                                                                                 {
                                                                                                     // Gets or sets a value indicating whether to use a row from the 
                                                                                                     // data as column names.
                                                                                                     UseHeaderRow = true,

                                                                                                     // Gets or sets a callback to determine which row is the header row. 
                                                                                                     // Only called when UseHeaderRow = true.
                                                                                                     ReadHeaderRow = (rowReader) =>
                                                                                                                     {
                                                                                                                     },

                                                                                                     // Gets or sets a callback to determine whether to include the 
                                                                                                     // current row in the DataTable.
                                                                                                     FilterRow = (rowReader) =>
                                                                                                                 {
                                                                                                                     return true;
                                                                                                                 },
                                                                                                 }
                                                       });
                        excelReader.Close();
                        stream.Close();
                    }

                    if (result == null || result.Tables.Count == 0)
                    {
                        MessageBox.Show("There is no data in file.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                        return;
                    }

                    foreach (DataRow item in result.Tables[0].Rows)
                    {
                        if (item[0] != null && item[1] != null)
                        {
                            addMethod(item[0].ToString(), item[1].ToString());
                        }
                    }
                }
                catch (Exception exc)
                {
                    Logger.WriteLog(exc);
                    MessageBox.Show("Load from file failed. Maybe file has wrong format or cannot be opened.", "Auto Upload", MessageBoxButtons.OK,
                                    MessageBoxIcon.Error);
                }
            }
            OpenFileDialogTemplate.Filter = savedFilter;
        }

        #endregion

        private string GenerateRandomNumber(int length = 0)
        {
            if (length == 0)
            {
                return random.Next().ToString();
            }

            var result = "";
            for (var i = 0; i < length; i++)
            {
                result += random.Next(0, 10);
            }

            return result;
        }

        private string ToSeoFriendly(string title, string matchText = "[A-Za-z0-9]+")
        {
            if (string.IsNullOrEmpty(title))
            {
                return "";
            }

            var match = Regex.Match(title.ToLower(), matchText);
            var result = new StringBuilder("");
            var maxLengthHit = false;
            while (match.Success && !maxLengthHit)
            {
                result.Append(match.Value + "-");
                match = match.NextMatch();
            }
            // Remove trailing '-'  
            return result.ToString().TrimEnd('-');
        }

        private string Truncate(string title, int maxLength)
        {
            if (string.IsNullOrEmpty(title))
            {
                return "";
            }

            var parts = title.Split('-');
            if (parts.Length > 1 && Regex.IsMatch(parts[parts.Length - 1], "[0-9]+"))
            {
                title = string.Join("-", parts.GetSubArray(0, parts.Length - 1));
                return title.Substring(0, Math.Min(maxLength - parts[parts.Length - 1].Length - 1, title.Length)).Trim('-') + "-" + parts[parts.Length - 1];
            }

            return title.Substring(0, Math.Min(maxLength, title.Length)).TrimEnd('-');
        }

        private void BackgroundWorkerUpload_DoWork(object sender, DoWorkEventArgs e)
        {
            var settings = new Settings();
            if (File.Exists("settings.config"))
            {
                var fileStream = new FileStream("settings.config", FileMode.Open, FileAccess.Read, FileShare.None);
                settings.Load(fileStream);
                fileStream.Close();
            }

            var sunfrogCount = 0;
            var teespringCount = 0;
            var teechipCount = 0;
            var viralstyleCount = 0;
            var teezilyCount = 0;

            var sunfrogAccountIndex = -1;
            var sunfrogAccountsCount = 0;
            if (ComboBoxSunfrogAccounts.InvokeRequired)
            {
                ComboBoxSunfrogAccounts.Invoke(
                                               new MethodInvoker(
                                                                 delegate
                                                                 {
                                                                     // Execute the following code on the GUI thread.
                                                                     sunfrogAccountIndex = ComboBoxSunfrogAccounts.SelectedIndex - 1;
                                                                     sunfrogAccountsCount = ComboBoxSunfrogAccounts.Items.Count;
                                                                 }));
            }
            else
            {
                sunfrogAccountIndex = ComboBoxSunfrogAccounts.SelectedIndex - 1;
                sunfrogAccountsCount = ComboBoxSunfrogAccounts.Items.Count;
            }

            var teespringAccountIndex = -1;
            var teespringAccountsCount = 0;
            if (ComboBoxTeespringAccounts.InvokeRequired)
            {
                ComboBoxTeespringAccounts.Invoke(
                                                 new MethodInvoker(
                                                                   delegate
                                                                   {
                                                                       // Execute the following code on the GUI thread.
                                                                       teespringAccountIndex = ComboBoxTeespringAccounts.SelectedIndex - 1;
                                                                       teespringAccountsCount = ComboBoxTeespringAccounts.Items.Count;
                                                                   }));
            }
            else
            {
                teespringAccountIndex = ComboBoxTeespringAccounts.SelectedIndex - 1;
                teespringAccountsCount = ComboBoxTeespringAccounts.Items.Count;
            }

            var teechipAccountIndex = -1;
            var teechipAccountsCount = 0;
            if (ComboBoxTeechipAccounts.InvokeRequired)
            {
                ComboBoxTeechipAccounts.Invoke(
                                               new MethodInvoker(
                                                                 delegate
                                                                 {
                                                                     // Execute the following code on the GUI thread.
                                                                     teechipAccountIndex = ComboBoxTeechipAccounts.SelectedIndex - 1;
                                                                     teechipAccountsCount = ComboBoxTeechipAccounts.Items.Count;
                                                                 }));
            }
            else
            {
                teechipAccountIndex = ComboBoxTeechipAccounts.SelectedIndex - 1;
                teechipAccountsCount = ComboBoxTeechipAccounts.Items.Count;
            }

            var viralstyleAccountIndex = -1;
            var viralstyleAccountsCount = 0;
            if (ComboBoxViralstyleAccounts.InvokeRequired)
            {
                ComboBoxViralstyleAccounts.Invoke(
                                                  new MethodInvoker(
                                                                    delegate
                                                                    {
                                                                        // Execute the following code on the GUI thread.
                                                                        viralstyleAccountIndex = ComboBoxViralstyleAccounts.SelectedIndex - 1;
                                                                        viralstyleAccountsCount = ComboBoxViralstyleAccounts.Items.Count;
                                                                    }));
            }
            else
            {
                viralstyleAccountIndex = ComboBoxViralstyleAccounts.SelectedIndex - 1;
                viralstyleAccountsCount = ComboBoxViralstyleAccounts.Items.Count;
            }

            var teezilyAccountIndex = -1;
            var teezilyAccountsCount = 0;
            if (ComboBoxTeezilyAccounts.InvokeRequired)
            {
                ComboBoxTeezilyAccounts.Invoke(
                                               new MethodInvoker(
                                                                 delegate
                                                                 {
                                                                     // Execute the following code on the GUI thread.
                                                                     teezilyAccountIndex = ComboBoxTeezilyAccounts.SelectedIndex - 1;
                                                                     teezilyAccountsCount = ComboBoxTeezilyAccounts.Items.Count;
                                                                 }));
            }
            else
            {
                teezilyAccountIndex = ComboBoxTeezilyAccounts.SelectedIndex - 1;
                teezilyAccountsCount = ComboBoxTeezilyAccounts.Items.Count;
            }

            var delayTime = 0;
            var totalItems = 0;
            var isTrial = true;
#if SUNFROG
            if (licenseData?["sunfrog"] != null && CheckBoxSunfrog.Checked)
            {
                totalItems += GridViewImages.Rows.Count;
                delayTime = Math.Max(delayTime, settings.SunfrogDelayTime);
                //if (licenseData?["delay_sunfrog"]?.ToObject<int>() != null)
                //{
                //    delayTime = Math.Max(delayTime, licenseData["delay_sunfrog"].ToObject<int>());
                //}
                isTrial = isTrial & (licenseData["sunfrog"]["isTrial"]?.ToObject<bool>() ?? false);
            }
#endif
#if TEECHIP
            if (licenseData?["teechip"] != null && CheckBoxTeechip.Checked)
            {
                totalItems += GridViewImages.Rows.Count;
                delayTime = Math.Max(delayTime, settings.TeechipDelayTime);
                //if (licenseData?["delay_teechip"]?.ToObject<int>() != null)
                //{
                //    delayTime = Math.Max(delayTime, licenseData["delay_teechip"].ToObject<int>());
                //}
                isTrial = isTrial & (licenseData["teechip"]["isTrial"]?.ToObject<bool>() ?? false);
            }
#endif
#if TEESPRING
            if (licenseData?["teespring"] != null && CheckBoxTeespring.Checked)
            {
                totalItems += GridViewImages.Rows.Count;
                delayTime = Math.Max(delayTime, settings.TeespringDelayTime);
                //if (licenseData?["delay_teespring"]?.ToObject<int>() != null)
                //{
                //    delayTime = Math.Max(delayTime, licenseData["delay_teespring"].ToObject<int>());
                //}
                isTrial = isTrial & (licenseData["teespring"]["isTrial"]?.ToObject<bool>() ?? false);
            }
#endif
#if VIRALSTYLE
            if (licenseData?["viralstyle"] != null && CheckBoxViralstyle.Checked)
            {
                totalItems += GridViewImages.Rows.Count;
                delayTime = Math.Max(delayTime, settings.ViralstyleDelayTime);
                //if (licenseData?["delay_viralstyle"]?.ToObject<int>() != null)
                //{
                //    delayTime = Math.Max(delayTime, licenseData["delay_viralstyle"].ToObject<int>());
                //}
                isTrial = isTrial & (licenseData["viralstyle"]["isTrial"]?.ToObject<bool>() ?? false);
            }
#endif
#if TEEZILY
            if (licenseData?["teezily"] != null && CheckBoxTeezily.Checked)
            {
                totalItems += GridViewImages.Rows.Count;
                delayTime = Math.Max(delayTime, settings.TeezilyDelayTime);
                //if (licenseData?["delay_teezily"]?.ToObject<int>() != null)
                //{
                //    delayTime = Math.Max(delayTime, licenseData["delay_teezily"].ToObject<int>());
                //}
                isTrial = isTrial & (licenseData["teezily"]["isTrial"]?.ToObject<bool>() ?? false);
            }
#endif

            if (totalItems == 0)
            {
                MessageBox.Show("You must add at least 1 design and choose at least 1 platform to upload.", "Auto Upload", MessageBoxButtons.OK,
                                MessageBoxIcon.Exclamation);
                return;
            }

            var items = new DataGridViewRow[GridViewImages.Rows.Count];
            if (GridViewImages.InvokeRequired)
            {
                GridViewImages.Invoke(
                                      new MethodInvoker(
                                                        delegate
                                                        {
                                                            // Execute the following code on the GUI thread.
                                                            GridViewImages.Rows.CopyTo(items, 0);
                                                        }));
            }
            else
            {
                GridViewImages.Rows.CopyTo(items, 0);
            }

            var teespringRegion = "USA";
            if (ComboBoxTeespringRegion.InvokeRequired)
            {
                ComboBoxTeespringRegion.Invoke(
                                               new MethodInvoker(
                                                                 delegate
                                                                 {
                                                                     // Execute the following code on the GUI thread.
                                                                     teespringRegion = ComboBoxTeespringRegion.SelectedItem as string ?? "USA";
                                                                 }));
            }
            else
            {
                teespringRegion = ComboBoxTeespringRegion.SelectedItem as string ?? "USA";
            }

            var teezilyCurrency = "eur";
            if (ComboBoxTeezilyCurrency.InvokeRequired)
            {
                ComboBoxTeezilyCurrency.Invoke(
                                               new MethodInvoker(
                                                                 delegate
                                                                 {
                                                                     // Execute the following code on the GUI thread.
                                                                     teezilyCurrency = (ComboBoxTeezilyCurrency.SelectedItem as string ?? "EUR").ToLower();
                                                                 }));
            }
            else
            {
                teezilyCurrency = (ComboBoxTeezilyCurrency.SelectedItem as string ?? "EUR").ToLower();
            }

            if (isTrial == true)
            {
                if (counter + items.Length > 10)
                {
                    MessageBox.Show("You are using trial version. You cannot upload more than 10 designs in 1 session.", "Auto Upload", MessageBoxButtons.OK,
                                    MessageBoxIcon.Exclamation);
                    return;
                }

                counter += items.Length;
            }

            sunfrogCampaigns = new List<string>();

            var firstTime = true;
            var failedUrl = new List<string>();
            failedUrl.Add("");
            var count = 0;
            var index = 0;
            completedRows = 0;
            foreach (var imageItem in items)
            {
                if (BackgroundWorkerUpload.CancellationPending)
                {
                    e.Cancel = true;
                    break;
                }

                var platforms = failedItems[index];
                ++index;

                try
                {
                    var path = imageItem.Cells["FrontImagePath"].Value as string;
                    var backPath = imageItem.Cells["BackImagePath"].Value as string;
                    if ((string.IsNullOrEmpty(path) && string.IsNullOrEmpty(backPath)) ||
                        (!string.IsNullOrEmpty(path) && !File.Exists(path)) ||
                        (!string.IsNullOrEmpty(backPath) && !File.Exists(backPath)))
                    {
#if SUNFROG
                        if (CheckBoxSunfrog.Checked)
                        {
                            ++count;
                        }
#endif
#if TEESPRING
                        if (CheckBoxTeespring.Checked)
                        {
                            ++count;
                        }
#endif
#if TEECHIP
                        if (CheckBoxTeechip.Checked)
                        {
                            ++count;
                        }
#endif
#if VIRALSTYLE
                        if (CheckBoxViralstyle.Checked)
                        {
                            ++count;
                        }
#endif
#if TEEZILY
                        if (CheckBoxTeezily.Checked)
                        {
                            ++count;
                        }
#endif

                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "Cannot find specific file of images.",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "",
                                                                                                                          "",
                                                                                                                          ""));
                        continue;
                    }

#if SUNFROG
                    if (licenseData?["sunfrog"] != null && CheckBoxSunfrog.Checked &&
                        (firstTime || sunfrogCookies == null ||
                         (settings.SunfrogDesignsPerAccount > 0 && sunfrogCount % settings.SunfrogDesignsPerAccount == 0) ||
                         licenseData["sunfrog"]["refreshAccount"]?.ToObject<bool>() == true))
                    {
                        if (settings.SunfrogDesignsPerAccount > 0 && sunfrogCount % settings.SunfrogDesignsPerAccount == 0)
                        {
                            // Next index
                            ++sunfrogAccountIndex;
                            if (sunfrogAccountIndex >= sunfrogAccountsCount)
                            {
                                sunfrogAccountIndex = 0;
                            }
                        }
                        else if (firstTime)
                        {
                            ++sunfrogAccountIndex;
                            if (sunfrogAccountIndex >= sunfrogAccountsCount)
                            {
                                sunfrogAccountIndex = 0;
                            }
                        }

                        if (sunfrogAccountIndex < 0)
                        {
                            sunfrogAccountIndex = 0;
                        }

                        sunfrogCookies = new CookieContainer();
                        var selectedSunfrogAccount = new KeyValuePair<string, string>();
                        if (ComboBoxSunfrogAccounts.InvokeRequired)
                        {
                            ComboBoxSunfrogAccounts.Invoke(
                                                           new MethodInvoker(
                                                                             delegate
                                                                             {
                                                                                 // Execute the following code on the GUI thread.
                                                                                 selectedSunfrogAccount =
                                                                                     (KeyValuePair<string, string>?) ComboBoxSunfrogAccounts.Items[sunfrogAccountIndex] ??
                                                                                     new KeyValuePair<string, string>();
                                                                             }));
                        }
                        else
                        {
                            selectedSunfrogAccount =
                                (KeyValuePair<string, string>?) ComboBoxSunfrogAccounts.Items[sunfrogAccountIndex] ?? new KeyValuePair<string, string>();
                        }
                        string affiliateRate;
                        sunfrogCookies = Sunfrog.Login(selectedSunfrogAccount.Key, selectedSunfrogAccount.Value, out affiliateRate);
                        UpdateSunfrogProducts(affiliateRate);
                    }
#endif
#if TEECHIP
                    if (licenseData?["teechip"] != null && CheckBoxTeechip.Checked &&
                        (firstTime || teechipCookies == null ||
                         (settings.TeechipDesignsPerAccount > 0 && teechipCount % settings.TeechipDesignsPerAccount == 0) ||
                         licenseData["teechip"]["refreshAccount"]?.ToObject<bool>() == true))
                    {
                        if (settings.TeechipDesignsPerAccount > 0 && teechipCount % settings.TeechipDesignsPerAccount == 0)
                        {
                            // Next index
                            ++teechipAccountIndex;
                            if (teechipAccountIndex >= teechipAccountsCount)
                            {
                                teechipAccountIndex = 0;
                            }
                        }
                        else if (firstTime)
                        {
                            ++teechipAccountIndex;
                            if (teechipAccountIndex >= teechipAccountsCount)
                            {
                                teechipAccountIndex = 0;
                            }
                        }

                        if (teechipAccountIndex < 0)
                        {
                            teechipAccountIndex = 0;
                        }

                        teechipCookies = new CookieContainer();
                        var selectedTeechipAccount = new KeyValuePair<string, string>();
                        if (ComboBoxTeechipAccounts.InvokeRequired)
                        {
                            ComboBoxTeechipAccounts.Invoke(
                                                           new MethodInvoker(
                                                                             delegate
                                                                             {
                                                                                 // Execute the following code on the GUI thread.
                                                                                 selectedTeechipAccount =
                                                                                     (KeyValuePair<string, string>?) ComboBoxTeechipAccounts.Items[teechipAccountIndex] ??
                                                                                     new KeyValuePair<string, string>();
                                                                             }));
                        }
                        else
                        {
                            selectedTeechipAccount =
                                (KeyValuePair<string, string>?) ComboBoxTeechipAccounts.Items[teechipAccountIndex] ?? new KeyValuePair<string, string>();
                        }
                        teechipCookies = Teechip.Login(selectedTeechipAccount.Key, selectedTeechipAccount.Value);
                    }
#endif
#if TEESPRING
                    if (licenseData?["teespring"] != null && CheckBoxTeespring.Checked &&
                        (firstTime || teespringCookies == null ||
                         (settings.TeespringDesignsPerAccount > 0 && teespringCount % settings.TeespringDesignsPerAccount == 0) ||
                         licenseData["teespring"]["refreshAccount"]?.ToObject<bool>() == true))
                    {
                        if (settings.TeespringDesignsPerAccount > 0 && teespringCount % settings.TeespringDesignsPerAccount == 0)
                        {
                            // Next index
                            ++teespringAccountIndex;
                            if (teespringAccountIndex >= teespringAccountsCount)
                            {
                                teespringAccountIndex = 0;
                            }
                        }
                        else if (firstTime)
                        {
                            ++teespringAccountIndex;
                            if (teespringAccountIndex >= teespringAccountsCount)
                            {
                                teespringAccountIndex = 0;
                            }
                        }

                        if (teespringAccountIndex < 0)
                        {
                            teespringAccountIndex = 0;
                        }

                        teespringCookies = new CookieContainer();
                        teespringBootstrap = Teespring.GetBootstrap(teespringCookies);
                        LoadTeespringInks();
                        var selectedTeespringAccount = new KeyValuePair<string, string>();
                        if (ComboBoxTeespringAccounts.InvokeRequired)
                        {
                            ComboBoxTeespringAccounts.Invoke(
                                                             new MethodInvoker(
                                                                               delegate
                                                                               {
                                                                                   // Execute the following code on the GUI thread.
                                                                                   selectedTeespringAccount =
                                                                                       (KeyValuePair<string, string>?) ComboBoxTeespringAccounts
                                                                                           .Items[teespringAccountIndex] ?? new KeyValuePair<string, string>();
                                                                               }));
                        }
                        else
                        {
                            selectedTeespringAccount =
                                (KeyValuePair<string, string>?) ComboBoxTeespringAccounts.Items[teespringAccountIndex] ?? new KeyValuePair<string, string>();
                        }
                        teespringCookies = Teespring.Login(selectedTeespringAccount.Key, selectedTeespringAccount.Value, teespringCookies);
                        teespringProductsInfo = Teespring.GetProducts(teespringCookies, teespringRegion);
                    }
#endif
#if VIRALSTYLE
                    if (licenseData?["viralstyle"] != null && CheckBoxViralstyle.Checked &&
                        (firstTime || viralstyleCookies == null ||
                         (settings.ViralstyleDesignsPerAccount > 0 && viralstyleCount % settings.ViralstyleDesignsPerAccount == 0) ||
                         licenseData["viralstyle"]["refreshAccount"]?.ToObject<bool>() == true))
                    {
                        if (settings.ViralstyleDesignsPerAccount > 0 && viralstyleCount % settings.ViralstyleDesignsPerAccount == 0)
                        {
                            // Next index
                            ++viralstyleAccountIndex;
                            if (viralstyleAccountIndex >= viralstyleAccountsCount)
                            {
                                viralstyleAccountIndex = 0;
                            }
                        }
                        else if (firstTime)
                        {
                            ++viralstyleAccountIndex;
                            if (viralstyleAccountIndex >= viralstyleAccountsCount)
                            {
                                viralstyleAccountIndex = 0;
                            }
                        }

                        if (viralstyleAccountIndex < 0)
                        {
                            viralstyleAccountIndex = 0;
                        }

                        viralstyleCookies = new CookieContainer();
                        Viralstyle.GetProductsInfo(viralstyleCookies);
                        Viralstyle.GetPricing(viralstyleCookies);
                        var selectedViralstyleAccount = new KeyValuePair<string, string>();
                        if (ComboBoxViralstyleAccounts.InvokeRequired)
                        {
                            ComboBoxViralstyleAccounts.Invoke(
                                                              new MethodInvoker(
                                                                                delegate
                                                                                {
                                                                                    // Execute the following code on the GUI thread.
                                                                                    selectedViralstyleAccount =
                                                                                        (KeyValuePair<string, string>?) ComboBoxViralstyleAccounts
                                                                                            .Items[viralstyleAccountIndex]
                                                                                        ?? new KeyValuePair<string, string>();
                                                                                }));
                        }
                        else
                        {
                            selectedViralstyleAccount =
                                (KeyValuePair<string, string>?) ComboBoxViralstyleAccounts.Items[viralstyleAccountIndex] ?? new KeyValuePair<string, string>();
                        }
                        viralstyleAccount = Viralstyle.Login(selectedViralstyleAccount.Key, selectedViralstyleAccount.Value, viralstyleCookies);
                    }
#endif
#if TEEZILY
                    if (licenseData?["teezily"] != null && CheckBoxTeezily.Checked &&
                        (firstTime || teezilyCookies == null ||
                         (settings.TeezilyDesignsPerAccount > 0 && teezilyCount % settings.TeezilyDesignsPerAccount == 0) ||
                         licenseData["teezily"]["refreshAccount"]?.ToObject<bool>() == true))
                    {
                        if (settings.TeezilyDesignsPerAccount > 0 && teezilyCount % settings.TeezilyDesignsPerAccount == 0)
                        {
                            // Next index
                            ++teezilyAccountIndex;
                            if (teezilyAccountIndex >= teezilyAccountsCount)
                            {
                                teezilyAccountIndex = 0;
                            }
                        }
                        else if (firstTime)
                        {
                            ++teezilyAccountIndex;
                            if (teezilyAccountIndex >= teezilyAccountsCount)
                            {
                                teezilyAccountIndex = 0;
                            }
                        }

                        if (teezilyAccountIndex < 0)
                        {
                            teezilyAccountIndex = 0;
                        }

                        teezilyCookies = new CookieContainer();
                        var selectedTeezilyAccount = new KeyValuePair<string, string>();
                        if (ComboBoxTeezilyAccounts.InvokeRequired)
                        {
                            ComboBoxTeezilyAccounts.Invoke(
                                                           new MethodInvoker(
                                                                             delegate
                                                                             {
                                                                                 // Execute the following code on the GUI thread.
                                                                                 selectedTeezilyAccount =
                                                                                     (KeyValuePair<string, string>?) ComboBoxTeezilyAccounts.Items[teezilyAccountIndex] ??
                                                                                     new KeyValuePair<string, string>();
                                                                             }));
                        }
                        else
                        {
                            selectedTeezilyAccount =
                                (KeyValuePair<string, string>?) ComboBoxTeezilyAccounts.Items[teezilyAccountIndex] ?? new KeyValuePair<string, string>();
                        }
                        var result = Teezily.Login(selectedTeezilyAccount.Key, selectedTeezilyAccount.Value, teezilyCookies);
                        if (!result)
                        {
                            teezilyCookies = null;
                        }
                    }
#endif
                    firstTime = false;

                    var image = string.IsNullOrEmpty(path) ? null : Image.FromStream(new MemoryStream(File.ReadAllBytes(path)));
                    var backImage = string.IsNullOrEmpty(backPath) ? null : Image.FromStream(new MemoryStream(File.ReadAllBytes(backPath)));

                    var usedPath = string.IsNullOrEmpty(path) ? backPath : path;

                    var frontLeftAlign = imageItem.Cells["FrontLeft"].Value as string;
                    var frontTopAlign = imageItem.Cells["FrontTop"].Value as string;
                    var backLeftAlign = imageItem.Cells["BackLeft"].Value as string;
                    var backTopAlign = imageItem.Cells["BackTop"].Value as string;
                    var title = (imageItem.Cells["Title"].Value as string) ?? "";
                    title = title.Replace("{File}", Path.GetFileNameWithoutExtension(usedPath));
                    title = title.Replace("{FILE}", Path.GetFileNameWithoutExtension(usedPath).ToUpper());
                    title = title.Replace("{Random}", GenerateRandomNumber());
                    var description = (imageItem.Cells["Description"].Value as string) ?? "";
                    description = description.Replace("{File}", Path.GetFileNameWithoutExtension(usedPath));
                    description = description.Replace("{FILE}", Path.GetFileNameWithoutExtension(usedPath).ToUpper());
                    description = description.Replace("{Random}", GenerateRandomNumber());
                    description = description.Replace("\n", "<br />");
                    description = description.Replace("\r", "");
                    var sunfrogCategory = (imageItem.Cells["SunfrogCategory"].Value as string) ?? "";
                    var teespringCategory = (imageItem.Cells["TeespringCategory"].Value as string) ?? "";
                    var viralstyleCategory = (imageItem.Cells["ViralstyleCategory"].Value as string) ?? "";
                    var teezilyCategory = (imageItem.Cells["TeezilyCategory"].Value as string) ?? "";
                    var keywords = (imageItem.Cells["Keywords"].Value as string) ?? "";
                    keywords = keywords.Replace("{File}", Path.GetFileNameWithoutExtension(usedPath));
                    keywords = keywords.Replace("{FILE}", Path.GetFileNameWithoutExtension(usedPath).ToUpper());
                    keywords = keywords.Replace("{Random}", GenerateRandomNumber());
                    var durationStr = (imageItem.Cells["Duration"].Value as string) ?? "1";
                    var duration = 1;
                    if (!int.TryParse(durationStr, out duration))
                    {
                        duration = 1;
                    }
                    var url = (imageItem.Cells["Url"].Value as string) ?? "";
                    url = url.Replace("{File}", Path.GetFileNameWithoutExtension(usedPath));
                    url = url.Replace("{FILE}", Path.GetFileNameWithoutExtension(usedPath).ToUpper());
                    var isPrivate = (bool) imageItem.Cells["Private"].Value;
                    var autoRestart = (bool) imageItem.Cells["AutoRestart"].Value;
                    var goalStr = (imageItem.Cells["Goal"].Value as string) ?? "10";
                    var goal = 1;
                    if (!int.TryParse(goalStr, out goal))
                    {
                        goal = 1;
                    }
                    var facebookPixel = (imageItem.Cells["FacebookPixel"].Value as string) ?? "";
                    var googleAnalytics = (imageItem.Cells["GoogleAnalytics"].Value as string) ?? "";

                    // Generate proper url
                    if (failedUrl.Contains(url.ToLower()) && !url.Contains("{Random}"))
                    {
                        url += "-{Random}";
                    }
                    var times = 0;
                    do
                    {
                        if (times >= 50)
                        {
                            // Too many fails
#if SUNFROG
                            if (CheckBoxSunfrog.Checked)
                            {
                                ++count;
                            }
#endif
#if TEESPRING
                            if (CheckBoxTeespring.Checked)
                            {
                                ++count;
                            }
#endif
#if TEECHIP
                            if (CheckBoxTeechip.Checked)
                            {
                                ++count;
                            }
#endif
#if VIRALSTYLE
                            if (CheckBoxViralstyle.Checked)
                            {
                                ++count;
                            }
#endif
#if TEEZILY
                            if (CheckBoxTeezily.Checked)
                            {
                                ++count;
                            }
#endif

                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                              "Cannot generate proper Url for this item.",
                                                                                                                              null,
                                                                                                                              index - 1,
                                                                                                                              "",
                                                                                                                              title,
                                                                                                                              description));
                            url = "";
                            break;
                        }

                        var tempUrl = ToSeoFriendly(url.Replace("{Random}", GenerateRandomNumber(4 + times / 5))); // Increase size after each 5 failed
                        while (failedUrl.Contains(tempUrl.ToLower()))
                        {
                            if (!url.Contains("{Random}"))
                            {
                                url += "-{Random}";
                            }
                            ++times;
                            tempUrl = ToSeoFriendly(url.Replace("{Random}", GenerateRandomNumber(4 + times / 5))); // Increase size after each 5 failed
                        }

                        var valid = true;
#if TEESPRING
                        if (licenseData?["teespring"] != null && CheckBoxTeespring.Checked && teespringCookies != null)
                        {
                            var ts_url = Truncate(tempUrl, 30);
                            valid = valid & Teespring.CheckUrl(ts_url, teespringCookies);
                        }
#endif
#if TEECHIP
                        if (licenseData?["teechip"] != null && CheckBoxTeechip.Checked && teechipCookies != null)
                        {
                            var tc_url = Truncate(tempUrl, 50);
                            valid = valid & Teechip.CheckUrl(tc_url, teechipCookies);
                        }
#endif
#if VIRALSTYLE
                        if (licenseData?["viralstyle"] != null && CheckBoxViralstyle.Checked && viralstyleCookies != null)
                        {
                            valid = valid & Viralstyle.CheckUrl(tempUrl, viralstyleCookies);
                        }
#endif
#if TEEZILY
                        if (licenseData?["teezily"] != null && CheckBoxTeezily.Checked && teezilyCookies != null)
                        {
                            var tz_url = Truncate(tempUrl, 30);
                            valid = valid & Teezily.CheckUrl(tz_url, teezilyCookies);
                        }
#endif
                        if (valid)
                        {
                            url = tempUrl;
                            break;
                        }

                        failedUrl.Add(tempUrl.ToLower());

                        if (!url.Contains("{Random}"))
                        {
                            url += "-{Random}";
                        }

                        ++times;
                    } while (true);

                    if (string.IsNullOrEmpty(url))
                    {
                        continue;
                    }

#if SUNFROG
// Upload Sunfrog
                    if (licenseData?["sunfrog"] != null && CheckBoxSunfrog.Checked)
                    {
                        ++count;
                        if (platforms.Contains("sunfrog", StringComparer.OrdinalIgnoreCase))
                        {
                            ++sunfrogCount;
                            var uploadResponse = UploadSunfrog(
                                                               path,
                                                               image,
                                                               backPath,
                                                               backImage,
                                                               frontLeftAlign,
                                                               frontTopAlign,
                                                               backLeftAlign,
                                                               backTopAlign,
                                                               title,
                                                               description,
                                                               sunfrogCategory,
                                                               keywords,
                                                               facebookPixel,
                                                               googleAnalytics,
                                                               isPrivate,
                                                               autoRestart);
                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(uploadResponse.Result,
                                                                                                                              uploadResponse.Message,
                                                                                                                              uploadResponse.Links,
                                                                                                                              index - 1,
                                                                                                                              "Sunfrog",
                                                                                                                              title,
                                                                                                                              description));
                        }
                    }
                    else if (licenseData?["sunfrog"] == null && CheckBoxSunfrog.Checked)
                    {
                        ++count;
                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "You don't have license of Sunfrog",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "Sunfrog",
                                                                                                                          title,
                                                                                                                          description));
                    }
#endif

#if TEESPRING
                    // Upload Teespring
                    if (licenseData?["teespring"] != null && CheckBoxTeespring.Checked)
                    {
                        ++count;
                        if (platforms.Contains("teespring", StringComparer.OrdinalIgnoreCase))
                        {
                            ++teespringCount;
                            var uploadResponse = UploadTeespring(
                                                                 image,
                                                                 path,
                                                                 backImage,
                                                                 backPath,
                                                                 frontLeftAlign,
                                                                 frontTopAlign,
                                                                 backLeftAlign,
                                                                 backTopAlign,
                                                                 title,
                                                                 description,
                                                                 keywords,
                                                                 teespringCategory,
                                                                 duration,
                                                                 url,
                                                                 goal,
                                                                 autoRestart,
                                                                 isPrivate,
                                                                 teespringRegion ?? "",
                                                                 facebookPixel,
                                                                 googleAnalytics);
                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(uploadResponse.Result,
                                                                                                                              uploadResponse.Message,
                                                                                                                              uploadResponse.Links,
                                                                                                                              index - 1,
                                                                                                                              "Teespring",
                                                                                                                              title,
                                                                                                                              description));
                        }
                    }
                    else if (licenseData?["teespring"] == null && CheckBoxTeespring.Checked)
                    {
                        ++count;
                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "You don't have license of Teespring",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "Teespring",
                                                                                                                          title,
                                                                                                                          description));
                    }
#endif

#if TEECHIP
// Upload Teechip
                    if (licenseData?["teechip"] != null && CheckBoxTeechip.Checked)
                    {
                        ++count;
                        if (platforms.Contains("teechip", StringComparer.OrdinalIgnoreCase))
                        {
                            ++teechipCount;
                            var uploadResponse = UploadTeechip(
                                                               image,
                                                               path,
                                                               backImage,
                                                               backPath,
                                                               frontLeftAlign,
                                                               frontTopAlign,
                                                               backLeftAlign,
                                                               backTopAlign,
                                                               title,
                                                               description,
                                                               duration,
                                                               url,
                                                               isPrivate,
                                                               autoRestart,
                                                               facebookPixel,
                                                               googleAnalytics);
                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(uploadResponse.Result,
                                                                                                                              uploadResponse.Message,
                                                                                                                              uploadResponse.Links,
                                                                                                                              index - 1,
                                                                                                                              "Teechip",
                                                                                                                              title,
                                                                                                                              description));
                        }
                    }
                    else if (licenseData?["teechip"] == null && CheckBoxTeechip.Checked)
                    {
                        ++count;
                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "You don't have license of Teechip",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "Teechip",
                                                                                                                          title,
                                                                                                                          description));
                    }
#endif

#if VIRALSTYLE
// Upload Viralstyle
                    if (licenseData?["viralstyle"] != null && CheckBoxViralstyle.Checked)
                    {
                        ++count;
                        if (platforms.Contains("viralstyle", StringComparer.OrdinalIgnoreCase))
                        {
                            ++viralstyleCount;
                            var uploadResponse = UploadViralstyle(
                                                                  image,
                                                                  path,
                                                                  backImage,
                                                                  backPath,
                                                                  frontLeftAlign,
                                                                  frontTopAlign,
                                                                  backLeftAlign,
                                                                  backTopAlign,
                                                                  title,
                                                                  description,
                                                                  url,
                                                                  keywords,
                                                                  viralstyleCategory,
                                                                  duration,
                                                                  goal,
                                                                  autoRestart,
                                                                  isPrivate,
                                                                  facebookPixel,
                                                                  googleAnalytics);
                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(uploadResponse.Result,
                                                                                                                              uploadResponse.Message,
                                                                                                                              uploadResponse.Links,
                                                                                                                              index - 1,
                                                                                                                              "Viralstyle",
                                                                                                                              title,
                                                                                                                              description));
                        }
                    }
                    else if (licenseData?["viralstyle"] == null && CheckBoxViralstyle.Checked)
                    {
                        ++count;
                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "You don't have license of Viralstyle",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "Viralstyle",
                                                                                                                          title,
                                                                                                                          description));
                    }
#endif

#if TEEZILY
// Upload Teezily
                    if (licenseData?["teezily"] != null && CheckBoxTeezily.Checked)
                    {
                        ++count;
                        if (platforms.Contains("teezily", StringComparer.OrdinalIgnoreCase))
                        {
                            ++teezilyCount;
                            var uploadResponse = UploadTeezily(
                                                               image,
                                                               path,
                                                               backImage,
                                                               backPath,
                                                               frontLeftAlign,
                                                               frontTopAlign,
                                                               backLeftAlign,
                                                               backTopAlign,
                                                               title,
                                                               description,
                                                               teezilyCategory,
                                                               keywords,
                                                               duration,
                                                               url,
                                                               goal,
                                                               isPrivate,
                                                               autoRestart,
                                                               facebookPixel,
                                                               googleAnalytics,
                                                               teezilyCurrency);
                            BackgroundWorkerUpload.ReportProgress(
                                                                  (int) ((float) count / totalItems * 100),
                                                                  new Tuple<bool, string, Array, int, string, string, string>(uploadResponse.Result,
                                                                                                                              uploadResponse.Message,
                                                                                                                              uploadResponse.Links,
                                                                                                                              index - 1,
                                                                                                                              "Teezily",
                                                                                                                              title,
                                                                                                                              description));
                        }
                    }
                    else if (licenseData?["teezily"] == null && CheckBoxTeezily.Checked)
                    {
                        ++count;
                        BackgroundWorkerUpload.ReportProgress(
                                                              (int) ((float) count / totalItems * 100),
                                                              new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                          "You don't have license of Teezily",
                                                                                                                          null,
                                                                                                                          index - 1,
                                                                                                                          "Teezily",
                                                                                                                          title,
                                                                                                                          description));
                    }
#endif
                }
                catch (Exception exc)
                {
                    Logger.WriteLog(exc);
                    BackgroundWorkerUpload.ReportProgress(
                                                          (int) ((float) count / totalItems * 100),
                                                          new Tuple<bool, string, Array, int, string, string, string>(false,
                                                                                                                      exc.Message,
                                                                                                                      null,
                                                                                                                      index - 1,
                                                                                                                      "",
                                                                                                                      "",
                                                                                                                      ""));
                }

                ++completedRows;
                if (delayTime > 0 && count < totalItems)
                {
                    System.Threading.Thread.Sleep(1000 * delayTime);
                }
            }
        }

        private void BackgroundWorkerUpload_ProgressChanged(object sender, ProgressChangedEventArgs e)
        {
            ProgressBarUploading.Value = Math.Min(100, Math.Max(0, e.ProgressPercentage));
            ProgressBarUploading.Text = e.ProgressPercentage + "%";
            var state = e.UserState as Tuple<bool, string, Array, int, string, string, string>;
            if (state != null)
            {
                LabelProgressInfo.Text = $"{state.Item4 + 1}/{GridViewImages.Rows.Count} design(s) are completed";
                if (state.Item1)
                {
                    TextBoxLog.AppendText(NewLine + DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss") + $" - Upload {state.Item5} successfully." + NewLine);
                    TextBoxLog.AppendText("INFO: " + state.Item2 + NewLine);

                    GridViewImages.Rows[state.Item4].Cells["PlatformUploadInfo"].Value += $"Title = {state.Item6}\n";
                    GridViewImages.Rows[state.Item4].Cells["PlatformUploadInfo"].Value += $"Description = {state.Item7}\n";

                    if (state.Item4 >= 0 & state.Item4 < failedItems.Count)
                    {
                        var index = -1;
                        for (var i = 0; i < failedItems[state.Item4].Count; i++)
                        {
                            if (failedItems[state.Item4][i].Equals(state.Item5, StringComparison.OrdinalIgnoreCase))
                            {
                                index = i;
                                break;
                            }
                        }

                        if (index >= 0)
                        {
                            failedItems[state.Item4].RemoveAt(index);
                        }
                    }

                    if (state.Item4 >= 0 && state.Item4 < GridViewImages.Rows.Count)
                    {
                        GridViewImages.Rows[state.Item4].Cells["PlatformUploadInfo"].Value += $"{state.Item5} Link = {state.Item3.GetValue(0)}\n";

                        // Move file
                        if (CheckBoxMoveImages.Checked)
                        {
                            try
                            {
                                var path = GridViewImages.Rows[state.Item4].Cells["FrontImagePath"].Value as string;
                                var backPath = GridViewImages.Rows[state.Item4].Cells["BackImagePath"].Value as string;

                                if (!string.IsNullOrEmpty(path) && File.Exists(path))
                                {
                                    if (!Directory.Exists(Path.GetDirectoryName(path) + @"\Done\"))
                                    {
                                        Directory.CreateDirectory(Path.GetDirectoryName(path) + @"\Done\");
                                    }
                                    if (File.Exists(Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path)))
                                    {
                                        File.Delete(Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path));
                                    }
                                    File.Move(path, Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path));
                                    designList.Add(new[]
                                                   {
                                                       Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path),
                                                       GridViewImages.Rows[state.Item4].Cells["FrontLeft"].Value as string,
                                                       GridViewImages.Rows[state.Item4].Cells["FrontTop"].Value as string,
                                                       "Front", // Front or Back
                                                       GridViewImages.Rows[state.Item4].Cells["PlatformUploadInfo"].Value as string,
                                                   });
                                }

                                if (!string.IsNullOrEmpty(backPath) && File.Exists(backPath))
                                {
                                    if (!Directory.Exists(Path.GetDirectoryName(backPath) + @"\Done\"))
                                    {
                                        Directory.CreateDirectory(Path.GetDirectoryName(backPath) + @"\Done\");
                                    }
                                    if (File.Exists(Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath)))
                                    {
                                        File.Delete(Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath));
                                    }
                                    File.Move(backPath, Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath));
                                    designList.Add(new[]
                                                   {
                                                       Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath),
                                                       GridViewImages.Rows[state.Item4].Cells["BackLeft"].Value as string,
                                                       GridViewImages.Rows[state.Item4].Cells["BackTop"].Value as string,
                                                       "Back", // Front or Back
                                                       GridViewImages.Rows[state.Item4].Cells["PlatformUploadInfo"].Value as string,
                                                   });
                                }
                            }
                            catch (Exception exc)
                            {
                                Logger.WriteLog(exc);
                            }
                        }
                    }

                    foreach (var productLink in state.Item3)
                    {
                        TextBoxLinks.AppendText(productLink + NewLine);

                        if (CheckBoxAutoSave.Checked && !string.IsNullOrEmpty(CheckBoxAutoSave.Tag as string))
                        {
                            File.AppendAllText(CheckBoxAutoSave.Tag as string, productLink + NewLine);
                        }
                    }
                }
                else
                {
                    TextBoxLog.AppendText(NewLine + DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss") + $" - Upload {state.Item5} failed." + NewLine);
                    TextBoxLog.AppendText("ERROR: " + state.Item2 + NewLine);

                    if (state.Item4 >= 0 && state.Item4 < GridViewImages.Rows.Count)
                    {
                        GridViewImages.Rows[state.Item4].ErrorText = state.Item2;
                    }
                }
            }
        }

        private void BackgroundWorkerUpload_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            // Remove file
            var removedRows = new List<int>();
            designList.Clear();
            foreach (DataGridViewRow row in GridViewImages.Rows)
            {
                var path = row.Cells["FrontImagePath"].Value as string;
                var backPath = row.Cells["BackImagePath"].Value as string;

                if (!string.IsNullOrEmpty(row.ErrorText) || row.Index >= completedRows)
                {
                    // If error then ignore this row
                    lastFailedTime = DateTime.Now;
                    if (!string.IsNullOrEmpty(path) && File.Exists(path))
                    {
                        designList.Add(new[]
                                       {
                                           path,
                                           row.Cells["FrontLeft"].Value as string,
                                           row.Cells["FrontTop"].Value as string,
                                           "Front", // Front or Back
                                           row.Cells["PlatformUploadInfo"].Value as string,
                                       });
                    }
                    if (!string.IsNullOrEmpty(backPath) && File.Exists(backPath))
                    {
                        designList.Add(new[]
                                       {
                                           backPath,
                                           row.Cells["BackLeft"].Value as string,
                                           row.Cells["BackTop"].Value as string,
                                           "Back", // Front or Back
                                           row.Cells["PlatformUploadInfo"].Value as string,
                                       });
                    }
                    continue;
                }

                // Move file
                if (CheckBoxMoveImages.Checked)
                {
                    // Move each file instead of bulk at once
                    //try
                    //{
                    //    if (!string.IsNullOrEmpty(path) && File.Exists(path))
                    //    {
                    //        if (!Directory.Exists(Path.GetDirectoryName(path) + @"\Done\"))
                    //        {
                    //            Directory.CreateDirectory(Path.GetDirectoryName(path) + @"\Done\");
                    //        }
                    //        if (File.Exists(Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path)))
                    //        {
                    //            File.Delete(Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path));
                    //        }
                    //        File.Move(path, Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path));
                    //        designList.Add(new[]
                    //                       {
                    //                           Path.GetDirectoryName(path) + @"\Done\" + Path.GetFileName(path),
                    //                           row.Cells["FrontLeft"].Value as string,
                    //                           row.Cells["FrontTop"].Value as string,
                    //                           "Front", // Front or Back
                    //                           row.Cells["PlatformUploadInfo"].Value as string,
                    //                       });
                    //    }

                    //    if (!string.IsNullOrEmpty(backPath) && File.Exists(backPath))
                    //    {
                    //        if (!Directory.Exists(Path.GetDirectoryName(backPath) + @"\Done\"))
                    //        {
                    //            Directory.CreateDirectory(Path.GetDirectoryName(backPath) + @"\Done\");
                    //        }
                    //        if (File.Exists(Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath)))
                    //        {
                    //            File.Delete(Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath));
                    //        }
                    //        File.Move(backPath, Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath));
                    //        designList.Add(new[]
                    //                       {
                    //                           Path.GetDirectoryName(backPath) + @"\Done\" + Path.GetFileName(backPath),
                    //                           row.Cells["BackLeft"].Value as string,
                    //                           row.Cells["BackTop"].Value as string,
                    //                           "Back", // Front or Back
                    //                           row.Cells["PlatformUploadInfo"].Value as string,
                    //                       });
                    //    }
                    //}
                    //catch (Exception exc)
                    //{
                    //    Logger.WriteLog(exc);
                    //}
                }
                else
                {
                    if (!string.IsNullOrEmpty(path) && File.Exists(path))
                    {
                        designList.Add(new[]
                                       {
                                           path,
                                           row.Cells["FrontLeft"].Value as string,
                                           row.Cells["FrontTop"].Value as string,
                                           "Front", // Front or Back
                                           row.Cells["PlatformUploadInfo"].Value as string,
                                       });
                    }
                    if (!string.IsNullOrEmpty(backPath) && File.Exists(backPath))
                    {
                        designList.Add(new[]
                                       {
                                           backPath,
                                           row.Cells["BackLeft"].Value as string,
                                           row.Cells["BackTop"].Value as string,
                                           "Back", // Front or Back
                                           row.Cells["PlatformUploadInfo"].Value as string,
                                       });
                    }
                }

                if (CheckBoxRemoveArts.Checked)
                {
                    removedRows.Add(row.Index);
                }
            }

            foreach (var index in removedRows.OrderByDescending(x => x))
            {
                GridViewImages.Rows.RemoveAt(index);
                failedItems.RemoveAt(index);
            }

            ButtonStartUploading.Enabled = true;
            ButtonStopUploading.Enabled = false;
            ButtonCreateMockups.Enabled = true;
            Cursor = Cursors.Default;
            if (lastFailedTime == null || CheckBoxAutoReset.Checked == false)
            {
                MessageBox.Show(
                                "Upload completed. Please check Log and Links box for result.",
                                "Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Information);
            }
        }

        #region Platform Sunfrog

#if SUNFROG

        private const string SunfrogUsernameEncryptionKey = "u8jL0D5nUc5DbVRoW3cacSjDGMHNYmNKqqr5sg7kBuVNee7sWRyfEaz8WXbc";
        private const string SunfrogPasswordEncryptionKey = "aywWcyo3tzCe57FxJN9cbmQl4OIVqQ8ndT3H9R4mopSaCoRuYmi5mtkTCn81";

        private void Sunfrog_IsDefaultChanged(object sender, EventArgs e)
        {
            var productControl = sender as SunfrogProduct;
            if (productControl == null || productControl.CheckBoxIsDefault.Checked == false)
            {
                return;
            }

            foreach (Control control in FlowLayoutSunfrog.Controls)
            {
                if (control is SunfrogProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as SunfrogProduct).CheckBoxIsDefault.Checked = false;
                }
            }
        }

        private void CheckBoxSunfrog_CheckedChanged(object sender, EventArgs e)
        {
            LabelSunfrogAccounts.Enabled = CheckBoxSunfrog.Checked;
            ComboBoxSunfrogAccounts.Enabled = CheckBoxSunfrog.Checked;
            ButtonAddSunfrogAccount.Enabled = CheckBoxSunfrog.Checked;
            ButtonRemoveSunfrogAccount.Enabled = CheckBoxSunfrog.Checked;
            ButtonImportSunfrogAccounts.Enabled = CheckBoxSunfrog.Checked;
            ButtonRemoveAllSunfrogAccounts.Enabled = CheckBoxSunfrog.Checked;
        }

        private void CheckedListBoxSunfrogProducts_ItemCheck(object sender, ItemCheckEventArgs e)
        {
            if (e.NewValue == CheckState.Checked && sunfrogProducts != null)
            {
                // Add
                var productControl = new SunfrogProduct();
                productControl.SetProduct(sunfrogProducts[e.Index]);
                productControl.Tag = e.Index;
                productControl.IsDefaultChanged += Sunfrog_IsDefaultChanged;
                FlowLayoutSunfrog.Controls.Add(productControl);
            }
            else
            {
                // Remove
                foreach (Control control in FlowLayoutSunfrog.Controls)
                {
                    if (control is SunfrogProduct && (int) control.Tag == e.Index)
                    {
                        (control as SunfrogProduct).IsDefaultChanged -= Sunfrog_IsDefaultChanged;
                        FlowLayoutSunfrog.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                }
            }
        }

        private void AddSunfrogAccount(string username, string password)
        {
            // Save to Sunfrog accounts
            if (!Directory.Exists("Platform/Sunfrog"))
            {
                Directory.CreateDirectory("Platform/Sunfrog");
            }

            var accounts = ComboBoxSunfrogAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();

            if (accounts.Exists(x => x.Key.ToLower() == username.ToLower()))
            {
                MessageBox.Show("This account is already added.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            accounts.Add(new KeyValuePair<string, string>(username, password));
            ComboBoxSunfrogAccounts.DataSource = null;
            ComboBoxSunfrogAccounts.DataSource = accounts;
            ComboBoxSunfrogAccounts.DisplayMember = "Key";
            ComboBoxSunfrogAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var account in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(account.Key, SunfrogUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(account.Value, SunfrogPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Sunfrog/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonAddSunfrogAccount_Click(object sender, EventArgs e)
        {
            var form = new FormAddAccount();
            if (form.ShowDialog() == DialogResult.OK)
            {
                AddSunfrogAccount(form.TextBoxUsername.Text, form.TextBoxPassword.Text);
            }
        }

        private void ButtonRemoveSunfrogAccount_Click(object sender, EventArgs e)
        {
            if (ComboBoxSunfrogAccounts.SelectedItem == null)
            {
                return;
            }

            var account = (KeyValuePair<string, string>) ComboBoxSunfrogAccounts.SelectedItem;

            var accounts = ComboBoxSunfrogAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();
            accounts.Remove(account);
            ComboBoxSunfrogAccounts.DataSource = null;
            ComboBoxSunfrogAccounts.DataSource = accounts;
            ComboBoxSunfrogAccounts.DisplayMember = "Key";
            ComboBoxSunfrogAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var acc in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(acc.Key, SunfrogUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(acc.Value, SunfrogPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Sunfrog/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonImportSunfrogAccounts_Click(object sender, EventArgs e)
        {
            ImportAccounts(AddSunfrogAccount);
        }

        private void ButtonRemoveAllSunfrogAccounts_Click(object sender, EventArgs e)
        {
            ComboBoxSunfrogAccounts.DataSource = null;
            File.Delete("Platform/Sunfrog/Accounts.txt");
        }

        private void ComboBoxSunfrogAccounts_SelectedIndexChanged(object sender, EventArgs e)
        {
            sunfrogCookies = null;
        }

        private void InitSunfrog()
        {
            LoadSunfrogProducts(FlowLayoutSunfrog);
            LoadSunfrogAccounts();
            var categories = LoadSunfrogCategories();
            foreach (var cat in categories)
            {
                SunfrogCategory.Items.Add(cat);
            }

            SunfrogCategory.DisplayMember = "Value";
            SunfrogCategory.ValueMember = "Key";

            for (var i = 0; i < CheckedListBoxSunfrogProducts.Items.Count; i++)
            {
                CheckedListBoxSunfrogProducts.SetItemChecked(i, true);
                CheckedListBoxSunfrogProducts.SetItemChecked(i, false);
            }
        }

        private void LoadSunfrogProducts(Control container)
        {
            if (container == null)
            {
                return;
            }

            sunfrogProducts = new JArray();
            var products = Sunfrog.GetProductsRate("-Rate55");
            if (products != null)
            {
                // Create products
                foreach (var product in products)
                {
                    if (product["isEnabled"].ToObject<bool>())
                    {
                        CheckedListBoxSunfrogProducts.Items.Add(product["description"].ToObject<string>());
                        sunfrogProducts.Add(product);
                    }
                }
            }
            else
            {
                MessageBox.Show(
                                @"Error happens when connect to Sunfrog server. Please check your Internet connection and run application again.
You can upload to other platforms also.",
                                "Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
            }
        }

        private List<KeyValuePair<string, string>> LoadSunfrogCategories()
        {
            var categories = new List<KeyValuePair<string, string>>
                             {
                                 new KeyValuePair<string, string>("52", "Automotive"),
                                 new KeyValuePair<string, string>("76", "Birth Years"),
                                 new KeyValuePair<string, string>("78", "Drinking"),
                                 new KeyValuePair<string, string>("25", "Events"),
                                 new KeyValuePair<string, string>("26", "Faith"),
                                 new KeyValuePair<string, string>("61", "Fitness"),
                                 new KeyValuePair<string, string>("19", "Funny"),
                                 new KeyValuePair<string, string>("13", "Gamer"),
                                 new KeyValuePair<string, string>("24", "Geek-Tech"),
                                 new KeyValuePair<string, string>("82", "Hobby"),
                                 new KeyValuePair<string, string>("35", "Holidays"),
                                 new KeyValuePair<string, string>("79", "Jobs"),
                                 new KeyValuePair<string, string>("43", "LifeStyle"),
                                 new KeyValuePair<string, string>("12", "Movies"),
                                 new KeyValuePair<string, string>("71", "Music"),
                                 new KeyValuePair<string, string>("75", "Names"),
                                 new KeyValuePair<string, string>("81", "Outdoor"),
                                 new KeyValuePair<string, string>("62", "Pets"),
                                 new KeyValuePair<string, string>("17", "Political"),
                                 new KeyValuePair<string, string>("27", "Sports"),
                                 new KeyValuePair<string, string>("77", "States"),
                                 new KeyValuePair<string, string>("34", "TV Shows"),
                                 new KeyValuePair<string, string>("11", "Zombies"),
                             };

            return categories;
        }

        private void LoadSunfrogAccounts()
        {
            if (!File.Exists("Platform/Sunfrog/Accounts.txt"))
            {
                return;
            }

            var content = File.ReadAllText("Platform/Sunfrog/Accounts.txt");
            var json = JsonConvert.DeserializeObject<JArray>(content);

            var accounts = new List<KeyValuePair<string, string>>();
            foreach (var acc in json)
            {
                try
                {
                    var username = acc["Username"].ToObject<string>();
                    var password = acc["Password"].ToObject<string>();
                    var index = username.IndexOf('=');
                    while (index < username.Length - 1 && username[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltUsername = username.Substring(0, index);
                    username = Common.Decrypt(username.Substring(index + 1), SunfrogUsernameEncryptionKey, saltUsername);
                    index = password.IndexOf('=');
                    while (index < password.Length - 1 && password[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltPassword = password.Substring(0, index);
                    password = Common.Decrypt(password.Substring(index + 1), SunfrogPasswordEncryptionKey, saltPassword);
                    accounts.Add(new KeyValuePair<string, string>(username, password));
                }
                catch (Exception exc)
                {
                }
            }

            ComboBoxSunfrogAccounts.DataSource = accounts;
        }

        private void UpdateSunfrogProducts(string affiliateRate)
        {
            if (string.IsNullOrEmpty(affiliateRate))
            {
                return;
            }

            sunfrogProducts = Sunfrog.GetProductsRate(affiliateRate);
            foreach (Control control in FlowLayoutSunfrog.Controls)
            {
                if (control is SunfrogProduct)
                {
                    (control as SunfrogProduct).Product = sunfrogProducts[(int) control.Tag];
                }
            }
        }

        private (bool Result, string Message, string[] Links) UploadSunfrog(
            string path,
            Image artImage,
            string backPath,
            Image backArtImage,
            string frontLeftAlign,
            string frontTopAlign,
            string backLeftAlign,
            string backTopAlign,
            string title,
            string description,
            string category,
            string keywords,
            string facebookPixel,
            string googleAnalytics,
            bool isPrivate,
            bool autoRestart)
        {
            if (licenseData?["sunfrog"] == null)
            {
                return (false, "You don't have license of Sunfrog.", null);
            }
            if (sunfrogCookies == null)
            {
                return (false, "You didn't login to Sunfrog. Please check your Sunfrog account.", null);
            }

            if (artImage == null && backArtImage == null)
            {
                return (false, "There are no images to upload.", null);
            }

            var sunfrogItem = new SunfrogItem
                              {
                                  ArtOwnerID = 0,
                                  IAgree = true,
                                  Title = title,
                                  Category = category,
                                  Description = Regex.Replace(description.Replace("<br />", "\n\r"), "<.*?>", string.Empty),
                                  Keywords = (keywords ?? "").Split(new char[] {',', ' '}, StringSplitOptions.RemoveEmptyEntries).Select(x => x.Trim()).Take(3).ToArray()
                              };
            JToken product = null;
            Image baseImage = null;
            Image baseBackImage = null;
            var types = new List<SunfrogItemColor>();
            foreach (var control in FlowLayoutSunfrog.Controls)
            {
                if (control is SunfrogProduct)
                {
                    var sunfrogProduct = (SunfrogProduct) control;
                    if (sunfrogProduct.SelectedColors.Count > 0)
                    {
                        product = sunfrogProduct.Product;
                        baseImage = sunfrogProduct.BaseImage;
                        baseBackImage = sunfrogProduct.BaseBackImage;

                        var colors = new List<string>();
                        foreach (var color in sunfrogProduct.SelectedColors)
                        {
                            foreach (var c in sunfrogProduct.Product["colors"].ToObject<JArray>())
                            {
                                if (color == c["id"].ToObject<int>())
                                {
                                    colors.Add(c["name"].ToObject<string>());
                                }
                            }
                        }

                        var price = decimal.ToDouble(sunfrogProduct.NumericUpDownPrice.Value);
                        if (artImage == null || backArtImage == null)
                        {
                            var maxPrice = product["basePrice"].ToObject<double>() < 23 ? 29 : 45;
                            price = Math.Min(maxPrice, Math.Max(price, product["basePrice"].ToObject<double>()));
                        }
                        else
                        {
                            var maxPrice = (product["basePrice"].ToObject<double>() < 23 ? 29 : 45) + product["backPrintPrice"].ToObject<double>();
                            price = Math.Min(maxPrice, Math.Max(price, product["basePrice"].ToObject<double>() + product["backPrintPrice"].ToObject<double>()));
                        }
                        var type = new SunfrogItemColor()
                                   {
                                       Id = sunfrogProduct.Product["id"].ToObject<int>(),
                                       Name = sunfrogProduct.Product["description"].ToObject<string>(),
                                       Price = price,
                                       Colors = colors.ToArray()
                                   };
                        if (sunfrogProduct.CheckBoxIsDefault.Checked)
                        {
                            types.Insert(0, type);
                        }
                        else
                        {
                            types.Add(type);
                        }
                    }
                }
            }

            if (types.Count == 0)
            {
                return (false, "Sunfrog - You must select at least 1 shirt style and color.", null);
            }

            sunfrogItem.Types = types.ToArray();
            if (product != null && baseImage != null && artImage != null)
            {
                var scale = product["printable"]["scaleFront"].ToObject<double>();
                if (artImage.Width > product["printable"]["width"].ToObject<int>() || artImage.Height > product["printable"]["height"].ToObject<int>())
                {
                    var scaleX = product["printable"]["svgFrontWidth"].ToObject<int>() / (double) artImage.Width;
                    var scaleY = product["printable"]["svgFrontHeight"].ToObject<int>() / (double) artImage.Height;
                    scale = Math.Min(scaleX, scaleY);
                }
                var translateX = (baseImage.Width - product["printable"]["svgFrontWidth"].ToObject<double>()) / 2 / scale;
                var translateY = product["printable"]["yOffsetFront"].ToObject<int>() / scale;
                if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                {
                    translateX += product["printable"]["svgFrontWidth"].ToObject<double>() / 2 / scale - (double) artImage.Width / 2;
                }
                else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    translateX += product["printable"]["svgFrontWidth"].ToObject<double>() / scale - (double) artImage.Width;
                }
                if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                {
                    translateY += product["printable"]["svgFrontHeight"].ToObject<double>() / 2 / scale - (double) artImage.Height / 2;
                }
                else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    translateY += product["printable"]["svgFrontHeight"].ToObject<double>() / scale - artImage.Height;
                }
                sunfrogItem.ImageFront = string.Format(
                                                       licenseData["sunfrog"]["imageFront"].ToObject<string>(),
                                                       (baseImage.Width - product["printable"]["svgFrontWidth"].ToObject<int>()) / 2,
                                                       product["printable"]["yOffsetFront"].ToObject<int>(),
                                                       product["printable"]["svgFrontWidth"].ToObject<int>(),
                                                       product["printable"]["svgFrontHeight"].ToObject<int>(),
                                                       product["printable"]["height"].ToObject<int>(),
                                                       product["printable"]["width"].ToObject<int>(),
                                                       scale,
                                                       scale,
                                                       translateX,
                                                       translateY,
                                                       artImage.Height,
                                                       artImage.Width
                                                      );
            }
            else
            {
                sunfrogItem.ImageFront = "";
            }
            if (product != null && baseBackImage != null && backArtImage != null)
            {
                var scale = product["printable"]["scaleBack"].ToObject<double>();
                if (backArtImage.Width > product["printable"]["width"].ToObject<int>() || backArtImage.Height > product["printable"]["height"].ToObject<int>())
                {
                    var scaleX = product["printable"]["svgBackWidth"].ToObject<int>() / (double) backArtImage.Width;
                    var scaleY = product["printable"]["svgBackHeight"].ToObject<int>() / (double) backArtImage.Height;
                    scale = Math.Min(scaleX, scaleY);
                }
                var translateX = (baseBackImage.Width - product["printable"]["svgBackWidth"].ToObject<double>()) / 2 / scale;
                var translateY = product["printable"]["yOffsetBack"].ToObject<double>() / scale;
                if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                {
                    translateX += product["printable"]["svgBackWidth"].ToObject<double>() / 2 / scale - (double) backArtImage.Width / 2;
                }
                else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    translateX += product["printable"]["svgBackWidth"].ToObject<double>() / scale - (double) backArtImage.Width;
                }
                if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                {
                    translateY += product["printable"]["svgBackHeight"].ToObject<double>() / 2 / scale - (double) backArtImage.Height / 2;
                }
                else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    translateY += product["printable"]["svgBackHeight"].ToObject<double>() / scale - backArtImage.Height;
                }
                sunfrogItem.ImageBack = string.Format(
                                                      licenseData["sunfrog"]["imageBack"].ToObject<string>(),
                                                      (baseBackImage.Width - product["printable"]["svgBackWidth"].ToObject<int>()) / 2,
                                                      product["printable"]["yOffsetBack"].ToObject<int>(),
                                                      product["printable"]["svgBackWidth"].ToObject<int>(),
                                                      product["printable"]["svgBackHeight"].ToObject<int>(),
                                                      product["printable"]["height"].ToObject<int>(),
                                                      product["printable"]["width"].ToObject<int>(),
                                                      scale,
                                                      scale,
                                                      translateX,
                                                      translateY,
                                                      backArtImage.Height,
                                                      backArtImage.Width
                                                     );
            }
            else
            {
                sunfrogItem.ImageBack = "";
            }
            sunfrogItem.Images = new SunfrogItemImage[(artImage == null || backArtImage == null) ? 1 : 2];
            if (!string.IsNullOrEmpty(path) && artImage != null)
            {
                using (var stream = new FileStream(path, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
                {
                    var imageBytes = new byte[stream.Length];
                    stream.Read(imageBytes, 0, imageBytes.Length);
                    var codec = ImageCodecInfo.GetImageDecoders().First(c => c.FormatID == artImage.RawFormat.Guid);
                    sunfrogItem.Images[0] = new SunfrogItemImage()
                                            {
                                                Id = "__dataURI:0__",
                                                Uri = imageBytes.ToBase64(codec.MimeType)
                                            };
                    stream.Close();
                }
            }
            if (!string.IsNullOrEmpty(backPath) && backArtImage != null)
            {
                using (var stream = new FileStream(backPath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
                {
                    var imageBytes = new byte[stream.Length];
                    stream.Read(imageBytes, 0, imageBytes.Length);
                    var codec = ImageCodecInfo.GetImageDecoders().First(c => c.FormatID == backArtImage.RawFormat.Guid);
                    sunfrogItem.Images[sunfrogItem.Images.Length - 1] = new SunfrogItemImage()
                                                                        {
                                                                            Id = "__dataURI:1__",
                                                                            Uri = imageBytes.ToBase64(codec.MimeType)
                                                                        };
                    stream.Close();
                }
            }

            var result = Sunfrog.Upload(sunfrogItem, sunfrogCookies);
            var newCampaignUrl = Sunfrog.GetNewCampaign(sunfrogCookies);
            if ((result == null && !string.IsNullOrEmpty(newCampaignUrl))
                || (result != null && result["products"] != null && result["products"].ToObject<JArray>().Count > 0))
            {
                if (result == null || !string.IsNullOrEmpty(newCampaignUrl))
                {
                    var link = $"https://www.sunfrog.com/{newCampaignUrl}".ToLower();
                    if (sunfrogCampaigns.Contains(link))
                    {
                        // This is not added link
                        return (false, "Sunfrog - Upload design failed because of server error. You can check your campaign list or check log for more information.", null
                            );
                    }

                    if (!string.IsNullOrEmpty(facebookPixel) || !string.IsNullOrEmpty(googleAnalytics) || isPrivate == true || autoRestart == true)
                    {
                        Sunfrog.UpdateCampaign(sunfrogItem, newCampaignUrl, facebookPixel, googleAnalytics, isPrivate, autoRestart, sunfrogCookies);
                    }

                    sunfrogCampaigns.Add(link);

                    return (true, $"Sunfrog - Success: {types.Select(x => x.Colors.Length).Sum()} mockup(s) were generated", new[] {link});
                }

                var arts = new List<string>();
                var links = new List<string>();
                foreach (var p in result["products"].ToObject<JArray>())
                {
                    links.Add($"https://www.sunfrog.com/{p["pageName"].ToObject<string>()}".ToLower());
                    if (p["imageFront"] != null && !string.IsNullOrEmpty(p["imageFront"].ToObject<string>()))
                    {
                        arts.Add("Front: http:" + p["imageFront"].ToObject<string>());
                    }
                    if (p["imageBack"] != null && !string.IsNullOrEmpty(p["imageBack"].ToObject<string>()))
                    {
                        arts.Add("Back: http:" + p["imageBack"].ToObject<string>());
                    }

                    if (!string.IsNullOrEmpty(facebookPixel) || !string.IsNullOrEmpty(googleAnalytics) || isPrivate == true || autoRestart == true)
                    {
                        Sunfrog.UpdateCampaign(sunfrogItem, p["pageName"].ToObject<string>(), facebookPixel, googleAnalytics, isPrivate, autoRestart, sunfrogCookies);
                    }

                    // Just get the first one
                    break;
                }

                sunfrogCampaigns.AddRange(links);

                return (true, "Sunfrog - " + result["description"].ToObject<string>(), links.ToArray());
            }

            return (false, "Sunfrog - " + (result != null
                                               ? result["description"].ToObject<string>()
                                               : "Upload design failed because of server error. You can check your campaign list or check log for more information."
                                          ), null);
        }

#endif

        #endregion

        #region Platform Teechip

#if TEECHIP

        private const string TeechipUsernameEncryptionKey = "DbCpkMzqU9KkGr3af5yUTppvTFTogQYvL90DmlqlsQhlUCybBgmftLh3mz08";
        private const string TeechipPasswordEncryptionKey = "LKBcaGzInMLIW3c7Ohvu4DzUOu5npa11xlCZUJhm2iToURo6uCsm9cN44Cvq";

        private void Teechip_IsDefaultChanged(object sender, EventArgs e)
        {
            var productControl = sender as TeechipProduct;
            if (productControl == null || productControl.CheckBoxIsDefault.Checked == false)
            {
                return;
            }

            foreach (Control control in FlowLayoutTeechip.Controls)
            {
                if (control is TeechipProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as TeechipProduct).CheckBoxIsDefault.Checked = false;
                }
            }
        }

        private void CheckBoxTeechip_CheckedChanged(object sender, EventArgs e)
        {
            LabelTeechipAccounts.Enabled = CheckBoxTeechip.Checked;
            ComboBoxTeechipAccounts.Enabled = CheckBoxTeechip.Checked;
            ButtonAddTeechipAccount.Enabled = CheckBoxTeechip.Checked;
            ButtonRemoveTeechipAccount.Enabled = CheckBoxTeechip.Checked;
            ButtonImportTeechipAccounts.Enabled = CheckBoxTeechip.Checked;
            ButtonRemoveAllTeechipAccounts.Enabled = CheckBoxTeechip.Checked;
        }

        private void AddTeechipAccount(string username, string password)
        {
            // Save to Teechip accounts
            if (!Directory.Exists("Platform/Teechip"))
            {
                Directory.CreateDirectory("Platform/Teechip");
            }

            var accounts = ComboBoxTeechipAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();

            if (accounts.Exists(x => x.Key.ToLower() == username.ToLower()))
            {
                MessageBox.Show("This account is already added.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            accounts.Add(new KeyValuePair<string, string>(username, password));
            ComboBoxTeechipAccounts.DataSource = null;
            ComboBoxTeechipAccounts.DataSource = accounts;
            ComboBoxTeechipAccounts.DisplayMember = "Key";
            ComboBoxTeechipAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var account in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(account.Key, TeechipUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(account.Value, TeechipPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teechip/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonAddTeechipAccount_Click(object sender, EventArgs e)
        {
            var form = new FormAddAccount();
            if (form.ShowDialog() == DialogResult.OK)
            {
                AddTeechipAccount(form.TextBoxUsername.Text, form.TextBoxPassword.Text);
            }
        }

        private void ButtonRemoveTeechipAccount_Click(object sender, EventArgs e)
        {
            if (ComboBoxTeechipAccounts.SelectedItem == null)
            {
                return;
            }

            var account = (KeyValuePair<string, string>) ComboBoxTeechipAccounts.SelectedItem;

            var accounts = ComboBoxTeechipAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();
            accounts.Remove(account);
            ComboBoxTeechipAccounts.DataSource = null;
            ComboBoxTeechipAccounts.DataSource = accounts;
            ComboBoxTeechipAccounts.DisplayMember = "Key";
            ComboBoxTeechipAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var acc in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(acc.Key, TeechipUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(acc.Value, TeechipPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teechip/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonImportTeechipAccounts_Click(object sender, EventArgs e)
        {
            ImportAccounts(AddTeechipAccount);
        }

        private void ButtonRemoveAllTeechipAccounts_Click(object sender, EventArgs e)
        {
            ComboBoxTeechipAccounts.DataSource = null;
            File.Delete("Platform/Teechip/Accounts.txt");
        }

        private void ComboBoxTeechipAccounts_SelectedIndexChanged(object sender, EventArgs e)
        {
            teechipCookies = null;
        }

        private void CheckedListBoxTeechipProducts_ItemCheck(object sender, ItemCheckEventArgs e)
        {
            if (e.NewValue == CheckState.Checked)
            {
                // Add
                var productControl = new TeechipProduct();
                productControl.SetProduct((string) teechipProductsInfo.Products[e.Index], teechipProductsInfo);
                productControl.Tag = e.Index;
                productControl.IsDefaultChanged += Teechip_IsDefaultChanged;
                FlowLayoutTeechip.Controls.Add(productControl);
            }
            else
            {
                // Remove
                foreach (Control control in FlowLayoutTeechip.Controls)
                {
                    if (control is TeechipProduct && (int) control.Tag == e.Index)
                    {
                        (control as TeechipProduct).IsDefaultChanged -= Teechip_IsDefaultChanged;
                        FlowLayoutTeechip.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                }
            }
        }

        private void InitTeechip()
        {
            LoadTeechipProducts(FlowLayoutTeechip);
            LoadTeechipAccounts();
            for (var i = 0; i < CheckedListBoxTeechipProducts.Items.Count; i++)
            {
                CheckedListBoxTeechipProducts.SetItemChecked(i, true);
                CheckedListBoxTeechipProducts.SetItemChecked(i, false);
            }
        }

        private void LoadTeechipProducts(Control container)
        {
            if (container == null)
            {
                return;
            }

            teechipProductsInfo = Teechip.GetProductsInfo();
            if (teechipProductsInfo != null)
            {
                // Create products
                var removedProducts = new List<string>();
                var hasCase = false;
                foreach (var product in teechipProductsInfo.Products)
                {
                    if (teechipProductsInfo.GetProductType((string) product).Equals("case", StringComparison.OrdinalIgnoreCase))
                    {
                        if (hasCase)
                        {
                            removedProducts.Add((string) product);
                            continue;
                        }

                        hasCase = true;
                    }

                    CheckedListBoxTeechipProducts.Items.Add(teechipProductsInfo.GetProductName((string) product));
                }
                foreach (var product in removedProducts)
                {
                    foreach (var p in teechipProductsInfo.Products)
                    {
                        if ((string) p == product)
                        {
                            p.Remove();
                            break;
                        }
                    }
                }
            }
            else
            {
                MessageBox.Show(
                                @"Error happens when connect to Teechip server. Please check your Internet connection and run application again.
You can upload to other platforms also.",
                                "Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
            }
        }

        private void LoadTeechipAccounts()
        {
            if (!File.Exists("Platform/Teechip/Accounts.txt"))
            {
                return;
            }

            var content = File.ReadAllText("Platform/Teechip/Accounts.txt");
            var json = JsonConvert.DeserializeObject<JToken>(content);

            var accounts = new List<KeyValuePair<string, string>>();
            foreach (var acc in json)
            {
                try
                {
                    var username = acc["Username"].ToObject<string>();
                    var password = acc["Password"].ToObject<string>();
                    var index = username.IndexOf('=');
                    while (index < username.Length - 1 && username[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltUsername = username.Substring(0, index);
                    username = Common.Decrypt(username.Substring(index + 1), TeechipUsernameEncryptionKey, saltUsername);
                    index = password.IndexOf('=');
                    while (index < password.Length - 1 && password[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltPassword = password.Substring(0, index);
                    password = Common.Decrypt(password.Substring(index + 1), TeechipPasswordEncryptionKey, saltPassword);
                    accounts.Add(new KeyValuePair<string, string>(username, password));
                }
                catch (Exception exc)
                {
                }
            }

            ComboBoxTeechipAccounts.DataSource = accounts;
        }

        private (bool Result, string Message, string[] Links) UploadTeechip(
            Image image,
            string path,
            Image backImage,
            string backPath,
            string frontLeftAlign,
            string frontTopAlign,
            string backLeftAlign,
            string backTopAlign,
            string title,
            string description,
            int duration,
            string url,
            bool isPrivate,
            bool autoRestart,
            string facebookPixel,
            string googleAnalytics)
        {
            if (licenseData?["teechip"] == null)
            {
                return (false, "You don't have license of Teechip.", null);
            }
            if (teechipCookies == null)
            {
                return (false, "You didn't login to Teechip. Please check your Teechip account.", null);
            }

            if (string.IsNullOrEmpty(path) && string.IsNullOrEmpty(backPath))
            {
                return (false, "There are no images to upload.", null);
            }

            title = Truncate(title, 50);
            description = Truncate(description, 1500);
            url = Truncate(url, 50);

            var printableFront = new double[4] {0, 0, double.MaxValue, double.MaxValue};
            var printableBack = new double[4] {0, 0, double.MaxValue, double.MaxValue};
            var mugPrintableFront = new double[4];
            var casePrintableFront = new double[4];
            var posterPrintableFront = new double[4];
            var products = new List<TeechipProductItem>();
            var totalColorsCount = 0;
            var totalGoal = 0;
            var hasGarment = false;
            var hasMug = false;
            var hasPoster = false;
            var hasCase = false;
            foreach (var control in FlowLayoutTeechip.Controls)
            {
                if (control is TeechipProduct)
                {
                    var teechipProduct = (TeechipProduct) control;
                    if (teechipProduct.SelectedColors.Count > 0)
                    {
                        totalColorsCount += teechipProduct.SelectedColors.Count;

                        var minimum = teechipProductsInfo.GetPrice(teechipProduct.ProductId, image != null && backImage != null);
                        var price = teechipProduct.NumericUpDownPrice.Value;
                        if (price < minimum)
                        {
                            price = minimum;
                        }

                        var product = new TeechipProductItem
                                      {
                                          ScalableId = teechipProduct.ProductType.Equals("case", StringComparison.OrdinalIgnoreCase)
                                                           ? "phone-case"
                                                           : teechipProduct.ProductId,
                                          Colors = teechipProduct.SelectedColors.ToArray(),
                                          Price = price,
                                          Goal = 1
                                      };
                        if (teechipProduct.CheckBoxIsDefault.Checked)
                        {
                            products.Insert(0, product);
                        }
                        else
                        {
                            products.Add(product);
                        }

                        ++totalGoal;

                        var printableArea = Teechip.GetPrintableArea(teechipProduct.ProductId, true, teechipProduct.ProductType);

                        if (teechipProduct.ProductType.Equals("garment", StringComparison.OrdinalIgnoreCase))
                        {
                            hasGarment = true;

                            printableFront[2] = Math.Min(printableFront[2], teechipProduct.BaseImage.Width * printableArea[2]);
                            printableFront[3] = Math.Min(printableFront[3], teechipProduct.BaseImage.Height * printableArea[3]);
                            printableFront[1] = Math.Max(printableFront[1], teechipProduct.BaseImage.Height * printableArea[0]);
                            printableFront[0] =
                                Math.Max(printableFront[0], (teechipProduct.BaseImage.Width - printableFront[2]) / 2 + teechipProduct.BaseImage.Width * printableArea[1]);
                            printableFront[2] -= printableFront[2] * Math.Abs(printableArea[4]);
                            if (printableArea[4] > 0)
                            {
                                printableFront[0] += teechipProduct.BaseImage.Width * printableArea[4];
                            }

                            if (!string.IsNullOrEmpty(backPath))
                            {
                                printableArea = Teechip.GetPrintableArea(teechipProduct.ProductId, false, teechipProduct.ProductType);
                                printableBack[2] = Math.Min(printableBack[2], teechipProduct.BaseBackImage.Width * printableArea[2]);
                                printableBack[3] = Math.Min(printableBack[3], teechipProduct.BaseBackImage.Height * printableArea[3]);
                                printableBack[1] = Math.Min(printableBack[1], teechipProduct.BaseBackImage.Height * printableArea[0]);
                                printableBack[0] = Math.Min(
                                                            printableBack[0],
                                                            (teechipProduct.BaseBackImage.Width - printableBack[2]) / 2 +
                                                            teechipProduct.BaseBackImage.Width * printableArea[1]);
                                printableBack[2] -= printableBack[2] * Math.Abs(printableArea[4]);
                                if (printableArea[4] > 0)
                                {
                                    printableBack[0] += teechipProduct.BaseBackImage.Width * printableArea[4];
                                }
                            }
                        }
                        if (teechipProduct.ProductType.Equals("mug", StringComparison.OrdinalIgnoreCase))
                        {
                            hasMug = true;

                            mugPrintableFront[2] = teechipProduct.BaseImage.Width * printableArea[2];
                            mugPrintableFront[3] = teechipProduct.BaseImage.Height * printableArea[3];
                            mugPrintableFront[1] = teechipProduct.BaseImage.Height * printableArea[0];
                            mugPrintableFront[0] = (teechipProduct.BaseImage.Width - mugPrintableFront[2]) / 2 + teechipProduct.BaseImage.Width * printableArea[1];
                            mugPrintableFront[2] -= mugPrintableFront[2] * Math.Abs(printableArea[4]);
                            if (printableArea[4] > 0)
                            {
                                mugPrintableFront[0] += teechipProduct.BaseImage.Width * printableArea[4];
                            }
                        }
                        if (teechipProduct.ProductType.Equals("case", StringComparison.OrdinalIgnoreCase))
                        {
                            hasCase = true;

                            casePrintableFront[2] = teechipProduct.BaseImage.Width * printableArea[2];
                            casePrintableFront[3] = teechipProduct.BaseImage.Height * printableArea[3];
                            casePrintableFront[1] = teechipProduct.BaseImage.Height * printableArea[0];
                            casePrintableFront[0] = (teechipProduct.BaseImage.Width - casePrintableFront[2]) / 2 + teechipProduct.BaseImage.Width * printableArea[1];
                            casePrintableFront[2] -= casePrintableFront[2] * Math.Abs(printableArea[4]);
                            if (printableArea[4] > 0)
                            {
                                casePrintableFront[0] += teechipProduct.BaseImage.Width * printableArea[4];
                            }
                        }
                        if (teechipProduct.ProductType.Equals("poster", StringComparison.OrdinalIgnoreCase))
                        {
                            hasPoster = true;

                            posterPrintableFront[2] = teechipProduct.BaseImage.Width * printableArea[2];
                            posterPrintableFront[3] = teechipProduct.BaseImage.Height * printableArea[3];
                            posterPrintableFront[1] = teechipProduct.BaseImage.Height * printableArea[0];
                            posterPrintableFront[0] = (teechipProduct.BaseImage.Width - posterPrintableFront[2]) / 2 + teechipProduct.BaseImage.Width * printableArea[1];
                            posterPrintableFront[2] -= posterPrintableFront[2] * Math.Abs(printableArea[4]);
                            if (printableArea[4] > 0)
                            {
                                posterPrintableFront[0] += teechipProduct.BaseImage.Width * printableArea[4];
                            }
                        }
                    }
                }
            }

            if (totalColorsCount == 0)
            {
                return (false, "Teechip - You must select at least 1 garment and color.", null);
            }

            if (totalColorsCount > 16)
            {
                return (false, "Teechip - You cannot select more than 16 garment and color combinations.", null);
            }

            var input = string.IsNullOrEmpty(path) ? null : new FileStream(path, FileMode.Open, FileAccess.Read);
            var frontImageResult = input == null ? null : Teechip.UploadImage(path, input, teechipCookies);
            input?.Close();
            if (!string.IsNullOrEmpty(path) && frontImageResult == null)
            {
                return (false, "Teechip - Upload front image failed. Maybe it's too small.", null);
            }

            input = string.IsNullOrEmpty(backPath) ? null : new FileStream(backPath, FileMode.Open, FileAccess.Read);
            var backImageResult = input == null ? null : Teechip.UploadImage(backPath, input, teechipCookies);
            input?.Close();
            if (!string.IsNullOrEmpty(backPath) && backImageResult == null)
            {
                return (false, "Teechip - Upload back image failed. Maybe it's too small.", null);
            }

            var teechipItem = new TeechipItem()
                              {
                                  Title = title,
                                  Description = description,
                                  Url = url,
                                  Duration = duration,
                                  IsPrivate = isPrivate,
                                  AutoRestart = autoRestart
                              };

            var designs = new List<TeechipDesign>();
            if (frontImageResult != null)
            {
                // Download proceeded design image
                var stream = new MemoryStream();
                Common.DownloadFile(frontImageResult["designUrl"].ToObject<string>(), stream);
                image = Image.FromStream(stream);
                stream.Dispose();

                if (hasGarment)
                {
                    var scale = 1D;
                    if (image.Width > printableFront[2] || image.Height > printableFront[3])
                    {
                        var xScale = printableFront[2] / image.Width;
                        var yScale = printableFront[3] / image.Height;
                        scale = Math.Min(xScale, yScale);
                    }
                    var width = image.Width * scale;
                    var height = image.Height * scale;

                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        printableFront[0] += printableFront[2] / 2 - width / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        printableFront[0] += printableFront[2] - width;
                    }
                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        printableFront[1] += printableFront[3] / 2 - height / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        printableFront[1] += printableFront[3] - height;
                    }

                    var design = new TeechipDesign()
                                 {
                                     Url = frontImageResult["designUrl"].ToObject<string>(),
                                     ColorCount = licenseData["teechip"]["frontColorCount"].ToObject<int>(),
                                     Side = licenseData["teechip"]["frontSide"].ToObject<string>(),
                                     Type = licenseData["teechip"]["frontTypeGarment"].ToObject<string>(),
                                     OriginalArtworkUrl = frontImageResult["originalArtworkUrl"].ToObject<string>(),
                                     ThumbnailUrl = frontImageResult["thumbnailUrl"].ToObject<string>(),
                                     Metrics = new TeechipMetrics()
                                               {
                                                   DesignWidth = width,
                                                   DesignHeight = height,
                                                   OffsetLeft = printableFront[0],
                                                   OffsetTop = printableFront[1]
                                               }
                                 };
                    designs.Add(design);
                }
                if (hasMug)
                {
                    var scale = 1D;
                    if (image.Width > mugPrintableFront[2] || image.Height > mugPrintableFront[3])
                    {
                        var xScale = mugPrintableFront[2] / image.Width;
                        var yScale = mugPrintableFront[3] / image.Height;
                        scale = Math.Min(xScale, yScale);
                    }
                    var width = image.Width * scale;
                    var height = image.Height * scale;

                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        mugPrintableFront[0] += mugPrintableFront[2] / 2 - width / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        mugPrintableFront[0] += mugPrintableFront[2] - width;
                    }
                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        mugPrintableFront[1] += mugPrintableFront[3] / 2 - height / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        mugPrintableFront[1] += mugPrintableFront[3] - height;
                    }

                    var design = new TeechipDesign()
                                 {
                                     Url = frontImageResult["designUrl"].ToObject<string>(),
                                     ColorCount = licenseData["teechip"]["frontColorCount"].ToObject<int>(),
                                     Side = licenseData["teechip"]["frontSide"].ToObject<string>(),
                                     Type = licenseData["teechip"]["frontTypeMug"].ToObject<string>(),
                                     OriginalArtworkUrl = frontImageResult["originalArtworkUrl"].ToObject<string>(),
                                     ThumbnailUrl = frontImageResult["thumbnailUrl"].ToObject<string>(),
                                     Metrics = new TeechipMetrics()
                                               {
                                                   DesignWidth = width,
                                                   DesignHeight = height,
                                                   OffsetLeft = mugPrintableFront[0],
                                                   OffsetTop = mugPrintableFront[1]
                                               }
                                 };
                    designs.Add(design);
                }
                if (hasCase)
                {
                    var scale = 1D;
                    if (image.Width > casePrintableFront[2] || image.Height > casePrintableFront[3])
                    {
                        var xScale = casePrintableFront[2] / image.Width;
                        var yScale = casePrintableFront[3] / image.Height;
                        scale = Math.Min(xScale, yScale);
                    }
                    var width = image.Width * scale;
                    var height = image.Height * scale;

                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        casePrintableFront[0] += casePrintableFront[2] / 2 - width / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        casePrintableFront[0] += casePrintableFront[2] - width;
                    }
                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        casePrintableFront[1] += casePrintableFront[3] / 2 - height / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        casePrintableFront[1] += casePrintableFront[3] - height;
                    }

                    var design = new TeechipDesign()
                                 {
                                     Url = frontImageResult["designUrl"].ToObject<string>(),
                                     ColorCount = licenseData["teechip"]["frontColorCount"].ToObject<int>(),
                                     Side = licenseData["teechip"]["frontSide"].ToObject<string>(),
                                     Type = licenseData["teechip"]["frontTypeCase"].ToObject<string>(),
                                     OriginalArtworkUrl = frontImageResult["originalArtworkUrl"].ToObject<string>(),
                                     ThumbnailUrl = frontImageResult["thumbnailUrl"].ToObject<string>(),
                                     Metrics = new TeechipMetrics()
                                               {
                                                   DesignWidth = width,
                                                   DesignHeight = height,
                                                   OffsetLeft = casePrintableFront[0],
                                                   OffsetTop = casePrintableFront[1]
                                               }
                                 };
                    designs.Add(design);
                }
                if (hasPoster)
                {
                    var scale = 1D;
                    if (image.Width > posterPrintableFront[2] || image.Height > posterPrintableFront[3])
                    {
                        var xScale = posterPrintableFront[2] / image.Width;
                        var yScale = posterPrintableFront[3] / image.Height;
                        scale = Math.Min(xScale, yScale);
                    }
                    var width = image.Width * scale;
                    var height = image.Height * scale;

                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        posterPrintableFront[0] += posterPrintableFront[2] / 2 - width / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        posterPrintableFront[0] += posterPrintableFront[2] - width;
                    }
                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        posterPrintableFront[1] += posterPrintableFront[3] / 2 - height / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        posterPrintableFront[1] += posterPrintableFront[3] - height;
                    }

                    var design = new TeechipDesign()
                                 {
                                     Url = frontImageResult["designUrl"].ToObject<string>(),
                                     ColorCount = licenseData["teechip"]["frontColorCount"].ToObject<int>(),
                                     Side = licenseData["teechip"]["frontSide"].ToObject<string>(),
                                     Type = licenseData["teechip"]["frontTypePoster"].ToObject<string>(),
                                     OriginalArtworkUrl = frontImageResult["originalArtworkUrl"].ToObject<string>(),
                                     ThumbnailUrl = frontImageResult["thumbnailUrl"].ToObject<string>(),
                                     Metrics = new TeechipMetrics()
                                               {
                                                   DesignWidth = width,
                                                   DesignHeight = height,
                                                   OffsetLeft = posterPrintableFront[0],
                                                   OffsetTop = posterPrintableFront[1]
                                               }
                                 };
                    designs.Add(design);
                }

                image.Dispose();
            }
            if (backImageResult != null)
            {
                var stream = new MemoryStream();
                Common.DownloadFile(backImageResult["designUrl"].ToObject<string>(), stream);
                backImage = Image.FromStream(stream);
                stream.Dispose();

                var scale = 1D;
                if (backImage.Width > printableBack[2] || backImage.Height > printableBack[3])
                {
                    var xScale = printableBack[2] / backImage.Width;
                    var yScale = printableBack[3] / backImage.Height;
                    scale = Math.Min(xScale, yScale);
                }
                var width = backImage.Width * scale;
                var height = backImage.Height * scale;

                if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                {
                    printableBack[0] += printableBack[2] / 2 - width / 2;
                }
                else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    printableBack[0] += printableBack[2] - width;
                }
                if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                {
                    printableBack[1] += printableBack[3] / 2 - height / 2;
                }
                else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    printableBack[1] += printableBack[3] - height;
                }

                var design = new TeechipDesign()
                             {
                                 Url = backImageResult["designUrl"].ToObject<string>(),
                                 ColorCount = licenseData["teechip"]["backColorCount"].ToObject<int>(),
                                 Side = licenseData["teechip"]["backSide"].ToObject<string>(),
                                 Type = licenseData["teechip"]["backTypeGarment"].ToObject<string>(),
                                 OriginalArtworkUrl = backImageResult["originalArtworkUrl"].ToObject<string>(),
                                 ThumbnailUrl = backImageResult["thumbnailUrl"].ToObject<string>(),
                                 Metrics = new TeechipMetrics()
                                           {
                                               DesignWidth = width,
                                               DesignHeight = height,
                                               OffsetLeft = printableBack[0],
                                               OffsetTop = printableBack[1]
                                           }
                             };
                if (hasGarment)
                {
                    designs.Add(design);
                }

                backImage.Dispose();
            }

            foreach (var product in products)
            {
                if (product.ScalableId != null && product.ScalableId.ToLower().Contains("gloss-poster"))
                {
                    product.Designs = designs.Where(x => x.Type == "poster").ToArray();
                }
                else if (product.ScalableId != null && product.ScalableId.ToLower().Contains("case"))
                {
                    product.Designs = designs.Where(x => x.Type == "case").ToArray();
                }
                else if (product.ScalableId != null && product.ScalableId.ToLower().Contains("mug"))
                {
                    product.Designs = designs.Where(x => x.Type == "mug").ToArray();
                }
                else
                {
                    product.Designs = designs.Where(x => x.Type == "garment").ToArray();
                }
            }

            teechipItem.Products = products.ToArray();
            teechipItem.Designs = designs.ToArray();
            teechipItem.Goal = totalGoal;

            var result = Teechip.Upload(teechipItem, teechipCookies);
            if (!string.IsNullOrEmpty(result) && result.Equals("OK", StringComparison.OrdinalIgnoreCase))
            {
                if (!string.IsNullOrEmpty(facebookPixel) || !string.IsNullOrEmpty(googleAnalytics))
                {
                    var updateResult = Teechip.UpdateCampaign(url, facebookPixel, googleAnalytics, teechipCookies);
                }
                return (true, "Teechip - Upload to Teechip successfully.", new string[] {$"https://teechip.com/{url}"});
            }

            return (false, "Teechip - Error happens while uploading design. Please check information and price. Detail error: " +
                           (string.IsNullOrEmpty(result) ? "" : result), null);
        }

#endif

        #endregion

        #region Platform Teespring

#if TEESPRING

        private const string TeespringUsernameEncryptionKey = "GGQVAIOdegzDUna7mJhOjJzkWzollLpivTJsVAom30QtHc3L2I3RY4pPR0cH";
        private const string TeespringPasswordEncryptionKey = "HfaOjfhKPGe2MmaB7R1yzX5mtIQ8qBfwpPlP6u8ln6NglWa4FwQCAqm7puqN";

        private void Teespring_IsDefaultChanged(object sender, EventArgs e)
        {
            var productControl = sender as TeespringProduct;
            if (productControl == null)
            {
                var newProductControl = sender as TeespringNewProduct;
                if (newProductControl == null || newProductControl.CheckBoxIsDefault.Checked == false)
                {
                    return;
                }
            }
            else if (productControl.CheckBoxIsDefault.Checked == false)
            {
                return;
            }

            foreach (Control control in FlowLayoutTeespring.Controls)
            {
                if (control is TeespringProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as TeespringProduct).CheckBoxIsDefault.Checked = false;
                }
                else if (control is TeespringNewProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as TeespringNewProduct).CheckBoxIsDefault.Checked = false;
                }
            }
        }

        private void CheckBoxTeespring_CheckedChanged(object sender, EventArgs e)
        {
            LabelTeespringAccounts.Enabled = CheckBoxTeespring.Checked;
            ComboBoxTeespringAccounts.Enabled = CheckBoxTeespring.Checked;
            ButtonAddTeespringAccount.Enabled = CheckBoxTeespring.Checked;
            ButtonRemoveTeespringAccount.Enabled = CheckBoxTeespring.Checked;
            ButtonImportTeespringAccounts.Enabled = CheckBoxTeespring.Checked;
            ButtonRemoveAllTeespringAccounts.Enabled = CheckBoxTeespring.Checked;
        }

        private void ComboBoxTeespringAccounts_SelectedIndexChanged(object sender, EventArgs e)
        {
            teespringCookies = null;
        }

        private void AddTeespringAccount(string username, string password)
        {
            // Save to Teespring accounts
            if (!Directory.Exists("Platform/Teespring"))
            {
                Directory.CreateDirectory("Platform/Teespring");
            }

            var accounts = ComboBoxTeespringAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();

            if (accounts.Exists(x => x.Key.ToLower() == username.ToLower()))
            {
                MessageBox.Show("This account is already added.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            accounts.Add(new KeyValuePair<string, string>(username, password));
            ComboBoxTeespringAccounts.DataSource = null;
            ComboBoxTeespringAccounts.DataSource = accounts;
            ComboBoxTeespringAccounts.DisplayMember = "Key";
            ComboBoxTeespringAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var account in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(account.Key, TeespringUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(account.Value, TeespringPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teespring/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonAddTeespringAccount_Click(object sender, EventArgs e)
        {
            var form = new FormAddAccount();
            if (form.ShowDialog() == DialogResult.OK)
            {
                AddTeespringAccount(form.TextBoxUsername.Text, form.TextBoxPassword.Text);
            }
        }

        private void ButtonRemoveTeespringAccount_Click(object sender, EventArgs e)
        {
            if (ComboBoxTeespringAccounts.SelectedItem == null)
            {
                return;
            }

            var account = (KeyValuePair<string, string>) ComboBoxTeespringAccounts.SelectedItem;

            var accounts = ComboBoxTeespringAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();
            accounts.Remove(account);
            ComboBoxTeespringAccounts.DataSource = null;
            ComboBoxTeespringAccounts.DataSource = accounts;
            ComboBoxTeespringAccounts.DisplayMember = "Key";
            ComboBoxTeespringAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var acc in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(acc.Key, TeespringUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(acc.Value, TeespringPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teespring/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonImportTeespringAccounts_Click(object sender, EventArgs e)
        {
            ImportAccounts(AddTeespringAccount);
        }

        private void ButtonRemoveAllTeespringAccounts_Click(object sender, EventArgs e)
        {
            ComboBoxTeespringAccounts.DataSource = null;
            File.Delete("Platform/Teespring/Accounts.txt");
        }

        private void ComboBoxTeespringRegion_SelectedIndexChanged(object sender, EventArgs e)
        {
            // Reload products
            var needToClose = false;
            if (!loadingForm.Visible && !BackgroundWorkerInit.IsBusy)
            {
                needToClose = true;
                Cursor = Cursors.WaitCursor;
                Enabled = false;
                BackgroundWorkerInit.RunWorkerAsync();
            }

            for (var i = 0; i < CheckedListBoxTeespringProducts.Items.Count; i++)
            {
                CheckedListBoxTeespringProducts.SetItemChecked(i, false);
            }

            CheckedListBoxTeespringProducts.Items.Clear();
            if (teespringCookies == null)
            {
                teespringCookies = new CookieContainer();
                if (ComboBoxTeespringAccounts.Items.Count > 0)
                {
                    // Login
                    var selectedTeespringAccount =
                        (KeyValuePair<string, string>?) ComboBoxTeespringAccounts.Items
                            [ComboBoxTeespringAccounts.SelectedIndex > -1 ? ComboBoxTeespringAccounts.SelectedIndex : 0]
                        ?? new KeyValuePair<string, string>();
                    teespringCookies = Teespring.Login(selectedTeespringAccount.Key, selectedTeespringAccount.Value, teespringCookies) ?? new CookieContainer();
                }
            }
            LoadTeespringProducts(FlowLayoutTeespring);
            LoadTeespringInks();
            for (var i = 0; i < CheckedListBoxTeespringProducts.Items.Count; i++)
            {
                CheckedListBoxTeespringProducts.SetItemChecked(i, true);
                CheckedListBoxTeespringProducts.SetItemChecked(i, false);
            }

            if (needToClose)
            {
                Cursor = Cursors.Default;
                Enabled = true;
                if (loadingForm.InvokeRequired)
                {
                    loadingForm.Invoke(new MethodInvoker(delegate { loadingForm.Close(); }));
                }
                else
                {
                    loadingForm.Close();
                }
            }
        }

        private void CheckedListBoxTeespringProducts_ItemCheck(object sender, ItemCheckEventArgs e)
        {
            if (e.NewValue == CheckState.Checked)
            {
                // Add
                var productInfo = teespringProductsInfo["products"].ToObject<JArray>()[e.Index];
                if (productInfo["IsNewProduct"] != null && productInfo["IsNewProduct"].ToObject<bool>())
                {
                    var productControl = new TeespringNewProduct();
                    productControl.SetProduct(teespringProductsInfo["products"].ToObject<JArray>()[e.Index], teespringProductsInfo, teespringBootstrap);
                    productControl.Tag = e.Index;
                    productControl.IsDefaultChanged += Teespring_IsDefaultChanged;
                    FlowLayoutTeespring.Controls.Add(productControl);
                }
                else
                {
                    var productControl = new TeespringProduct();
                    productControl.SetProduct(teespringProductsInfo["products"].ToObject<JArray>()[e.Index], teespringProductsInfo, teespringBootstrap);
                    productControl.Tag = e.Index;
                    productControl.IsDefaultChanged += Teespring_IsDefaultChanged;
                    FlowLayoutTeespring.Controls.Add(productControl);

                    // Get price
                    var product = WebUtility.UrlEncode(
                                                       JsonConvert.SerializeObject(
                                                                                   new[]
                                                                                   {
                                                                                       new Dictionary<string, object>()
                                                                                       {
                                                                                           {
                                                                                               "product_id",
                                                                                               teespringProductsInfo["products"].ToObject<JArray>()[e.Index]["id"]
                                                                                                                                .ToObject<string>()
                                                                                           },
                                                                                           {
                                                                                               "color_id",
                                                                                               teespringProductsInfo["products"]
                                                                                                   .ToObject<JArray>()[e.Index]["colors_available"]
                                                                                                   .ToObject<JArray>()[0]
                                                                                           }
                                                                                       }
                                                                                   }));
                    if (teespringCookies == null)
                    {
                        teespringCookies = new CookieContainer();
                    }
                    var teespringRegion = ComboBoxTeespringRegion.SelectedItem as string ?? "USA";
                    var prices = Teespring.GetCost(teespringCookies, 1, product, null, null, teespringRegion, "USD");
                    if (prices != null)
                    {
                        productControl.SetDefaultPrice(prices[0]["minimum_price"].ToObject<decimal>(), prices[0]["recommended_price"].ToObject<decimal>());
                    }
                }
            }
            else
            {
                // Remove
                foreach (Control control in FlowLayoutTeespring.Controls)
                {
                    if (control is TeespringProduct && (int) control.Tag == e.Index)
                    {
                        (control as TeespringProduct).IsDefaultChanged -= Teespring_IsDefaultChanged;
                        FlowLayoutTeespring.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                    else if (control is TeespringNewProduct && (int) control.Tag == e.Index)
                    {
                        (control as TeespringNewProduct).IsDefaultChanged -= Teespring_IsDefaultChanged;
                        FlowLayoutTeespring.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                }
            }
        }

        private void InitTeespring()
        {
            LoadTeespringAccounts();
            var categories = LoadTeespringCategories();
            foreach (var cat in categories)
            {
                TeespringCategory.Items.Add(cat);
            }

            TeespringCategory.DisplayMember = "Value";
            TeespringCategory.ValueMember = "Key";

            ComboBoxTeespringRegion.SelectedIndex = 0;
        }

        private List<KeyValuePair<string, string>> LoadTeespringCategories()
        {
            //if (teespringCookies == null)
            //{
            //    teespringCookies = new CookieContainer();
            //    if (ComboBoxTeespringAccounts.Items.Count > 0)
            //    {
            //        var selectedTeespringAccount =
            //            (KeyValuePair<string, string>?) ComboBoxTeespringAccounts.Items
            //                [ComboBoxTeespringAccounts.SelectedIndex > -1 ? ComboBoxTeespringAccounts.SelectedIndex : 0]
            //            ?? new KeyValuePair<string, string>();
            //        teespringCookies = Teespring.Login(selectedTeespringAccount.Key, selectedTeespringAccount.Value, teespringCookies);
            //    }
            //}
            var result = new List<KeyValuePair<string, string>>();
            var categoriesResult = Teespring.GetCategories(new CookieContainer());
            if (categoriesResult == null)
            {
                return result;
            }

            var categories = categoriesResult["categories"];
            foreach (var category in categories.Where(x => x["parent_category_id"].ToObject<string>() == null
                                                           || x["parent_category_id"].ToObject<string>() == x["id"].ToObject<string>()))
            {
                if (result.Any(x => x.Key == category["id"].ToObject<string>()))
                {
                    continue;
                }
                result.Add(new KeyValuePair<string, string>(category["id"].ToObject<string>(), category["display_name"].ToObject<string>()));
                foreach (var child in categories.Where(x => x["parent_category_id"].ToObject<string>() == category["id"].ToObject<string>()))
                {
                    if (result.Any(x => x.Key == child["id"].ToObject<string>()))
                    {
                        continue;
                    }
                    result.Add(new KeyValuePair<string, string>(child["id"].ToObject<string>(), new string('-', 10) + " " + child["display_name"].ToObject<string>()));
                }
            }

            return result;
        }

        private void LoadTeespringProducts(Control container)
        {
            if (container == null)
            {
                return;
            }

            if (teespringCookies == null)
            {
                teespringCookies = new CookieContainer();
                if (ComboBoxTeespringAccounts.Items.Count > 0)
                {
                    var selectedTeespringAccount =
                        (KeyValuePair<string, string>?) ComboBoxTeespringAccounts.Items
                            [ComboBoxTeespringAccounts.SelectedIndex > -1 ? ComboBoxTeespringAccounts.SelectedIndex : 0]
                        ?? new KeyValuePair<string, string>();
                    teespringCookies = Teespring.Login(selectedTeespringAccount.Key, selectedTeespringAccount.Value, teespringCookies) ?? new CookieContainer();
                }
            }

            var teespringRegion = ComboBoxTeespringRegion.SelectedItem as string ?? "USA";

            teespringBootstrap = Teespring.GetBootstrap(teespringCookies);
            teespringProductsInfo = Teespring.GetProducts(teespringCookies, teespringRegion);
            if (teespringProductsInfo != null)
            {
                // Create products
                foreach (var product in teespringProductsInfo["products"].ToObject<JArray>())
                {
                    CheckedListBoxTeespringProducts.Items.Add(product["name"].ToObject<string>());
                }
            }
            else
            {
                MessageBox.Show(
                                @"Error happens when connect to Teespring server. Please check your Internet connection and run application again.
You can upload to other platforms also.",
                                @"Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
            }
        }

        private void LoadTeespringAccounts()
        {
            if (!File.Exists("Platform/Teespring/Accounts.txt"))
            {
                return;
            }

            var content = File.ReadAllText("Platform/Teespring/Accounts.txt");
            var json = JsonConvert.DeserializeObject<JToken>(content);

            var accounts = new List<KeyValuePair<string, string>>();
            foreach (var acc in json)
            {
                try
                {
                    var username = acc["Username"].ToObject<string>();
                    var password = acc["Password"].ToObject<string>();
                    var index = username.IndexOf('=');
                    while (index < username.Length - 1 && username[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltUsername = username.Substring(0, index);
                    username = Common.Decrypt(username.Substring(index + 1), TeespringUsernameEncryptionKey, saltUsername);
                    index = password.IndexOf('=');
                    while (index < password.Length - 1 && password[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltPassword = password.Substring(0, index);
                    password = Common.Decrypt(password.Substring(index + 1), TeespringPasswordEncryptionKey, saltPassword);
                    accounts.Add(new KeyValuePair<string, string>(username, password));
                }
                catch (Exception exc)
                {
                }
            }

            ComboBoxTeespringAccounts.DataSource = accounts;
        }

        private void LoadTeespringInks()
        {
            var inks = Teespring.GetInks(teespringCookies);
            teespringPalette = new List<Color>();
            if (inks == null)
            {
                return;
            }

            foreach (var ink in inks["inks"].ToObject<JArray>())
            {
                if (ink["inStock"].ToObject<bool>())
                {
                    teespringPalette.Add(
                                         Color.FromArgb(
                                                        ink["rgb"].ToObject<JArray>()[0].ToObject<int>(),
                                                        ink["rgb"].ToObject<JArray>()[1].ToObject<int>(),
                                                        ink["rgb"].ToObject<JArray>()[2].ToObject<int>()));
                }
            }
        }

        private Color[] GetColors(Image image)
        {
            var bitmap = new Bitmap(image);
            const int PixelWidth = 3;
            const PixelFormat PixelFormat = PixelFormat.Format24bppRgb;

            // En garde!
            var data = bitmap.LockBits(new Rectangle(0, 0, bitmap.Width, bitmap.Height), ImageLockMode.ReadOnly, PixelFormat);
            var colors = new int[data.Stride * data.Height];
            try
            {
                var pixelData = new byte[data.Stride];
                for (var scanline = 0; scanline < data.Height; scanline++)
                {
                    Marshal.Copy(data.Scan0 + (scanline * data.Stride), pixelData, 0, data.Stride);
                    for (var pixeloffset = 0; pixeloffset < data.Width; pixeloffset++)
                    {
                        // PixelFormat.Format32bppRgb means the data is stored
                        // in memory as BGR. We want RGB, so we must do some 
                        // bit-shuffling.
                        colors[(scanline * data.Stride) + pixeloffset] =
                            (pixelData[pixeloffset * PixelWidth + 2] << 16) + // R 
                            (pixelData[pixeloffset * PixelWidth + 1] << 8) + // G
                            pixelData[pixeloffset * PixelWidth]; // B
                    }
                }
            }
            finally
            {
                bitmap.UnlockBits(data);
            }

            return colors.Distinct().Select(Color.FromArgb).ToArray();
        }

        private double ColorDistance(Color color1, Color color2)
        {
            return Math.Sqrt(
                             Math.Pow((double) color1.R - color2.R, 2) +
                             Math.Pow((double) color1.G - color2.G, 2) +
                             Math.Pow((double) color1.B - color2.B, 2));
        }

        private Image SimplifyImage(Image source, List<Color> destPallete, out Color[] pallete, out Rectangle boundary)
        {
            var bitmap = new Bitmap(source);
            const int pixelWidth = 4;
            const PixelFormat pixelFormat = PixelFormat.Format32bppArgb;

            boundary = new Rectangle(-1, -1, 0, 0);

            var data = bitmap.LockBits(new Rectangle(0, 0, bitmap.Width, bitmap.Height), ImageLockMode.ReadOnly, pixelFormat);
            var colors = new int[data.Width * data.Height];
            var stillEmptyLine = true;
            try
            {
                var pixelData = new byte[data.Stride];
                for (var scanline = 0; scanline < data.Height; scanline++)
                {
                    Marshal.Copy(data.Scan0 + (scanline * data.Stride), pixelData, 0, data.Stride);
                    var emptyLine = true;
                    var startEmptyPixel = -1;
                    var endEmptyPixel = 0;
                    var stillEmptyPixel = true;
                    for (var pixeloffset = 0; pixeloffset < data.Width; pixeloffset++)
                    {
                        // PixelFormat.Format32bppRgb means the data is stored
                        // in memory as BGR. We want RGB, so we must do some 
                        // bit-shuffling.
                        colors[(scanline * data.Width) + pixeloffset] =
                            (pixelData[pixeloffset * pixelWidth + 3] << 24) + // A 
                            (pixelData[pixeloffset * pixelWidth + 2] << 16) + // R 
                            (pixelData[pixeloffset * pixelWidth + 1] << 8) + // G
                            pixelData[pixeloffset * pixelWidth]; // B

                        if (pixelData[pixeloffset * pixelWidth + 3] > 0)
                        {
                            emptyLine = false;
                            endEmptyPixel = 0;
                            stillEmptyPixel = false;
                        }
                        else
                        {
                            if (stillEmptyPixel)
                            {
                                startEmptyPixel = pixeloffset;
                            }
                            else
                            {
                                if (endEmptyPixel == 0)
                                {
                                    endEmptyPixel = pixeloffset;
                                }
                            }
                        }
                    }

                    boundary.X = boundary.X == -1 ? startEmptyPixel : Math.Min(boundary.X, startEmptyPixel);
                    boundary.Width = Math.Max(boundary.Width, endEmptyPixel);

                    if (emptyLine)
                    {
                        if (stillEmptyLine)
                        {
                            boundary.Y = scanline;
                        }
                        else if (boundary.Height == 0)
                        {
                            boundary.Height = scanline - boundary.Y - 1;
                        }
                    }
                    else
                    {
                        boundary.Height = 0;
                        stillEmptyLine = false;
                    }
                }
            }
            finally
            {
                bitmap.UnlockBits(data);
            }

            if (boundary.X == -1)
            {
                boundary.X = 0;
                boundary.Y = 0;
                boundary.Width = data.Width;
                boundary.Height = data.Height;
            }
            else
            {
                boundary.X += 1;
                boundary.Y += 1;
                if (boundary.Width == 0)
                {
                    boundary.Width = data.Width - boundary.X + 1;
                }
                else
                {
                    boundary.Width = boundary.Width - boundary.X;
                }
                if (boundary.Height == 0)
                {
                    boundary.Height = data.Height - boundary.Y + 1;
                }
            }

            var originalColors = colors.Select(x => x & 0xFFFFFF).Distinct().ToArray();
            var toRgbColors = new Color[originalColors.Length];
            for (var i = 0; i < originalColors.Length; i++)
            {
                var origin = Color.FromArgb(originalColors[i]);
                if (destPallete != null)
                {
                    var distance = double.MaxValue;
                    foreach (var c in destPallete)
                    {
                        var dis = ColorDistance(origin, c);
                        if (distance > dis)
                        {
                            distance = dis;
                            toRgbColors[i] = c;
                        }
                    }
                }
                else
                {
                    toRgbColors[i] = origin;
                }
            }

            // Update to image
            //var pixels = new byte[data.Stride * data.Height];
            //for (var i = 0; i < colors.Length; i++)
            //{
            //    var idx = Array.IndexOf(originalColors, colors[i] & 0xFFFFFF);
            //    if (idx >= 0)
            //    {
            //        colors[i] = (((colors[idx] >> 24) & 0xFF) << 24) + (toRgbColors[idx].R << 16) + (toRgbColors[idx].G << 8) + toRgbColors[idx].B;
            //    }

            //    pixels[i * pixelWidth + 3] = (byte)((colors[i] >> 24) & 0xFF); // A
            //    pixels[i * pixelWidth + 2] = (byte)((colors[i] >> 16) & 0xFF); // R
            //    pixels[i * pixelWidth + 1] = (byte)((colors[i] >> 8) & 0xFF); // G
            //    pixels[i * pixelWidth] = (byte)((colors[i]) & 0xFF); // B
            //}

            //var destImage = new Bitmap(data.Width, data.Height, pixelFormat);
            //data = destImage.LockBits(new Rectangle(0, 0, destImage.Width, destImage.Height), ImageLockMode.WriteOnly, pixelFormat);
            //try
            //{
            //    Marshal.Copy(pixels, 0, data.Scan0, pixels.Length);
            //}
            //finally
            //{
            //    destImage.UnlockBits(data);
            //}

            pallete = toRgbColors.Distinct().ToArray();

            bitmap.Dispose();
            data = null;
            colors = null;
            GC.Collect();
            GC.WaitForFullGCComplete();
            return new Bitmap(1, 1);
        }

        //private Image SimplifyPallete(Image sourceImage)
        //{
        //new DistinctSelectionQuantizer(),
        //new UniformQuantizer(),
        //new PopularityQuantizer(),
        //new MedianCutQuantizer(),
        //new OctreeQuantizer(),
        //new WuColorQuantizer(),
        //new NeuralColorQuantizer(),
        //new OptimalPaletteQuantizer()

        //new BayerDitherer4(),
        //new BayerDitherer8(),
        //new ClusteredDotDitherer(),
        //new DotHalfToneDitherer(),
        //new FanDitherer(),
        //new ShiauDitherer(),
        //new SierraDitherer(),
        //new StuckiDitherer(),
        //new BurkesDitherer(),
        //new AtkinsonDithering(),
        //new TwoRowSierraDitherer(),
        //new FloydSteinbergDitherer(),
        //new JarvisJudiceNinkeDitherer()

        //new EuclideanDistanceColorCache(),
        //new LshColorCache(),
        //new OctreeColorCache()

        //ColorModel.RedGreenBlue,
        //ColorModel.LabColorSpace,

        // quantization process
        //    var activeQuantizer = new MedianCutQuantizer();
        //    var targetImage = ImageBuffer.QuantizeImage(sourceImage, activeQuantizer, null, 256);

        //    return targetImage;
        //}

        private (bool Result, string Message, string[] Links) UploadTeespring(
            Image image,
            string path,
            Image backImage,
            string backPath,
            string frontLeftAlign,
            string frontTopAlign,
            string backLeftAlign,
            string backTopAlign,
            string title,
            string description,
            string keywords,
            string category,
            int duration,
            string url,
            int goal,
            bool autoRelaunch,
            bool isPrivate,
            string region,
            string facebookPixel,
            string googleAnalytics)
        {
            if (licenseData?["teespring"] == null)
            {
                return (false, "You don't have license of Teespring.", null);
            }
            if (teespringCookies == null)
            {
                return (false, "You didn't login to Teespring. Please check your Teespring account.", null);
            }

            if (string.IsNullOrEmpty(path) && string.IsNullOrEmpty(backPath))
            {
                return (false, "There are no images to upload.", null);
            }

            // Normalize info
            title = Truncate(title, 40);
            description = Truncate(description, 1500);
            url = Truncate(url, 30);

            var hasNewProduct = false;
            var hasOldProduct = false;
            foreach (var control in FlowLayoutTeespring.Controls)
            {
                if (control is TeespringProduct)
                {
                    if (((TeespringProduct) control).SelectedColors.Count > 0)
                    {
                        hasOldProduct = true;
                    }
                }
                else if (control is TeespringNewProduct)
                {
                    if (((TeespringNewProduct) control).SelectedColors.Count > 0)
                    {
                        hasNewProduct = true;
                    }
                }
            }

            if (!hasOldProduct && !hasNewProduct)
            {
                return (false, "Teespring - You must select at least 1 style and color.", null);
            }

            var campaignUrl = "";
            if (hasOldProduct)
            {
                var designId = Teespring.GetDesignId(teespringCookies);
                var bootstrap = Teespring.GetBootstrap(teespringCookies, designId);

                var teespringItem = new TeespringItem()
                                    {
                                        LookupId = designId,
                                        Name = title,
                                        Url = url,
                                        Description = description,
                                        Tags = keywords,
                                        Length = duration.ToString(),
                                        TippingPoint = goal,
                                        Region = region == "" ? "USA" : region,
                                        Currency = "USD",
                                        CategoryId = category,
                                        FacebookSnippet = facebookPixel
                                    };

                // left, top, width, height, chest_line, shoulder_line
                var ppi = 0D;
                var printableFront = new double[6] {0, 0, double.MaxValue, double.MaxValue, 0, 0};
                var printableBack = new double[6] {0, 0, double.MaxValue, double.MaxValue, 0, 0};
                var productTypeId = 0;

                var totalColorsCount = 0;
                var products = new List<TeespringProductItem>();
                var teespringProducts = new List<JToken>();
                var teespringProductTypes = new List<JToken>();
                foreach (var control in FlowLayoutTeespring.Controls)
                {
                    if (control is TeespringProduct)
                    {
                        var product = new TeespringProductItem();
                        var teespringProduct = (TeespringProduct) control;
                        if (teespringProduct.SelectedColors.Count > 0)
                        {
                            product.Id = teespringProduct.Product["id"].ToObject<int>();
                            product.Price = decimal.ToDouble(teespringProduct.NumericUpDownPrice.Value);
                            product.Colors = teespringProduct.SelectedColors.ToArray();

                            var productType = teespringProduct.GetProductType(teespringProduct.Product["product_type_id"].ToObject<int>());

                            if (productType["type_name"].ToObject<string>() != null && productType["type_name"].ToObject<string>().ToLower() == "mug")
                            {
                                totalColorsCount += 1;
                            }
                            else
                            {
                                totalColorsCount += teespringProduct.SelectedColors.Count;
                            }


                            if (teespringProduct.CheckBoxIsDefault.Checked)
                            {
                                products.Insert(0, product);
                                teespringProducts.Insert(0, teespringProduct.Product);
                                teespringProductTypes.Insert(0, productType);
                            }
                            else
                            {
                                products.Add(product);
                                teespringProducts.Add(teespringProduct.Product);
                                teespringProductTypes.Add(productType);
                            }

                            printableFront[0] = Math.Max(printableFront[0], productType["printable_front_left"].ToObject<double>());
                            printableFront[1] = Math.Max(printableFront[1], productType["printable_front_top"].ToObject<double>());
                            printableFront[2] = Math.Min(printableFront[2], productType["printable_front_width"].ToObject<double>());
                            printableFront[3] = Math.Min(printableFront[3], productType["printable_front_height"].ToObject<double>());
                            printableFront[4] = productType["chest_line_front"].ToObject<double>();
                            printableFront[5] = productType["shoulder_line_front"].ToObject<double>();
                            printableBack[0] = Math.Max(printableBack[0], productType["printable_back_left"].ToObject<double>());
                            printableBack[1] = Math.Max(printableBack[1], productType["printable_back_top"].ToObject<double>());
                            printableBack[2] = Math.Min(printableBack[2], productType["printable_back_width"].ToObject<double>());
                            printableBack[3] = Math.Min(printableBack[3], productType["printable_back_height"].ToObject<double>());
                            printableBack[4] = productType["chest_line_back"].ToObject<double>();
                            printableBack[5] = productType["shoulder_line_back"].ToObject<double>();
                        }
                    }
                }

                if (totalColorsCount == 0)
                {
                    return (false, "Teespring - You must select at least 1 style and color.", null);
                }

                if (totalColorsCount > 15)
                {
                    return (false, "Teespring - You cannot select more than 15 style and color combinations.", null);
                }

                // Upload images
                var frontImageName = "";
                if (!string.IsNullOrEmpty(path))
                {
                    frontImageName = Teespring.GenerateRandomName(8) + Path.GetExtension(path);
                    var s3Request = Teespring.SignInToS3("image/" + Path.GetExtension(path).TrimStart('.'), frontImageName, teespringCookies);
                    var input = new FileStream(path, FileMode.Open, FileAccess.Read);
                    var result = Teespring.UploadPhoto(
                                                       designId,
                                                       frontImageName,
                                                       s3Request["signed_request"].ToObject<string>(),
                                                       path,
                                                       input,
                                                       bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                                       bootstrap["s3"].ToObject<string>().TrimStart('/'),
                                                       teespringCookies);
                    input.Close();
                    if (result == null)
                    {
                        return (false, "Teespring - Upload front image failed.", null);
                    }
                }
                var backImageName = "";
                if (!string.IsNullOrEmpty(backPath))
                {
                    backImageName = Teespring.GenerateRandomName(8) + Path.GetExtension(backPath);
                    var s3Request = Teespring.SignInToS3("image/" + Path.GetExtension(backPath).TrimStart('.'), backImageName, teespringCookies);
                    var input = new FileStream(backPath, FileMode.Open, FileAccess.Read);
                    var result = Teespring.UploadPhoto(
                                                       designId,
                                                       backImageName,
                                                       s3Request["signed_request"].ToObject<string>(),
                                                       backPath,
                                                       input,
                                                       bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                                       bootstrap["s3"].ToObject<string>().TrimStart('/'),
                                                       teespringCookies);
                    input.Close();
                    if (result == null)
                    {
                        return (false, "Teespring - Upload back image failed.", null);
                    }
                }

                ppi = teespringProductTypes.FirstOrDefault()["pixel_to_inch_ratio"].ToObject<double>();
                productTypeId = teespringProductTypes.FirstOrDefault()["id"].ToObject<int>();

                teespringItem.DefaultProduct = JsonConvert.SerializeObject(
                                                                           products.Select(
                                                                                           x => new
                                                                                                {
                                                                                                    id = x.Id,
                                                                                                    colors = new[] {x.Colors[0]}
                                                                                                })
                                                                                   .FirstOrDefault());

                teespringItem.PriorPrintableArea = JsonConvert.SerializeObject(
                                                                               new
                                                                               {
                                                                                   front =
                                                                                   $"{printableFront[0]},{printableFront[1]},{printableFront[2]},{printableFront[3]}",
                                                                                   back =
                                                                                   $"{printableBack[0]},{printableBack[1]},{printableBack[2]},{printableBack[3]}"
                                                                               });

                var design = new TeespringDesign
                             {
                                 LookupId = designId,
                                 ProductTypeId = productTypeId,
                             };

                Color[] frontColors = null;
                if (!string.IsNullOrEmpty(frontImageName))
                {
                    Rectangle boundary;
                    var simplifiedImage = SimplifyImage(image, teespringPalette, out frontColors, out boundary);
                    simplifiedImage.Dispose();
                    simplifiedImage = null;

                    var frontImageUrl = "https://" + bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                        bootstrap["s3"].ToObject<string>().TrimStart('/') + "/" + frontImageName;
                    var layer = new TeespringDesignLayer()
                                {
                                    FileName = frontImageName,
                                    OriginalFileName = frontImageUrl,
                                    SourceFileName = Path.GetFileName(path),
                                    Format = Path.GetExtension(frontImageName).TrimStart('.'),
                                    Width = image.Width,
                                    Height = image.Height,
                                    AbsoluteBBox = new TeespringBox()
                                                   {
                                                       X = boundary.X,
                                                       Y = boundary.Y,
                                                       Width = boundary.Width,
                                                       Height = boundary.Height
                                                   },
                                    OutlineColor = new TeespringColor()
                                                   {
                                                       Id = "default0",
                                                       Value = "#000000",
                                                   },
                                    Colors = frontColors?.Select(
                                                                 x => new TeespringColor()
                                                                      {
                                                                          Id = "",
                                                                          Value = $"rgb({x.R}, {x.G}, {x.B})"
                                                                      })
                                                        .ToArray() ?? new TeespringColor[] { }
                                };

                    var scaleX = printableFront[2] / image.Width;
                    var scaleY = printableFront[3] / image.Height;
                    var scale = Math.Min(scaleX, scaleY);
                    var width = (int) (image.Width * scale);
                    var height = (int) (image.Height * scale);
                    var translateX = teespringProductTypes.FirstOrDefault()["printable_front_left"].ToObject<double>()
                                     + (teespringProductTypes.FirstOrDefault()["printable_front_width"].ToObject<double>() - printableFront[2]) / 2;
                    var translateY = teespringProductTypes.FirstOrDefault()["printable_front_top"].ToObject<double>();
                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        translateX += printableFront[2] / 2 - (double) width / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        translateX += printableFront[2] - width;
                    }
                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        translateY += printableFront[3] / 2 - (double) height / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        translateY += printableFront[3] - height;
                    }

                    layer.Matrix.A = scale; // ScaleX
                    layer.Matrix.B = 0; // SkewY
                    layer.Matrix.C = 0; // SkewX
                    layer.Matrix.D = scale; // ScaleY
                    layer.Matrix.E = translateX; // TranslateX
                    layer.Matrix.F = translateY; // TranslateY

                    layer.BBox = new TeespringBox()
                                 {
                                     X = translateX,
                                     Y = translateY,
                                     Width = width,
                                     Height = height
                                 };

                    layer.NewDesignData = new Dictionary<string, object>
                                          {
                                              {
                                                  "transform", new Dictionary<string, object>
                                                               {
                                                                   {"translateX", translateX + (double) width / 2},
                                                                   {"translateY", translateY + (double) height / 2},
                                                                   {"scaleX", scale},
                                                                   {"scaleY", scale},
                                                                   {"flipX", 1},
                                                                   {"flipY", 1},
                                                                   {"rotate", 0},
                                                                   {"width", image.Width},
                                                                   {"height", image.Height}
                                                               }
                                              }
                                          };

                    var front = new TeespringDesignSide
                                {
                                    LookupId = designId,
                                    Name = "front",
                                    PriorPrintableBox =
                                        $"{teespringProductTypes.FirstOrDefault()["printable_front_left"].ToObject<double>()},{teespringProductTypes.FirstOrDefault()["printable_front_top"].ToObject<double>()},{printableBack[2]},{printableBack[3]}",
                                    BBox = new TeespringBox()
                                           {
                                               X = translateX,
                                               Y = translateY,
                                               Width = width,
                                               Height = height
                                           },
                                    AbsoluteBBox = new TeespringBox()
                                                   {
                                                       X = boundary.X * scale + translateX,
                                                       Y = boundary.Y * scale + translateY,
                                                       Width = boundary.Width * scale,
                                                       Height = boundary.Height * scale
                                                   },
                                    RasterImageInfo = new Dictionary<string, object>
                                                      {
                                                          {"width", image.Width},
                                                          {"height", image.Height},
                                                          {"format", Path.GetExtension(frontImageName).TrimStart('.')}
                                                      },
                                    Layers = new[] {layer},
                                    Svg = string.Format(
                                                        licenseData["teespring"]["frontSvg"].ToObject<string>(),
                                                        translateX,
                                                        translateY,
                                                        printableFront[2],
                                                        printableFront[3],
                                                        translateX,
                                                        translateY,
                                                        printableFront[2],
                                                        printableFront[3],
                                                        image.Width,
                                                        image.Height,
                                                        layer.Matrix.A,
                                                        layer.Matrix.B,
                                                        layer.Matrix.C,
                                                        layer.Matrix.D,
                                                        layer.Matrix.E,
                                                        layer.Matrix.F,
                                                        "https:" + bootstrap["s3"].ToObject<string>() + bootstrap["usersBucket"].ToObject<string>() + "/" +
                                                        frontImageName,
                                                        "https:" + bootstrap["s3"].ToObject<string>() + bootstrap["usersBucket"].ToObject<string>() + "/" +
                                                        frontImageName,
                                                        image.Width,
                                                        image.Height
                                                       ),
                                    Colors = layer.Colors,
                                    ReferencePoint = new Dictionary<string, object>
                                                     {
                                                         {"x", printableFront[4]},
                                                         {"y", printableFront[5]}
                                                     },
                                    PPI = ppi
                                };

                    design.Sides.Front = front;
                    design.FrontColors = layer.Colors.Length;
                }
                else
                {
                    design.Sides.Front = new TeespringDesignSide
                                         {
                                             LookupId = designId,
                                             Name = "front",
                                             Svg = string.Format(
                                                                 licenseData["teespring"]["frontEmptySvg"].ToObject<string>(),
                                                                 teespringProductTypes.FirstOrDefault()["printable_front_left"].ToObject<double>(),
                                                                 teespringProductTypes.FirstOrDefault()["printable_front_top"].ToObject<double>(),
                                                                 printableFront[2],
                                                                 printableFront[3],
                                                                 teespringProductTypes.FirstOrDefault()["printable_front_left"].ToObject<double>(),
                                                                 teespringProductTypes.FirstOrDefault()["printable_front_top"].ToObject<double>(),
                                                                 printableFront[2],
                                                                 printableFront[3]
                                                                ),
                                             ReferencePoint = new Dictionary<string, object>
                                                              {
                                                                  {"x", printableFront[4]},
                                                                  {"y", printableFront[5]}
                                                              },
                                             PPI = ppi,
                                             PriorPrintableBox =
                                                 $"{teespringProductTypes.FirstOrDefault()["printable_front_left"].ToObject<double>()},{teespringProductTypes.FirstOrDefault()["printable_front_top"].ToObject<double>()},{printableFront[2]},{printableFront[3]}",
                                             RasterImageInfo = new Dictionary<string, object>(),
                                             Colors = new TeespringColor[] { },
                                             AbsoluteBBox = null
                                         };
                }

                Color[] backColors = null;

                if (!string.IsNullOrEmpty(backImageName))
                {
                    Rectangle boundary;
                    var simplifiedImage = SimplifyImage(backImage, teespringPalette, out backColors, out boundary);
                    simplifiedImage.Dispose();
                    simplifiedImage = null;

                    var backImageUrl = "https://" + bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                       bootstrap["s3"].ToObject<string>().TrimStart('/') + "/" + backImageName;
                    var layer = new TeespringDesignLayer()
                                {
                                    FileName = backImageName,
                                    OriginalFileName = backImageUrl,
                                    SourceFileName = Path.GetFileName(backPath),
                                    Format = Path.GetExtension(backImageName).TrimStart('.'),
                                    Width = backImage.Width,
                                    Height = backImage.Height,
                                    AbsoluteBBox = new TeespringBox()
                                                   {
                                                       X = boundary.X,
                                                       Y = boundary.Y,
                                                       Width = boundary.Width,
                                                       Height = boundary.Height
                                                   },
                                    OutlineColor = new TeespringColor()
                                                   {
                                                       Id = "default0",
                                                       Value = "#000000",
                                                   },
                                    Colors = backColors?.Select(
                                                                x => new TeespringColor()
                                                                     {
                                                                         Id = "",
                                                                         Value = $"rgb({x.R}, {x.G}, {x.B})"
                                                                     })
                                                       .ToArray() ?? new TeespringColor[] { }
                                };
                    var scaleX = printableBack[2] / backImage.Width;
                    var scaleY = printableBack[3] / backImage.Height;
                    var scale = Math.Min(scaleX, scaleY);
                    var width = (int) (backImage.Width * scale);
                    var height = (int) (backImage.Height * scale);
                    var translateX = teespringProductTypes.FirstOrDefault()["printable_back_left"].ToObject<double>()
                                     + (teespringProductTypes.FirstOrDefault()["printable_back_width"].ToObject<double>() - printableBack[2]) / 2;
                    var translateY = teespringProductTypes.FirstOrDefault()["printable_back_top"].ToObject<double>();
                    if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        translateX += printableBack[2] / 2 - (double) width / 2;
                    }
                    else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        translateX += printableBack[2] - width;
                    }
                    if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        translateY += printableBack[3] / 2 - (double) height / 2;
                    }
                    else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        translateY += printableBack[3] - height;
                    }

                    layer.Matrix.A = scale; // ScaleX
                    layer.Matrix.B = 0; // SkewY
                    layer.Matrix.C = 0; // SkewX
                    layer.Matrix.D = scale; // ScaleY
                    layer.Matrix.E = translateX; // TranslateX
                    layer.Matrix.F = translateY; // TranslateY

                    layer.BBox = new TeespringBox()
                                 {
                                     X = translateX,
                                     Y = translateY,
                                     Width = width,
                                     Height = height
                                 };

                    layer.NewDesignData = new Dictionary<string, object>
                                          {
                                              {
                                                  "transform", new Dictionary<string, object>
                                                               {
                                                                   {"translateX", translateX + (double) width / 2},
                                                                   {"translateY", translateY + (double) height / 2},
                                                                   {"scaleX", scale},
                                                                   {"scaleY", scale},
                                                                   {"flipX", 1},
                                                                   {"flipY", 1},
                                                                   {"rotate", 0},
                                                                   {"width", backImage.Width},
                                                                   {"height", backImage.Height}
                                                               }
                                              }
                                          };

                    var back = new TeespringDesignSide
                               {
                                   LookupId = designId,
                                   Name = "back",
                                   PriorPrintableBox =
                                       $"{teespringProductTypes.FirstOrDefault()["printable_back_left"].ToObject<double>()},{teespringProductTypes.FirstOrDefault()["printable_back_top"].ToObject<double>()},{printableBack[2]},{printableBack[3]}",
                                   BBox = new TeespringBox()
                                          {
                                              X = translateX,
                                              Y = translateY,
                                              Width = width,
                                              Height = height
                                          },
                                   AbsoluteBBox = new TeespringBox()
                                                  {
                                                      X = boundary.X * scale + translateX,
                                                      Y = boundary.Y * scale + translateY,
                                                      Width = boundary.Width * scale,
                                                      Height = boundary.Height * scale
                                                  },
                                   RasterImageInfo = new Dictionary<string, object>
                                                     {
                                                         {"width", backImage.Width},
                                                         {"height", backImage.Height},
                                                         {"format", Path.GetExtension(backImageName).TrimStart('.')}
                                                     },
                                   Layers = new[] {layer},
                                   Svg = string.Format(
                                                       licenseData["teespring"]["backSvg"].ToObject<string>(),
                                                       translateX,
                                                       translateY,
                                                       printableBack[2],
                                                       printableBack[3],
                                                       translateX,
                                                       translateY,
                                                       printableBack[2],
                                                       printableBack[3],
                                                       backImage.Width,
                                                       backImage.Height,
                                                       layer.Matrix.A,
                                                       layer.Matrix.B,
                                                       layer.Matrix.C,
                                                       layer.Matrix.D,
                                                       layer.Matrix.E,
                                                       layer.Matrix.F,
                                                       "https:" + bootstrap["s3"].ToObject<string>() + bootstrap["usersBucket"].ToObject<string>() + "/" +
                                                       backImageName,
                                                       "https:" + bootstrap["s3"].ToObject<string>() + bootstrap["usersBucket"].ToObject<string>() + "/" +
                                                       backImageName,
                                                       backImage.Width,
                                                       backImage.Height
                                                      ),
                                   Colors = layer.Colors,
                                   ReferencePoint = new Dictionary<string, object>
                                                    {
                                                        {"x", printableBack[4]},
                                                        {"y", printableBack[5]}
                                                    },
                                   PPI = ppi
                               };

                    design.Sides.Back = back;
                    design.BackColors = layer.Colors.Length;
                }
                else
                {
                    design.Sides.Back = new TeespringDesignSide()
                                        {
                                            LookupId = designId,
                                            Name = "back",
                                            Svg = string.Format(
                                                                licenseData["teespring"]["backEmptySvg"].ToObject<string>(),
                                                                teespringProductTypes.FirstOrDefault()["printable_back_left"].ToObject<double>(),
                                                                teespringProductTypes.FirstOrDefault()["printable_back_top"].ToObject<double>(),
                                                                printableBack[2],
                                                                printableBack[3],
                                                                teespringProductTypes.FirstOrDefault()["printable_back_left"].ToObject<double>(),
                                                                teespringProductTypes.FirstOrDefault()["printable_back_top"].ToObject<double>(),
                                                                printableBack[2],
                                                                printableBack[3]
                                                               ),
                                            ReferencePoint = new Dictionary<string, object>
                                                             {
                                                                 {"x", printableBack[4]},
                                                                 {"y", printableBack[5]}
                                                             },
                                            PPI = ppi,
                                            PriorPrintableBox =
                                                $"{teespringProductTypes.FirstOrDefault()["printable_back_left"].ToObject<double>()},{teespringProductTypes.FirstOrDefault()["printable_back_top"].ToObject<double>()},{printableBack[2]},{printableBack[3]}",
                                            RasterImageInfo = new Dictionary<string, object>(),
                                            Colors = new TeespringColor[] { },
                                            AbsoluteBBox = null
                                        };
                }
                teespringItem.Design = JsonConvert.SerializeObject(design);

                // Check price
                foreach (var product in products)
                {
                    var productStr = WebUtility.UrlEncode(
                                                          JsonConvert.SerializeObject(
                                                                                      new[]
                                                                                      {
                                                                                          new Dictionary<string, object>
                                                                                          {
                                                                                              {"product_id", product.Id},
                                                                                              {"color_id", product.Colors[0]}
                                                                                          }
                                                                                      }));

                    var frontColorsStr = "";
                    var backColorsStr = "";
                    if (frontColors != null)
                    {
                        frontColorsStr = string.Join(",", frontColors.Select(x => "#" + x.ToArgb().ToString("X6")));
                    }
                    if (backColors != null)
                    {
                        backColorsStr = string.Join(",", backColors.Select(x => "#" + x.ToArgb().ToString("X6")));
                    }

                    var prices = Teespring.GetCost(teespringCookies, teespringItem.TippingPoint, productStr, frontColorsStr, backColorsStr, region, "USD");
                    if (prices != null)
                    {
                        if (product.Price < prices[0]["minimum_price"].ToObject<double>())
                        {
                            product.Price = prices[0]["recommended_price"].ToObject<double>();
                        }
                    }
                }

                teespringItem.Products = JsonConvert.SerializeObject(products);

                var checkUrl = Teespring.CheckUrl(teespringItem.Url, teespringCookies);
                if (!checkUrl)
                {
                    return (false, $"Teespring - Url {teespringItem.Url} already existed.", null);
                }

                var uploadResult = Teespring.Upload(designId, teespringItem, bootstrap["authToken"].ToObject<string>(), teespringCookies);
                if (!string.IsNullOrEmpty(uploadResult))
                {
                    var json = JsonConvert.DeserializeObject<JToken>(uploadResult);
                    var campaignId = json["campaign_id"].ToObject<string>();

                    var checkAsset = Teespring.CheckAsset(designId, teespringCookies);
                    if (checkAsset == false)
                    {
                        return
                            (false, $"Teespring - There is issue while creating mockup. Design is already submitted to server into Draft with Campaign ID: {campaignId}.", null
                            );
                    }
                    
                    var launchResult = Teespring.Launch(campaignId, designId, bootstrap["authToken"].ToObject<string>(), teespringCookies);
                    try
                    {
                        if (autoRelaunch)
                        {
                            var ret = Teespring.AutoRelaunch(campaignId, true, duration, bootstrap["authToken"].ToObject<string>(), teespringCookies);
                        }
                        if (isPrivate)
                        {
                            var ret = Teespring.MakePrivate(campaignId, bootstrap["authToken"].ToObject<string>(), teespringCookies);
                        }

                        Teespring.UpdateTracking(campaignId, bootstrap["authToken"].ToObject<string>(), facebookPixel, googleAnalytics, teespringCookies);

                        var launchJson = JsonConvert.DeserializeObject<JToken>(launchResult);
                        campaignUrl = launchJson["url"].ToObject<string>();
                        if (campaignUrl != null && (campaignUrl.ToLower().Contains("promote") || campaignUrl.ToLower().Contains("?return_to=")))
                        {
                            campaignUrl = "https://teespring.com/" + url;
                        }
                        if (!hasNewProduct)
                        {
                            return (true, "Teespring - Upload to Teespring successfully.", new[] {campaignUrl});
                        }
                    }
                    catch (Exception exc)
                    {
                        Logger.WriteLog(exc);
                        return
                            (false, $"Teespring - There is issue while launching campaign. Design is already submitted to server into Draft with Campaign ID: {campaignId}.", null
                            );
                    }
                }
                else
                {
                    Logger.WriteLog(uploadResult);
                    return (false, "Teespring - There is issue while uploading campaign.", null);
                }
            }

            // Upload new products
            if (hasNewProduct)
            {
                var bootstrap = Teespring.GetBootstrap(teespringCookies);
                var tokenBootstrap = Teespring.GetNewBootstrap(teespringCookies);

                // Upload images
                var frontImageName = "";
                if (!string.IsNullOrEmpty(path))
                {
                    frontImageName = Teespring.GenerateRandomName(8) + Path.GetExtension(path);
                    var s3Request = Teespring.SignInToS3("image/" + Path.GetExtension(path).TrimStart('.'), frontImageName, teespringCookies);
                    var input = new FileStream(path, FileMode.Open, FileAccess.Read);
                    var imageResult = Teespring.UploadPhoto(
                                                       "",
                                                       frontImageName,
                                                       s3Request["signed_request"].ToObject<string>(),
                                                       path,
                                                       input,
                                                       bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                                       bootstrap["s3"].ToObject<string>().TrimStart('/'),
                                                       teespringCookies);
                    input.Close();
                    if (imageResult == null)
                    {
                        return (false, "Teespring - Upload front image failed.", null);
                    }
                }
                var backImageName = "";
                if (!string.IsNullOrEmpty(backPath))
                {
                    backImageName = Teespring.GenerateRandomName(8) + Path.GetExtension(backPath);
                    var s3Request = Teespring.SignInToS3("image/" + Path.GetExtension(backPath).TrimStart('.'), backImageName, teespringCookies);
                    var input = new FileStream(backPath, FileMode.Open, FileAccess.Read);
                    var imageResult = Teespring.UploadPhoto(
                                                       "",
                                                       backImageName,
                                                       s3Request["signed_request"].ToObject<string>(),
                                                       backPath,
                                                       input,
                                                       bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                                       bootstrap["s3"].ToObject<string>().TrimStart('/'),
                                                       teespringCookies);
                    input.Close();
                    if (imageResult == null)
                    {
                        return (false, "Teespring - Upload back image failed.", null);
                    }
                }

                var newTeespringItem = new TeespringNewItem();
                foreach (var control in FlowLayoutTeespring.Controls)
                {
                    if (control is TeespringNewProduct)
                    {
                        var teespringProduct = (TeespringNewProduct) control;
                        if (teespringProduct.SelectedColors.Count > 0)
                        {
                            if (teespringProduct.Product["region_names"].ToObject<JArray>() != null)
                            {
                                var found = false;
                                foreach (var reg in teespringProduct.Product["region_names"].ToObject<JArray>())
                                {
                                    if (reg.ToObject<string>().ToLower() == region.ToLower())
                                    {
                                        found = true;
                                    }
                                }
                                if (!found)
                                {
                                    continue;
                                }
                            }

                            var product = new TeespringNewItemProduct
                                          {
                                              Id = teespringProduct.Product["id"].ToObject<string>(),
                                              FeaturedSide = string.IsNullOrEmpty(path) ? "back" : "front"
                                          };
                            foreach (var color in teespringProduct.SelectedColors)
                            {
                                product.Mockups.Add(new TeespringNewProductMockup()
                                                    {
                                                        Color = color
                                                    });
                            }
                            foreach (var productTemplate in teespringProduct.Product["product_templates"].ToObject<JArray>())
                            {
                                double scale, x, y;
                                if (productTemplate["name"].ToObject<string>() == "front")
                                {
                                    scale = Math.Min(productTemplate["customizable_area"]["width"].ToObject<double>() / image.Width,
                                                     productTemplate["customizable_area"]["width"].ToObject<double>() / image.Height);
                                    x = 0;
                                    y = 0;
                                    if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                                    {
                                        x = (productTemplate["customizable_area"]["width"].ToObject<double>() - scale * image.Width) / 2;
                                    }
                                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                                    {
                                        x = productTemplate["customizable_area"]["width"].ToObject<double>() - scale * image.Width;
                                    }
                                    if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                                    {
                                        y = (productTemplate["customizable_area"]["height"].ToObject<double>() - scale * image.Height) / 2;
                                    }
                                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                                    {
                                        y = productTemplate["customizable_area"]["height"].ToObject<double>() - scale * image.Height;
                                    }
                                }
                                else
                                {
                                    scale = Math.Min(productTemplate["customizable_area"]["width"].ToObject<double>() / backImage.Width,
                                                     productTemplate["customizable_area"]["width"].ToObject<double>() / backImage.Height);
                                    x = 0;
                                    y = 0;
                                    if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                                    {
                                        x = (productTemplate["customizable_area"]["width"].ToObject<double>() - scale * backImage.Width) / 2;
                                    }
                                    else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                                    {
                                        x = productTemplate["customizable_area"]["width"].ToObject<double>() - scale * backImage.Width;
                                    }
                                    if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                                    {
                                        y = (productTemplate["customizable_area"]["height"].ToObject<double>() - scale * backImage.Height) / 2;
                                    }
                                    else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                                    {
                                        y = productTemplate["customizable_area"]["height"].ToObject<double>() - scale * backImage.Height;
                                    }
                                }
                                string imageUrl, imageName;
                                int imageWidth, imageHeight;
                                if (productTemplate["name"].ToObject<string>() == "front")
                                {
                                    imageUrl = "https://" + bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                               bootstrap["s3"].ToObject<string>().TrimStart('/') + "/" + frontImageName;
                                    imageName = frontImageName.Substring(0, frontImageName.Length - Path.GetExtension(path).Length);
                                    imageWidth = image.Width;
                                    imageHeight = image.Height;
                                }
                                else
                                {
                                    imageUrl = "https://" + bootstrap["usersBucket"].ToObject<string>().TrimStart('/') + "." +
                                               bootstrap["s3"].ToObject<string>().TrimStart('/') + "/" + backImageName;
                                    imageName = backImageName.Substring(0, backImageName.Length - Path.GetExtension(backPath).Length);
                                    imageWidth = backImage.Width;
                                    imageHeight = backImage.Height;
                                }
                                product.Customizations.Add(new TeespringNewProductCustomization()
                                                           {
                                                               ProductTemplateId = productTemplate["id"].ToObject<string>(),
                                                               Svg = "<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" " +
                                                                     $"data-designId=\"{productTemplate["id"].ToObject<string>()}\" " +
                                                                     $"viewBox=\"0 0 {productTemplate["customizable_area"]["width"].ToObject<int>()} {productTemplate["customizable_area"]["height"].ToObject<int>()}\" " +
                                                                     $"width=\"{productTemplate["customizable_area"]["width"].ToObject<int>()}\" height=\"{productTemplate["customizable_area"]["height"].ToObject<int>()}\" " +
                                                                     "class=\"designSvg\"><g id=\"" + Teespring.GenerateRandomName(7) +
                                                                     $"\" transform=\"matrix({scale}, 0, 0, {scale}, {x}, {y})\">" +
                                                                     $"<image xlink:href=\"{imageUrl}\" data-uploadId=\"{imageName}\" width=\"{imageWidth}\" height=\"{imageHeight}\"></image></g></svg>"
                                                           });
                                foreach (var mockup in product.Mockups)
                                {
                                    string mockupResult;
                                    if (productTemplate["name"].ToObject<string>() == "front")
                                    {
                                        var input = new FileStream(path, FileMode.Open, FileAccess.Read);
                                        mockupResult = Teespring.UploadNewProductMockup(
                                                                                        path,
                                                                                        input,
                                                                                        tokenBootstrap["user"]["authToken"].ToObject<string>(),
                                                                                        teespringCookies);
                                    }
                                    else
                                    {
                                        var input = new FileStream(backPath, FileMode.Open, FileAccess.Read);
                                        mockupResult = Teespring.UploadNewProductMockup(
                                                                                        backPath,
                                                                                        input,
                                                                                        tokenBootstrap["user"]["authToken"].ToObject<string>(),
                                                                                        teespringCookies);
                                    }
                                    mockup.Views.Add(new TeespringNewProductMockupView()
                                                     {
                                                         Name = productTemplate["name"].ToObject<string>(),
                                                         Id = mockupResult
                                                     });
                                }
                            }
                            if (teespringProduct.Product["recommended_pricing"]["pricing_mode"].ToObject<string>() == "product")
                            {
                                product.Prices = null;
                                product.RetailPrice["cents"] = (int) (teespringProduct.GetPrices().First().Value * 100);
                            }
                            else
                            {
                                product.RetailPrice = null;
                                foreach (var price in teespringProduct.GetPrices())
                                {
                                    var productPrice = new TeespringNewProductPrice()
                                                       {
                                                           ProductSizeId = price.Key
                                                       };
                                    productPrice.RetailPrice["cents"] = (int) (price.Value * 100);
                                    product.Prices.Add(productPrice);
                                }
                            }
                            newTeespringItem.Products.Add(product);
                            if (teespringProduct.CheckBoxIsDefault.Checked)
                            {
                                newTeespringItem.FeaturedProduct["id"] = product.Id;
                                newTeespringItem.FeaturedProduct["color"] = product.Mockups[0].Color;
                            }
                        }
                    }
                }
                newTeespringItem.Title = title;
                newTeespringItem.Description = description;
                newTeespringItem.Url = url;
                if (newTeespringItem.Products.Count == 0)
                {
                    return (false, "Teespring - You must select at least 1 style and color.", null);
                }

                if (string.IsNullOrEmpty(newTeespringItem.FeaturedProduct["id"]))
                {
                    newTeespringItem.FeaturedProduct["id"] = newTeespringItem.Products[0].Id;
                    newTeespringItem.FeaturedProduct["color"] = newTeespringItem.Products[0].Mockups[0].Color;
                }

                if (hasOldProduct)
                {
                    // Check if new products can be added to old listing
                    var uploadResult = Teespring.AddNewProductToCampaign(newTeespringItem, tokenBootstrap["user"]["authToken"].ToObject<string>(), teespringCookies);
                    if (!string.IsNullOrEmpty(uploadResult))
                    {
                        var json = JsonConvert.DeserializeObject<JToken>(uploadResult);
                        campaignUrl = json["url"].ToObject<string>();
                        if (campaignUrl != null && (campaignUrl.ToLower().Contains("promote") || campaignUrl.ToLower().Contains("?return_to=")))
                        {
                            campaignUrl = "https://teespring.com/" + url;
                        }
                        return (true, "Teespring - Upload to Teespring successfully.", new[] {campaignUrl});
                    }
                    else
                    {
                        return (true, "Teespring - Upload to Teespring successfully but some new products cannot be added to campaign.", new[] { campaignUrl });
                    }
                }
                else
                {
                    var uploadResult = Teespring.UploadNewProduct(newTeespringItem, tokenBootstrap["user"]["authToken"].ToObject<string>(), teespringCookies);
                    if (!string.IsNullOrEmpty(uploadResult))
                    {
                        var json = JsonConvert.DeserializeObject<JToken>(uploadResult);
                        var campaignId = json["id"].ToObject<string>();
                        if (autoRelaunch)
                        {
                            var ret = Teespring.AutoRelaunch(campaignId, true, duration, tokenBootstrap["user"]["authToken"].ToObject<string>(), teespringCookies);
                        }
                        if (isPrivate)
                        {
                            var ret = Teespring.MakePrivate(campaignId, tokenBootstrap["user"]["authToken"].ToObject<string>(), teespringCookies);
                        }

                        Teespring.UpdateTracking(campaignId, tokenBootstrap["user"]["authToken"].ToObject<string>(), facebookPixel, googleAnalytics, teespringCookies);

                        campaignUrl = json["url"].ToObject<string>();
                        if (campaignUrl != null && (campaignUrl.ToLower().Contains("promote") || campaignUrl.ToLower().Contains("?return_to=")))
                        {
                            campaignUrl = "https://teespring.com/" + url;
                        }
                        return (true, "Teespring - Upload to Teespring successfully.", new[] { campaignUrl });
                    }
                }
            }

            return (false, "Teespring - There is issue while uploading campaign.", null);
        }

#endif

        #endregion

        #region Platform Viralstyle

#if VIRALSTYLE

        private const string ViralstyleUsernameEncryptionKey = "XCCEUGy1RYY5vnyaINLjc1TmT9emQ2jvDm4FdXSU6N523hbkhnqckale3NrV";
        private const string ViralstylePasswordEncryptionKey = "ihi9kUrx3EFDNPi0EKvC2qQYvm4jBiFlurBTQ7oOqvA71BTz8tcdw7pFDRS4";

        private void Viralstyle_IsDefaultChanged(object sender, EventArgs e)
        {
            var productControl = sender as ViralStyleProduct;
            if (productControl == null || productControl.CheckBoxIsDefault.Checked == false)
            {
                return;
            }

            foreach (Control control in FlowLayoutViralstyle.Controls)
            {
                if (control is ViralStyleProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as ViralStyleProduct).CheckBoxIsDefault.Checked = false;
                }
            }
        }

        private void CheckBoxViralstyle_CheckedChanged(object sender, EventArgs e)
        {
            LabelViralstyleAccounts.Enabled = CheckBoxViralstyle.Checked;
            ComboBoxViralstyleAccounts.Enabled = CheckBoxViralstyle.Checked;
            ButtonAddViralstyleAccount.Enabled = CheckBoxViralstyle.Checked;
            ButtonRemoveViralstyleAccount.Enabled = CheckBoxViralstyle.Checked;
            ButtonImportViralstyleAccounts.Enabled = CheckBoxViralstyle.Checked;
            ButtonRemoveAllViralstyleAccounts.Enabled = CheckBoxViralstyle.Checked;
        }

        private void AddViralstyleAccount(string username, string password)
        {
            // Save to Viralstyle accounts
            if (!Directory.Exists("Platform/Viralstyle"))
            {
                Directory.CreateDirectory("Platform/Viralstyle");
            }

            var accounts = ComboBoxViralstyleAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();

            if (accounts.Exists(x => x.Key.ToLower() == username.ToLower()))
            {
                MessageBox.Show("This account is already added.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            accounts.Add(new KeyValuePair<string, string>(username, password));
            ComboBoxViralstyleAccounts.DataSource = null;
            ComboBoxViralstyleAccounts.DataSource = accounts;
            ComboBoxViralstyleAccounts.DisplayMember = "Key";
            ComboBoxViralstyleAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var account in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(account.Key, ViralstyleUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(account.Value, ViralstylePasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Viralstyle/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonAddViralstyleAccount_Click(object sender, EventArgs e)
        {
            var form = new FormAddAccount();
            if (form.ShowDialog() == DialogResult.OK)
            {
                AddViralstyleAccount(form.TextBoxUsername.Text, form.TextBoxPassword.Text);
            }
        }

        private void ButtonRemoveViralstyleAccount_Click(object sender, EventArgs e)
        {
            if (ComboBoxViralstyleAccounts.SelectedItem == null)
            {
                return;
            }

            var account = (KeyValuePair<string, string>) ComboBoxViralstyleAccounts.SelectedItem;

            var accounts = ComboBoxViralstyleAccounts.DataSource as List<KeyValuePair<string, string>> ??
                           new List<KeyValuePair<string, string>>();
            accounts.Remove(account);
            ComboBoxViralstyleAccounts.DataSource = null;
            ComboBoxViralstyleAccounts.DataSource = accounts;
            ComboBoxViralstyleAccounts.DisplayMember = "Key";
            ComboBoxViralstyleAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var acc in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(acc.Key, ViralstyleUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(acc.Value, ViralstylePasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Viralstyle/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonImportViralstyleAccounts_Click(object sender, EventArgs e)
        {
            ImportAccounts(AddViralstyleAccount);
        }

        private void ButtonRemoveAllViralstyleAccounts_Click(object sender, EventArgs e)
        {
            ComboBoxViralstyleAccounts.DataSource = null;
            File.Delete("Platform/Viralstyle/Accounts.txt");
        }

        private void ComboBoxViralstyleAccounts_SelectedIndexChanged(object sender, EventArgs e)
        {
            viralstyleCookies = null;
            viralstyleAccount = null;
        }

        private void CheckedListBoxViralstyleProducts_ItemCheck(object sender, ItemCheckEventArgs e)
        {
            if (e.NewValue == CheckState.Checked)
            {
                // Add
                var productControl = new ViralStyleProduct();
                productControl.SetProduct(viralstyleProducts[e.Index], viralstyleProductsInfo, viralstylePricing);
                productControl.Tag = e.Index;
                productControl.IsDefaultChanged += Viralstyle_IsDefaultChanged;
                FlowLayoutViralstyle.Controls.Add(productControl);
            }
            else
            {
                // Remove
                foreach (Control control in FlowLayoutViralstyle.Controls)
                {
                    if (control is ViralStyleProduct && (int) control.Tag == e.Index)
                    {
                        (control as ViralStyleProduct).IsDefaultChanged -= Viralstyle_IsDefaultChanged;
                        FlowLayoutViralstyle.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                }
            }
        }

        private void InitViralstyle()
        {
            viralstyleCookies = new CookieContainer();
            var categories = LoadViralstyleCategories();
            foreach (var cat in categories)
            {
                ViralstyleCategory.Items.Add(cat);
            }

            ViralstyleCategory.DisplayMember = "Value";
            ViralstyleCategory.ValueMember = "Key";

            LoadViralstyleProducts(FlowLayoutViralstyle);
            viralstylePricing = Viralstyle.GetPricing(viralstyleCookies);
            LoadViralstyleAccounts();
            for (var i = 0; i < CheckedListBoxViralstyleProducts.Items.Count; i++)
            {
                CheckedListBoxViralstyleProducts.SetItemChecked(i, true);
                CheckedListBoxViralstyleProducts.SetItemChecked(i, false);
            }
        }

        private List<KeyValuePair<string, string>> LoadViralstyleCategories()
        {
            if (viralstyleCookies == null)
            {
                viralstyleCookies = new CookieContainer();
            }
            var result = new List<KeyValuePair<string, string>>();
            var categoriesResult = Viralstyle.GetCategories(viralstyleCookies);
            if (categoriesResult == null)
            {
                return result;
            }
            var categories = categoriesResult["data"];
            foreach (var category in categories.OrderBy(x => x["parent_cat"].ToObject<string>()))
            {
                result.Add(new KeyValuePair<string, string>(category["id"].ToObject<string>(),
                                                            category["parent_cat"].ToObject<string>() + " - " + category["name"].ToObject<string>()));
            }

            return result;
        }

        private void LoadViralstyleProducts(Control container)
        {
            if (container == null)
            {
                return;
            }

            viralstyleProductsInfo = Viralstyle.GetProductsInfo(viralstyleCookies);
            viralstyleProducts = new List<JToken>();
            if (viralstyleProductsInfo != null)
            {
                // Create products
                foreach (var category in viralstyleProductsInfo)
                {
                    foreach (var product in category["category_products"].ToObject<JArray>())
                    {
                        viralstyleProducts.Add(product["products"].ToObject<JToken>());
                        CheckedListBoxViralstyleProducts.Items.Add(product["products"]["name"].ToObject<string>());
                    }
                }
            }
            else
            {
                MessageBox.Show(
                                @"Error happens when connect to Viralstyle server. Please check your Internet connection and run application again.
You can upload to other platforms also.",
                                "Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
            }
        }

        private void LoadViralstyleAccounts()
        {
            if (!File.Exists("Platform/Viralstyle/Accounts.txt"))
            {
                return;
            }

            var content = File.ReadAllText("Platform/Viralstyle/Accounts.txt");
            var json = JsonConvert.DeserializeObject<JToken>(content);

            var accounts = new List<KeyValuePair<string, string>>();
            foreach (var acc in json)
            {
                try
                {
                    var username = acc["Username"].ToObject<string>();
                    var password = acc["Password"].ToObject<string>();
                    var index = username.IndexOf('=');
                    while (index < username.Length - 1 && username[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltUsername = username.Substring(0, index);
                    username = Common.Decrypt(username.Substring(index + 1), ViralstyleUsernameEncryptionKey, saltUsername);
                    index = password.IndexOf('=');
                    while (index < password.Length - 1 && password[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltPassword = password.Substring(0, index);
                    password = Common.Decrypt(password.Substring(index + 1), ViralstylePasswordEncryptionKey, saltPassword);
                    accounts.Add(new KeyValuePair<string, string>(username, password));
                }
                catch (Exception exc)
                {
                }
            }

            ComboBoxViralstyleAccounts.DataSource = accounts;
        }

        private double[] ConvertRgbToHsl(string hex)
        {
            var rgb = ColorTranslator.FromHtml(hex);
            var r = (rgb.R / 255d);
            var g = (rgb.G / 255d);
            var b = (rgb.B / 255d);

            var min = Math.Min(Math.Min(r, g), b);
            var max = Math.Max(Math.Max(r, g), b);
            var delta = max - min;

            var h = 0d;
            var s = 0d;
            var l = (float) ((max + min) / 2.0d);

            if (delta != 0)
            {
                if (l < 0.5d)
                {
                    s = (double) (delta / (max + min));
                }
                else
                {
                    s = (double) (delta / (2.0d - max - min));
                }

                if (r == max)
                {
                    h = (g - b) / delta;
                }
                else if (g == max)
                {
                    h = 2d + (b - r) / delta;
                }
                else if (b == max)
                {
                    h = 4d + (r - g) / delta;
                }
            }

            return new double[] {h, s, l, rgb.A / 255d};
        }

        private (bool Result, string Message, string[] Links) UploadViralstyle(
            Image artImage,
            string path,
            Image backArtImage,
            string backPath,
            string frontLeftAlign,
            string frontTopAlign,
            string backLeftAlign,
            string backTopAlign,
            string title,
            string description,
            string url,
            string keywords,
            string category,
            int duration,
            int goal,
            bool relaunch,
            bool isPrivate,
            string facebookPixel,
            string googleAnalytics)
        {
            if (licenseData?["viralstyle"] == null)
            {
                return (false, "You don't have license of Viralstyle.", null);
            }
            if (viralstyleCookies == null || viralstyleAccount == null)
            {
                return (false, "You didn't login to Viralstyle. Please check your Viralstyle account.", null);
            }

            if (artImage == null && backArtImage == null)
            {
                return (false, "There are no images to upload.", null);
            }

            title = Truncate(title, 40);
            description = Truncate(description, 300);

            var unixEpoch = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
            var tags = (keywords ?? "").Split(new char[] {','}, StringSplitOptions.RemoveEmptyEntries);
            var viralstyleItem = new ViralstyleItem
                                 {
                                     Goal = goal,
                                     CampaignName = title,
                                     CampaignDescription = description,
                                     CampaignUrl = url,
                                     CampaignTags = tags,
                                     Category = category,
                                     CampaignLength = duration,
                                     CampaignEndDate = DateTime.UtcNow.AddDays(duration).ToString("dddd, MMM. dd yyyy - HH tt"),
                                     CampaignEndDateObj = DateTime.UtcNow.AddDays(duration).ToString("yyyy-MM-dd'T'HH:mm:ss.fffK"),
                                     CampaignEndDateUtc = (long) (DateTime.UtcNow.AddDays(duration) - unixEpoch).TotalMilliseconds,
                                     CampaignAutoRelaunch = relaunch,
                                     HideMarketplace = isPrivate
                                 };

            var additionalProducts = new List<ViralstyleAdditionalProduct>();
            var frontWidth = 0;
            var backWidth = 0;
            JToken product = null;
            JToken firstColor = null;
            var totalColorsCount = 0;
            var tempListProducts = new List<ViralStyleProduct>();
            foreach (var control in FlowLayoutViralstyle.Controls)
            {
                if (control is ViralStyleProduct)
                {
                    var viralstyleProduct = (ViralStyleProduct) control;
                    if (viralstyleProduct.SelectedColors.Count > 0)
                    {
                        if (viralstyleProduct.CheckBoxIsDefault.Checked)
                        {
                            tempListProducts.Insert(0, viralstyleProduct);
                        }
                        else
                        {
                            tempListProducts.Add(viralstyleProduct);
                        }
                    }
                }
            }

            foreach (var viralstyleProduct in tempListProducts)
            {
                totalColorsCount += viralstyleProduct.SelectedColors.Count;

                var prod = viralstyleProduct.Product;
                foreach (var color in viralstyleProduct.SelectedColors)
                {
                    var hex = "";
                    foreach (var colorObj in prod["product_colors"].ToObject<JArray>())
                    {
                        if (colorObj["id"].ToObject<int>() == color)
                        {
                            hex = colorObj["hex"].ToObject<string>();
                            if (firstColor == null)
                            {
                                firstColor = colorObj;
                            }
                        }
                    }

                    var basePrice = viralstyleProduct.CalculatePrice(artImage != null && backArtImage != null, goal);
                    var price = viralstyleProduct.NumericUpDownPrice.Value;
                    if (price < basePrice)
                    {
                        price = decimal.Parse(prod["suggested_price"].ToObject<string>());
                    }
                    additionalProducts.Add(
                                           new ViralstyleAdditionalProduct()
                                           {
                                               Product = prod["id"].ToObject<int>(),
                                               Color = color,
                                               Hex = hex,
                                               SellingPrice = price.ToString(),
                                               BasePrice = basePrice,
                                               DtgPrice = decimal.Parse(viralstyleProduct.Pricing["DTG_PRICE"].ToObject<string>())
                                           });
                }

                if (frontWidth == 0)
                {
                    frontWidth = prod["front_width"].ToObject<int>();
                }
                if (backWidth == 0)
                {
                    backWidth = prod["back_width"].ToObject<int>();
                }
                if (product == null)
                {
                    product = prod;
                }
            }

            if (totalColorsCount == 0 || product == null || firstColor == null)
            {
                return (false, "Viralstyle - You must select at least 1 garment and color combination.", null);
            }

            if (totalColorsCount > 20)
            {
                return (false, "Viralstyle - You cannot select more than 20 garment and color combinations.", null);
            }

            var token = Viralstyle.GetToken(viralstyleCookies);
            var pageToken = Viralstyle.GetPageToken(viralstyleCookies);

            foreach (var color in product["product_colors"].ToObject<JArray>())
            {
                if (color["hsl"] != null)
                {
                    continue;
                }

                var hsl = ConvertRgbToHsl(color["hex"].ToObject<string>());
                (color as JObject).Add("hsl", JToken.Parse($"{{h: {hsl[0]}, s: {hsl[1]}, l: {hsl[2]}, a: {hsl[3]}}}"));
            }

            JToken frontImage = null;
            JToken backImage = null;
            if (!string.IsNullOrEmpty(path))
            {
                var input = new FileStream(path, FileMode.Open, FileAccess.Read);
                frontImage = Viralstyle.UploadAsset(path, input, frontWidth, product["id"].ToObject<int>(), "NEW", "NEW", viralstyleCookies);
                input.Close();
            }
            if (!string.IsNullOrEmpty(backPath))
            {
                var input = new FileStream(backPath, FileMode.Open, FileAccess.Read);
                backImage = Viralstyle.UploadAsset(
                                                   backPath,
                                                   input,
                                                   backWidth,
                                                   product["id"].ToObject<int>(),
                                                   (frontImage == null || frontImage["status"]?.ToObject<string>()?.ToLower() == "error")
                                                       ? "NEW"
                                                       : frontImage["data"]["identifier"].ToObject<string>(),
                                                   (frontImage == null || frontImage["status"]?.ToObject<string>()?.ToLower() == "error")
                                                       ? "NEW"
                                                       : frontImage["data"]["campaign_identifier"].ToObject<string>(),
                                                   viralstyleCookies);
                input.Close();
            }

            if (frontImage == null && backImage == null)
            {
                return (false, "Viralstyle - Cannot upload image(s).", null);
            }

            if (frontImage != null && frontImage["status"] != null && frontImage["status"].ToObject<string>().ToLower() == "error")
            {
                return (false, "Viralstyle - Cannot upload front image. Reason: " + frontImage["message"], null);
            }
            if (backImage != null && backImage["status"] != null && backImage["status"].ToObject<string>().ToLower() == "error")
            {
                return (false, "Viralstyle - Cannot upload back image. Reason: " + backImage["message"], null);
            }

            viralstyleItem.CampaignUniqueId =
                frontImage != null ? frontImage["data"]["campaign_identifier"].ToObject<string>() : backImage["data"]["campaign_identifier"].ToObject<string>();
            viralstyleItem.ImageIdentifier =
                frontImage != null ? frontImage["data"]["identifier"].ToObject<string>() : backImage["data"]["identifier"].ToObject<string>();

            viralstyleItem.MainProduct = new ViralstyleProduct();
            if (firstColor != null)
            {
                var hsl = ConvertRgbToHsl(firstColor["hex"].ToObject<string>());

                viralstyleItem.MainProduct.CurrentColor = new ViralstyleColor()
                                                          {
                                                              Id = firstColor["id"].ToObject<int>(),
                                                              ProductId = firstColor["product_id"].ToObject<int>(),
                                                              Name = firstColor["name"].ToObject<string>(),
                                                              Dtg2GoColor = firstColor["name"].ToObject<string>(),
                                                              Hex = firstColor["hex"].ToObject<string>(),
                                                              AbColor = firstColor["ab_color"].ToObject<string>(),
                                                              Active = firstColor["active"].ToObject<int>(),
                                                              CommonColorId = firstColor["common_color_id"].ToObject<string>(),
                                                              CreatedAt = firstColor["created_at"].ToObject<string>(),
                                                              SmColor = firstColor["sm_color"].ToObject<string>(),
                                                              UpdatedAt = firstColor["updated_at"].ToObject<string>(),
                                                              Hsl = new Dictionary<string, object>
                                                                    {
                                                                        {"h", hsl[0]},
                                                                        {"s", hsl[1]},
                                                                        {"l", hsl[2]},
                                                                        {"a", hsl[3]},
                                                                    }
                                                          };
            }

            viralstyleItem.MainProduct.Product = new ViralstyleProductItem
                                                 {
                                                     Image = new Dictionary<string, object>
                                                             {
                                                                 {
                                                                     "front", new Dictionary<string, object>
                                                                              {
                                                                                  {"original", product["front_base"].ToObject<string>()},
                                                                                  {"thumbnail", product["front_preview"].ToObject<string>()},
                                                                                  {"large", product["front_base_large"].ToObject<string>()},
                                                                              }
                                                                 },
                                                                 {
                                                                     "back", new Dictionary<string, object>
                                                                             {
                                                                                 {"original", product["back_base"].ToObject<string>()},
                                                                                 {"thumbnail", product["back_preview"].ToObject<string>()},
                                                                                 {"large", product["back_base_large"].ToObject<string>()},
                                                                             }
                                                                 },
                                                             },
                                                     ProductImage = "https://assets.viralstyle.com/product-images/" + product["front_base"].ToObject<string>(),
                                                     ProductThumbnailImage = "https://assets.viralstyle.com/product-images/" + product["front_preview"].ToObject<string>()
                                                 };
            viralstyleItem.MainProduct.Product.Dimensions["front"]["offsets"]["height"] = product["front_height"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["front"]["offsets"]["width"] = product["front_width"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["front"]["offsets"]["left"] = product["front_left"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["front"]["offsets"]["top"] = product["front_top"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["front"]["image"]["width"] = product["front_image_width"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["front"]["image"]["height"] = product["front_image_height"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["offsets"]["height"] = product["back_height"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["offsets"]["width"] = product["back_width"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["offsets"]["left"] = product["back_left"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["offsets"]["top"] = product["back_top"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["image"]["width"] = product["back_image_width"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.Product.Dimensions["back"]["image"]["height"] = product["back_image_height"].ToObject<string>() + "px";
            viralstyleItem.MainProduct.ProductId = product["id"].ToObject<int>();

            // Scale image
            var upscaledShirt = new Bitmap(licenseData["viralstyle"]["frontMultiplier"].ToObject<int>() * product["front_width"].ToObject<int>(),
                                           licenseData["viralstyle"]["frontMultiplier"].ToObject<int>() * product["front_height"].ToObject<int>(),
                                           PixelFormat.Format32bppArgb);
            var shirtGraphics = Graphics.FromImage(upscaledShirt);

            (viralstyleItem.Design["front"] as Dictionary<string, object>)["upscaled"] = UpscaledEmptyImage;
            (viralstyleItem.Design["front"] as Dictionary<string, object>)["original"] = ""; //EmptyImage;
            if (frontImage != null && product["front_width"].ToObject<int>() > 0 && product["front_height"].ToObject<int>() > 0)
            {
                var designItem = new ViralstyleDesign()
                                 {
                                     Value = frontImage["data"]["resized_image"]
                                         .ToObject<string>()
                                         .ToLower()
                                         .Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/"),
                                     Colors = new List<string>(),
                                     Id = licenseData["viralstyle"]["frontId"].ToObject<string>()
                                 };
                designItem.ImageData["original_url"] =
                    frontImage["data"]["trimmed_image"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");
                designItem.ImageData["thumbnail_url"] =
                    frontImage["data"]["resized_image"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");
                designItem.ImageData["original_upload_url"] =
                    frontImage["data"]["original_file"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");

                var imageScale = Math.Min(
                                          product["front_width"].ToObject<double>() / frontImage["data"]["width"].ToObject<double>(),
                                          product["front_height"].ToObject<double>() / frontImage["data"]["height"].ToObject<double>()
                                         );

                designItem.ImageData["height"] = frontImage["data"]["height"].ToObject<double>();
                designItem.ImageData["width"] = frontImage["data"]["width"].ToObject<double>();
                designItem.ImageData["left"] = (product["front_width"].ToObject<double>() - frontImage["data"]["width"].ToObject<double>()) / 2;
                designItem.ImageData["top"] = (product["front_height"].ToObject<double>() - frontImage["data"]["height"].ToObject<double>()) / 2;

                designItem.Span["width"] = imageScale * (double) designItem.ImageData["width"];
                designItem.Span["height"] = imageScale * (double) designItem.ImageData["height"];
                if (frontLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = 0d;
                }
                else if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = (product["front_width"].ToObject<double>() - (double) designItem.Span["width"]) / 2;
                }
                else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = product["front_width"].ToObject<double>() - (double) designItem.Span["width"];
                }
                if (frontTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = 0d;
                }
                else if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = (product["front_height"].ToObject<double>() - (double) designItem.Span["height"]) / 2;
                }
                else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = product["front_height"].ToObject<double>() - (double) designItem.Span["height"];
                }
                designItem.Span["rotLeft"] = 0;
                designItem.Span["rotTop"] = 0;
                designItem.Span["index"] = 11;
                designItem.Element["x"] = (double) designItem.ImageData["width"] / 2;
                designItem.Element["y"] = 30;

                var colors = new List<Dictionary<string, object>>();
                foreach (var color in frontImage["data"]["colors"].ToObject<JArray>())
                {
                    colors.Add(
                               new Dictionary<string, object>
                               {
                                   {"hex", "#" + color.ToObject<string>()},
                                   {"times", 1}
                               });

                    designItem.Colors.Add("#" + color.ToObject<string>());
                }

                if (frontImage["data"]["colors_count"].ToObject<string>() == "FULL_COLOR")
                {
                    if (colors.Count < 10)
                    {
                        for (var c = colors.Count; c < 10; c++)
                        {
                            var color = string.Format("#{0:X6}", random.Next(0x1000000));
                            colors.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"hex", color},
                                           {"times", 1}
                                       });
                            designItem.Colors.Add(color);
                        }
                    }
                    else
                    {
                        colors = colors.Take(10).ToList();
                        designItem.Colors = designItem.Colors.Take(10).ToList();
                    }
                }

                viralstyleItem.Colors["totalColors"] = colors;
                viralstyleItem.Colors["totalFrontColors"] = colors;

                viralstyleItem.MainProduct.Front["designerItems"].Add(designItem);

                if (artImage != null)
                {
                    Color[] pallete;
                    Rectangle boundary;
                    var simplifiedImage = SimplifyImage(artImage, null, out pallete, out boundary);
                    simplifiedImage.Dispose();
                    simplifiedImage = null;

                    var scale = Math.Min((float) upscaledShirt.Width / boundary.Width, (float) upscaledShirt.Height / boundary.Height);

                    double x = 0;
                    double y = 0;
                    if (frontLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                    {
                        x = 0d;
                    }
                    else if (frontLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        x = (upscaledShirt.Width - scale * boundary.Width) / 2;
                    }
                    else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        x = upscaledShirt.Width - scale * boundary.Width;
                    }
                    if (frontTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                    {
                        y = 0d;
                    }
                    else if (frontTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        y = (upscaledShirt.Height - scale * boundary.Height) / 2;
                    }
                    else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        y = upscaledShirt.Height - scale * boundary.Height;
                    }

                    shirtGraphics.DrawImage(
                                            artImage,
                                            new Rectangle((int) x, (int) y, (int) (boundary.Width * scale), (int) (boundary.Height * scale)),
                                            boundary.X, boundary.Y, boundary.Width, boundary.Height, GraphicsUnit.Pixel);
                    using (var stream = new MemoryStream())
                    {
                        upscaledShirt.Save(stream, ImageFormat.Png);
                        var imageBytes = stream.ToArray();
                        (viralstyleItem.Design["front"] as Dictionary<string, object>)["upscaled"] = imageBytes.ToBase64("image/png");
                    }
                }

                ((viralstyleItem.Design["front"] as Dictionary<string, object>)["offsets"] as Dictionary<string, double>)["top"] = (double) designItem.Span["top"];
                ((viralstyleItem.Design["front"] as Dictionary<string, object>)["offsets"] as Dictionary<string, double>)["left"] = (double) designItem.Span["left"];
            }

            upscaledShirt.Dispose();
            shirtGraphics.Dispose();

            upscaledShirt = new Bitmap(licenseData["viralstyle"]["backMultiplier"].ToObject<int>() * product["back_width"].ToObject<int>(),
                                       licenseData["viralstyle"]["backMultiplier"].ToObject<int>() * product["back_height"].ToObject<int>(), PixelFormat.Format32bppArgb);
            shirtGraphics = Graphics.FromImage(upscaledShirt);

            (viralstyleItem.Design["back"] as Dictionary<string, object>)["upscaled"] = UpscaledEmptyImage;
            (viralstyleItem.Design["back"] as Dictionary<string, object>)["original"] = ""; //EmptyImage;
            if (backImage != null && product["back_width"].ToObject<int>() > 0 && product["back_height"].ToObject<int>() > 0)
            {
                var designItem = new ViralstyleDesign()
                                 {
                                     Value = backImage["data"]["resized_image"]
                                         .ToObject<string>()
                                         .ToLower()
                                         .Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/"),
                                     Colors = new List<string>(),
                                     Id = licenseData["viralstyle"]["backId"].ToObject<string>()
                                 };
                designItem.ImageData["original_url"] =
                    backImage["data"]["trimmed_image"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");
                designItem.ImageData["thumbnail_url"] =
                    backImage["data"]["resized_image"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");
                designItem.ImageData["original_upload_url"] =
                    backImage["data"]["original_file"].ToObject<string>().ToLower().Replace("https://assets.viralstyle.com/", "https://s3.amazonaws.com/viral-tees/");

                var imageScale = Math.Min(
                                          product["back_width"].ToObject<double>() / backImage["data"]["width"].ToObject<double>(),
                                          product["back_height"].ToObject<double>() / backImage["data"]["height"].ToObject<double>()
                                         );

                designItem.ImageData["height"] = backImage["data"]["height"].ToObject<double>();
                designItem.ImageData["width"] = backImage["data"]["width"].ToObject<double>();
                designItem.ImageData["left"] = (product["back_width"].ToObject<double>() - backImage["data"]["width"].ToObject<double>()) / 2;
                designItem.ImageData["top"] = (product["back_height"].ToObject<double>() - backImage["data"]["height"].ToObject<double>()) / 2;

                designItem.Span["width"] = imageScale * (double) designItem.ImageData["width"];
                designItem.Span["height"] = imageScale * (double) designItem.ImageData["height"];
                if (backLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = 0d;
                }
                else if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = (product["back_width"].ToObject<double>() - (double) designItem.Span["width"]) / 2;
                }
                else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["left"] = product["back_width"].ToObject<double>() - (double) designItem.Span["width"];
                }
                if (backTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = 0d;
                }
                else if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = (product["back_height"].ToObject<double>() - (double) designItem.Span["height"]) / 2;
                }
                else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    designItem.Span["top"] = product["back_height"].ToObject<double>() - (double) designItem.Span["height"];
                }
                designItem.Span["rotLeft"] = 0;
                designItem.Span["rotTop"] = 0;
                designItem.Span["index"] = 11;
                designItem.Element["x"] = (double) designItem.ImageData["width"] / 2;
                designItem.Element["y"] = 30;

                var colors = new List<Dictionary<string, object>>();
                foreach (var color in backImage["data"]["colors"].ToObject<JArray>())
                {
                    colors.Add(
                               new Dictionary<string, object>
                               {
                                   {"hex", "#" + color.ToObject<string>()},
                                   {"times", 1}
                               });

                    designItem.Colors.Add("#" + color.ToObject<string>());
                }

                if (backImage["data"]["colors_count"].ToObject<string>() == "FULL_COLOR")
                {
                    if (colors.Count < 10)
                    {
                        for (var c = colors.Count; c < 10; c++)
                        {
                            var color = string.Format("#{0:X6}", random.Next(0x1000000));
                            colors.Add(
                                       new Dictionary<string, object>
                                       {
                                           {"hex", color},
                                           {"times", 1}
                                       });
                            designItem.Colors.Add(color);
                        }
                    }
                    else
                    {
                        colors = colors.Take(10).ToList();
                        designItem.Colors = designItem.Colors.Take(10).ToList();
                    }
                }

                (viralstyleItem.Colors["totalColors"] as List<Dictionary<string, object>>)?.AddRange(colors);
                viralstyleItem.Colors["totalBackColors"] = colors;

                viralstyleItem.MainProduct.Back["designerItems"].Add(designItem);

                if (backArtImage != null)
                {
                    Color[] pallete;
                    Rectangle boundary;
                    var simplifiedImage = SimplifyImage(backArtImage, null, out pallete, out boundary);
                    simplifiedImage.Dispose();
                    simplifiedImage = null;

                    var scale = Math.Min((float) upscaledShirt.Width / boundary.Width, (float) upscaledShirt.Height / boundary.Height);

                    double x = 0;
                    double y = 0;
                    if (backLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                    {
                        x = 0d;
                    }
                    else if (backLeftAlign.Equals("center", StringComparison.OrdinalIgnoreCase))
                    {
                        x = (upscaledShirt.Width - scale * boundary.Width) / 2;
                    }
                    else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                    {
                        x = upscaledShirt.Width - scale * boundary.Width;
                    }
                    if (backTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                    {
                        y = 0d;
                    }
                    else if (backTopAlign.Equals("middle", StringComparison.OrdinalIgnoreCase))
                    {
                        y = (upscaledShirt.Height - scale * boundary.Height) / 2;
                    }
                    else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                    {
                        y = upscaledShirt.Height - scale * boundary.Height;
                    }

                    shirtGraphics.DrawImage(
                                            backArtImage,
                                            new Rectangle((int) x, (int) y, (int) (boundary.Width * scale), (int) (boundary.Height * scale)),
                                            boundary.X, boundary.Y, boundary.Width, boundary.Height, GraphicsUnit.Pixel);
                    using (var stream = new MemoryStream())
                    {
                        upscaledShirt.Save(stream, ImageFormat.Png);
                        var imageBytes = stream.ToArray();
                        (viralstyleItem.Design["back"] as Dictionary<string, object>)["upscaled"] = imageBytes.ToBase64("image/png");
                    }
                }

                ((viralstyleItem.Design["back"] as Dictionary<string, object>)["offsets"] as Dictionary<string, double>)["top"] = (double) designItem.Span["top"];
                ((viralstyleItem.Design["back"] as Dictionary<string, object>)["offsets"] as Dictionary<string, double>)["left"] = (double) designItem.Span["left"];
            }

            upscaledShirt.Dispose();
            shirtGraphics.Dispose();

            viralstyleItem.AdditionalProducts = additionalProducts.Skip(1).ToArray();
            viralstyleItem.Pricing["basePrice"] = additionalProducts.FirstOrDefault().BasePrice;
            viralstyleItem.Pricing["sellingPrice"] = additionalProducts.FirstOrDefault().SellingPrice;
            viralstyleItem.Pricing["dtgPrice"] = additionalProducts.FirstOrDefault().DtgPrice;

            var result =
                Viralstyle.Upload(viralstyleItem, pageToken, token["token_type"]?.ToObject<string>() + " " + token["access_token"]?.ToObject<string>(),
                                  viralstyleCookies);
            if (result != null && result["success"] != null && result["success"].ToObject<bool>() == true)
            {
                var ret = Viralstyle.UpdateTracking(result["data"]["campaign_id"].ToObject<string>(), facebookPixel, pageToken, viralstyleCookies);

                return (true, "Viralstyle - Upload design successfully.",
                    new[]
                    {
                        "https://viralstyle.com/" + viralstyleAccount["user"]["user_info"]["public_name"].ToObject<string>() + "/" + viralstyleItem.CampaignUrl
                    });
            }

            return (false, "Viralstyle - Upload failed", null);
        }

#endif

        #endregion

        #region Platform Teezily

#if TEEZILY

        private const string TeezilyUsernameEncryptionKey = "80XFkq9UgKa0hG40uvtDTH3aXJWwCxbBaLZOgjuu5CuilfuK9avEwmGFppHv";
        private const string TeezilyPasswordEncryptionKey = "FtiIwhNM1ChYq1lJHbrEqn78viCGLhuekj1HJnfW1zbhakhgfyJucG4JQrBs";

        private void Teezily_IsDefaultChanged(object sender, EventArgs e)
        {
            var productControl = sender as TeezilyProduct;
            if (productControl == null || productControl.CheckBoxIsDefault.Checked == false)
            {
                return;
            }

            foreach (Control control in FlowLayoutTeezily.Controls)
            {
                if (control is TeezilyProduct && (int) control.Tag != (int) productControl.Tag)
                {
                    (control as TeezilyProduct).CheckBoxIsDefault.Checked = false;
                }
            }
        }

        private void CheckBoxTeezily_CheckedChanged(object sender, EventArgs e)
        {
            LabelTeezilyAccounts.Enabled = CheckBoxTeezily.Checked;
            ComboBoxTeezilyAccounts.Enabled = CheckBoxTeezily.Checked;
            ButtonAddTeezilyAccount.Enabled = CheckBoxTeezily.Checked;
            ButtonRemoveTeezilyAccount.Enabled = CheckBoxTeezily.Checked;
            ButtonImportTeezilyAccounts.Enabled = CheckBoxTeezily.Checked;
            ButtonRemoveAllTeezilyAccounts.Enabled = CheckBoxTeezily.Checked;
        }

        private void CheckedListBoxTeezilyProducts_ItemCheck(object sender, ItemCheckEventArgs e)
        {
            if (e.NewValue == CheckState.Checked && teezilyProducts != null && teezilyProducts.Count > 0)
            {
                // Add
                var productControl = new TeezilyProduct();
                productControl.SetProduct(teezilyProducts[e.Index]);
                productControl.Tag = e.Index;
                productControl.IsDefaultChanged += Teezily_IsDefaultChanged;
                FlowLayoutTeezily.Controls.Add(productControl);

                // Check price
                var sides = teezilyProducts[e.Index]["sides"].ToObject<JArray>().ToList();
                var price = Teezily.GetPrice(teezilyProducts[e.Index]["id"].ToObject<int>(),
                                             teezilyProducts[e.Index]["colors"][0]["name"].ToObject<string>(), 0,
                                             !sides.Any(x => x["name"].ToObject<string>().ToLower() == "front")
                                                 ? null
                                                 : new TeezilyDrawableArea()
                                                   {
                                                       SideId = sides.First(x => x["name"].ToObject<string>().ToLower() == "front")["id"].ToObject<int>()
                                                   },
                                             !sides.Any(x => x["name"].ToObject<string>().ToLower() == "back")
                                                 ? null
                                                 : new TeezilyDrawableArea()
                                                   {
                                                       SideId = sides.First(x => x["name"].ToObject<string>().ToLower() == "back")["id"].ToObject<int>()
                                                   },
                                             new CookieContainer());
                price *= teezilyInfo["currency_exchange_rate"]["usd"].ToObject<decimal>();
                productControl.NumericUpDownPrice.Value = Teezily.GetRecommendedPrice(teezilyProducts[e.Index]["reference"].ToObject<string>(), "usd");
                if (productControl.NumericUpDownPrice.Value == 0)
                {
                    productControl.NumericUpDownPrice.Value = price + 0.95M;
                }
                productControl.NumericUpDownPrice.Minimum = price;
            }
            else
            {
                // Remove
                foreach (Control control in FlowLayoutTeezily.Controls)
                {
                    if (control is TeezilyProduct && (int) control.Tag == e.Index)
                    {
                        (control as TeezilyProduct).IsDefaultChanged -= Teezily_IsDefaultChanged;
                        FlowLayoutTeezily.Controls.Remove(control);
                        control.Dispose();
                        break;
                    }
                }
            }
        }

        private void AddTeezilyAccount(string username, string password)
        {
            // Save to Teezily accounts
            if (!Directory.Exists("Platform/Teezily"))
            {
                Directory.CreateDirectory("Platform/Teezily");
            }

            var accounts = ComboBoxTeezilyAccounts.DataSource as List<KeyValuePair<string, string>> ?? new List<KeyValuePair<string, string>>();

            if (accounts.Exists(x => x.Key.ToLower() == username.ToLower()))
            {
                MessageBox.Show("This account is already added.", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            accounts.Add(new KeyValuePair<string, string>(username, password));
            ComboBoxTeezilyAccounts.DataSource = null;
            ComboBoxTeezilyAccounts.DataSource = accounts;
            ComboBoxTeezilyAccounts.DisplayMember = "Key";
            ComboBoxTeezilyAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var account in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(account.Key, TeezilyUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(account.Value, TeezilyPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teezily/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonAddTeezilyAccount_Click(object sender, EventArgs e)
        {
            var form = new FormAddAccount();
            if (form.ShowDialog() == DialogResult.OK)
            {
                AddTeezilyAccount(form.TextBoxUsername.Text, form.TextBoxPassword.Text);
            }
        }

        private void ButtonRemoveTeezilyAccount_Click(object sender, EventArgs e)
        {
            if (ComboBoxTeezilyAccounts.SelectedItem == null)
            {
                return;
            }

            var account = (KeyValuePair<string, string>) ComboBoxTeezilyAccounts.SelectedItem;

            var accounts = ComboBoxTeezilyAccounts.DataSource as List<KeyValuePair<string, string>> ?? new List<KeyValuePair<string, string>>();
            accounts.Remove(account);
            ComboBoxTeezilyAccounts.DataSource = null;
            ComboBoxTeezilyAccounts.DataSource = accounts;
            ComboBoxTeezilyAccounts.DisplayMember = "Key";
            ComboBoxTeezilyAccounts.ValueMember = "Value";

            var json = new List<Dictionary<string, string>>();
            foreach (var acc in accounts)
            {
                var saltUsername = Common.CreateSalt(128);
                var saltPassword = Common.CreateSalt(128);
                json.Add(
                         new Dictionary<string, string>
                         {
                             {"Username", saltUsername + "=" + Common.Encrypt(acc.Key, TeezilyUsernameEncryptionKey, saltUsername)},
                             {"Password", saltPassword + "=" + Common.Encrypt(acc.Value, TeezilyPasswordEncryptionKey, saltPassword)}
                         });
            }

            File.WriteAllText("Platform/Teezily/Accounts.txt", JsonConvert.SerializeObject(json), Encoding.UTF8);
        }

        private void ButtonImportTeezilyAccounts_Click(object sender, EventArgs e)
        {
            ImportAccounts(AddTeezilyAccount);
        }

        private void ButtonRemoveAllTeezilyAccounts_Click(object sender, EventArgs e)
        {
            ComboBoxTeezilyAccounts.DataSource = null;
            File.Delete("Platform/Teezily/Accounts.txt");
        }

        private void ComboBoxTeezilyAccounts_SelectedIndexChanged(object sender, EventArgs e)
        {
            teezilyCookies = null;
        }

        private void InitTeezily()
        {
            LoadTeezilyAccounts();

            if (teezilyCookies == null)
            {
                teezilyCookies = new CookieContainer();
            }
            var campaign = Teezily.CreateCampaign(teezilyCookies);
            teezilyInfo = campaign.CampaignInfo;
            var categories = new List<KeyValuePair<string, string>>();
            if (campaign.Categories != null)
            {
                foreach (var category in campaign.Categories)
                {
                    categories.Add(new KeyValuePair<string, string>(category["id"].ToObject<string>(), category["path"].ToObject<string>()));
                }
            }
            TeezilyCategory.Items = categories;

            LoadTeezilyProducts(FlowLayoutTeezily);
            for (var i = 0; i < CheckedListBoxTeezilyProducts.Items.Count; i++)
            {
                CheckedListBoxTeezilyProducts.SetItemChecked(i, true);
                CheckedListBoxTeezilyProducts.SetItemChecked(i, false);
            }
        }

        private void LoadTeezilyAccounts()
        {
            if (!File.Exists("Platform/Teezily/Accounts.txt"))
            {
                return;
            }

            var content = File.ReadAllText("Platform/Teezily/Accounts.txt");
            var json = JsonConvert.DeserializeObject<JArray>(content);

            var accounts = new List<KeyValuePair<string, string>>();
            foreach (var acc in json)
            {
                try
                {
                    var username = acc["Username"].ToObject<string>();
                    var password = acc["Password"].ToObject<string>();
                    var index = username.IndexOf('=');
                    while (index < username.Length - 1 && username[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltUsername = username.Substring(0, index);
                    username = Common.Decrypt(username.Substring(index + 1), TeezilyUsernameEncryptionKey, saltUsername);
                    index = password.IndexOf('=');
                    while (index < password.Length - 1 && password[index + 1] == '=')
                    {
                        ++index;
                    }

                    var saltPassword = password.Substring(0, index);
                    password = Common.Decrypt(password.Substring(index + 1), TeezilyPasswordEncryptionKey, saltPassword);
                    accounts.Add(new KeyValuePair<string, string>(username, password));
                }
                catch (Exception exc)
                {
                }
            }

            ComboBoxTeezilyAccounts.DataSource = accounts;
        }

        private void LoadTeezilyProducts(Control container)
        {
            if (container == null)
            {
                return;
            }

            teezilyProducts = new List<JToken>();
            var teezilyProductsInfo = Teezily.GetProducts(teezilyCookies);
            if (teezilyProductsInfo != null)
            {
                // Create products
                foreach (var group in teezilyProductsInfo.ToObject<JArray>())
                {
                    foreach (var product in group["products"].ToObject<JArray>())
                    {
                        teezilyProducts.Add(product);
                        CheckedListBoxTeezilyProducts.Items.Add($"{product["name"].ToObject<string>()} ({product["id"].ToObject<string>()})");
                    }
                }
            }
            else
            {
                MessageBox.Show(
                                @"Error happens when connect to Teezily server. Please check your Internet connection and run application again.
You can upload to other platforms also.",
                                @"Auto Upload",
                                MessageBoxButtons.OK,
                                MessageBoxIcon.Error);
            }
        }

        private string GeneratePublishToken(string appToken)
        {
            string GetNextCharacter(int index)
            {
                if (index < 0 || index >= appToken.Length)
                {
                    return "";
                }
                var newIndex = char.ConvertToUtf32(appToken, index);
                newIndex -= newIndex % 8;
                newIndex /= 8;

                return appToken[index] + GetNextCharacter(newIndex + index + 1);
            }

            return GetNextCharacter(0);
        }

        private (bool Result, string Message, string[] Links) UploadTeezily(
            Image image,
            string path,
            Image backImage,
            string backPath,
            string frontLeftAlign,
            string frontTopAlign,
            string backLeftAlign,
            string backTopAlign,
            string title,
            string description,
            string teezilyCategory,
            string keywords,
            int duration,
            string url,
            int goal,
            bool isPrivate,
            bool autoRestart,
            string facebookPixel,
            string googleAnalytics,
            string currency = "eur")
        {
            if (licenseData?["teezily"] == null)
            {
                return (false, "You don't have license of Teezily.", null);
            }
            if (teezilyCookies == null)
            {
                return (false, "You didn't login to Teezily. Please check your Teezily account.", null);
            }

            if (string.IsNullOrEmpty(path) && string.IsNullOrEmpty(backPath))
            {
                return (false, "There are no images to upload.", null);
            }

            var campaign = Teezily.CreateCampaign(teezilyCookies);
            var item = new TeezilyItem(campaign.CampaignInfo);

            title = Truncate(title, 40);
            description = Truncate(description, 800);
            url = Truncate(url, 30);

            var totalColorsCount = 0;
            JToken defaultProduct = null;
            foreach (var control in FlowLayoutTeezily.Controls)
            {
                if (control is TeezilyProduct)
                {
                    var teezilyProduct = (TeezilyProduct) control;
                    if (teezilyProduct.SelectedColors.Count > 0)
                    {
                        totalColorsCount += teezilyProduct.SelectedColors.Count;

                        if (defaultProduct == null || teezilyProduct.CheckBoxIsDefault.Checked)
                        {
                            defaultProduct = teezilyProduct.Product;
                        }

                        var productSides = teezilyProduct.Product["sides"].ToObject<JArray>().ToList();
                        var minimum = Teezily.GetPrice(teezilyProduct.Product["id"].ToObject<int>(),
                                                       teezilyProduct.SelectedColors[0], goal,
                                                       !productSides.Any(x => x["name"].ToObject<string>().ToLower() == "front")
                                                           ? null
                                                           : new TeezilyDrawableArea()
                                                             {
                                                                 SideId = productSides.First(x => x["name"].ToObject<string>().ToLower() == "front")["id"].ToObject<int>()
                                                             },
                                                       !productSides.Any(x => x["name"].ToObject<string>().ToLower() == "back")
                                                           ? null
                                                           : new TeezilyDrawableArea()
                                                             {
                                                                 SideId = productSides.First(x => x["name"].ToObject<string>().ToLower() == "back")["id"].ToObject<int>()
                                                             },
                                                       teezilyCookies);
                        minimum *= item.CurrencyExchangeRate[currency];

                        var price = teezilyProduct.NumericUpDownPrice.Value;
                        if (price < minimum)
                        {
                            price = minimum;
                        }

                        price /= item.CurrencyExchangeRate[currency];
                        for (var i = 0; i < teezilyProduct.SelectedColors.Count; i++)
                        {
                            if (teezilyProduct.CheckBoxIsDefault.Checked && i == 0)
                            {
                                item.Items.Insert(0, new TeezilyGarmentItem()
                                                     {
                                                         Price = price,
                                                         ProductId = teezilyProduct.Product["id"].ToObject<int>(),
                                                         Color = teezilyProduct.SelectedColors[i]
                                                     });
                            }
                            else
                            {
                                item.Items.Add(new TeezilyGarmentItem()
                                               {
                                                   Price = price,
                                                   ProductId = teezilyProduct.Product["id"].ToObject<int>(),
                                                   Color = teezilyProduct.SelectedColors[i]
                                               });
                            }
                        }
                    }
                }
            }

            if (totalColorsCount == 0)
            {
                return (false, "Teezily - You must select at least 1 garment and color.", null);
            }

            if (totalColorsCount > 100)
            {
                return (false, "Teezily - You cannot select more than 100 garment and color combinations.", null);
            }

            var sides = defaultProduct["sides"].ToObject<JArray>().ToList();

            TeezilyDrawableArea front;
            TeezilyDrawableArea back;
            var input = string.IsNullOrEmpty(path) ? null : new FileStream(path, FileMode.Open, FileAccess.Read);
            var frontImageResult = input == null ? null : Teezily.UploadImage(path, input, teezilyCookies);
            input?.Close();
            if (!string.IsNullOrEmpty(path) && frontImageResult == null)
            {
                return (false, "Teezily - Upload front image failed. Maybe it's too small.", null);
            }

            var grid = 4;
            var canvasWidth = 600;
            var canvasHeight = 800;
            if (frontImageResult != null && defaultProduct["sides"].ToObject<JArray>().ToList().Any(i => i["name"].ToObject<string>().ToLower() == "front"))
            {
                front = new TeezilyDrawableArea()
                        {
                            SaveObject = new List<TeezilySaveObject>()
                        };

                // Calculate boundary
                var side = defaultProduct["sides"].ToObject<JArray>().ToList().First(i => i["name"].ToObject<string>().ToLower() == "front");
                var scaleX = (float) canvasWidth / image.Width;
                var scaleY = (float) canvasHeight / image.Height;
                var scale = Math.Min(scaleX, scaleY);
                var newWidth = (int) Math.Round(image.Width * scale);
                var newHeight = (int) Math.Round(image.Height * scale);
                scale = Math.Min(side["drawable_width_px"].ToObject<int>() / (float) newWidth, side["drawable_height_px"].ToObject<int>() / (float)newHeight);
                var x = side["offset_left"].ToObject<int>() + side["drawable_width_px"].ToObject<int>() / 2;
                var y = side["offset_top"].ToObject<int>() + side["drawable_height_px"].ToObject<int>() / 2;
                if (frontLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                {
                    x = side["offset_left"].ToObject<int>() + (int) Math.Round(newWidth * scale) / 2;
                }
                else if (frontLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    x = side["offset_left"].ToObject<int>() + side["drawable_width_px"].ToObject<int>() - (int) Math.Round(newWidth * scale) / 2;
                }
                if (frontTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                {
                    y = side["offset_top"].ToObject<int>() + (int) Math.Round(newHeight * scale) / 2;
                }
                else if (frontTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    y = side["offset_top"].ToObject<int>() + side["drawable_height_px"].ToObject<int>() - (int) Math.Round(newHeight * scale) / 2;
                }
                x += x % grid;
                y += y % grid;

                front.SaveObject.Add(new TeezilySaveObject()
                                     {
                                         FabricObject = new TeezilyFabricObject()
                                                        {
                                                            Width = newWidth,
                                                            Height = newHeight,
                                                            Left = x,
                                                            Top = y,
                                                            ScaleX = scale,
                                                            ScaleY = scale
                                                        },
                                         Filename = frontImageResult[0]["filename"].ToObject<string>(),
                                         Format = frontImageResult[0]["format"].ToObject<string>(),
                                         Image = frontImageResult[0]["image"].ToObject<string>(),
                                         Resolution = new Dictionary<string, int>()
                                                      {
                                                          {"width", frontImageResult[0]["resolution"]["width"].ToObject<int>()},
                                                          {"height", frontImageResult[0]["resolution"]["height"].ToObject<int>()}
                                                      },
                                         Sha1 = frontImageResult[0]["sha1"].ToObject<string>(),
                                         Url = frontImageResult[0]["url"].ToObject<string>()
                                     });

                using (var stream = new MemoryStream())
                {
                    var tempImage = PhotoshopHelper.CreateThumbnail(path,
                                                                    side["drawable_width_px"].ToObject<int>() * 2,
                                                                    side["drawable_height_px"].ToObject<int>() * 2,
                                                                    frontLeftAlign, frontTopAlign);
                    tempImage.Save(stream, image.RawFormat);
                    var imageBytes = stream.ToArray();
                    var codec = ImageCodecInfo.GetImageDecoders().First(c => c.FormatID == image.RawFormat.Guid);
                    front.Base64Image = imageBytes.ToBase64(codec.MimeType);
                    stream.Close();
                    tempImage.Dispose();
                }

                front.SideId = sides.First(i => i["name"].ToObject<string>().ToLower() == "front")["id"].ToObject<int>();
            }
            else
            {
                // Set empty image
                if (sides.Any(x => x["name"].ToObject<string>().ToLower() == "front"))
                {
                    front = new TeezilyDrawableArea()
                            {
                                Base64Image = null,
                                SaveObject = new List<TeezilySaveObject>(),
                                SideId = sides.First(x => x["name"].ToObject<string>().ToLower() == "front")["id"].ToObject<int>()
                            };
                }
                else
                {
                    front = null;
                }
            }

            input = string.IsNullOrEmpty(backPath) ? null : new FileStream(backPath, FileMode.Open, FileAccess.Read);
            var backImageResult = input == null ? null : Teezily.UploadImage(backPath, input, teezilyCookies);
            input?.Close();
            if (!string.IsNullOrEmpty(backPath) && backImageResult == null)
            {
                return (false, "Teezily - Upload back image failed. Maybe it's too small.", null);
            }

            if (backImageResult != null && defaultProduct["sides"].ToObject<JArray>().ToList().Any(i => i["name"].ToObject<string>().ToLower() == "back"))
            {
                back = new TeezilyDrawableArea()
                       {
                           SaveObject = new List<TeezilySaveObject>()
                       };

                // Calculate boundary
                var side = defaultProduct["sides"].ToObject<JArray>().ToList().First(i => i["name"].ToObject<string>().ToLower() == "back");
                var scaleX = (float) canvasWidth / backImage.Width;
                var scaleY = (float) canvasHeight / backImage.Height;
                var scale = Math.Min(scaleX, scaleY);
                var newWidth = (int) Math.Round(backImage.Width * scale);
                var newHeight = (int) Math.Round(backImage.Height * scale);
                scale = Math.Min(side["drawable_width_px"].ToObject<int>() / (float) newWidth, side["drawable_height_px"].ToObject<int>() / (float)newHeight);
                var x = side["offset_left"].ToObject<int>() + side["drawable_width_px"].ToObject<int>() / 2;
                var y = side["offset_top"].ToObject<int>() + side["drawable_height_px"].ToObject<int>() / 2;
                if (backLeftAlign.Equals("left", StringComparison.OrdinalIgnoreCase))
                {
                    x = side["offset_left"].ToObject<int>() + (int) Math.Round(newWidth * scale) / 2;
                }
                else if (backLeftAlign.Equals("right", StringComparison.OrdinalIgnoreCase))
                {
                    x = side["offset_left"].ToObject<int>() + side["drawable_width_px"].ToObject<int>() - (int) Math.Round(newWidth * scale) / 2;
                }
                if (backTopAlign.Equals("top", StringComparison.OrdinalIgnoreCase))
                {
                    y = side["offset_top"].ToObject<int>() + (int) Math.Round(newHeight * scale) / 2;
                }
                else if (backTopAlign.Equals("bottom", StringComparison.OrdinalIgnoreCase))
                {
                    y = side["offset_top"].ToObject<int>() + side["drawable_height_px"].ToObject<int>() - (int) Math.Round(newHeight * scale) / 2;
                }
                x += x % grid;
                y += y % grid;

                back.SaveObject.Add(new TeezilySaveObject()
                                    {
                                        FabricObject = new TeezilyFabricObject()
                                                       {
                                                           Width = newWidth,
                                                           Height = newHeight,
                                                           Left = x,
                                                           Top = y,
                                                           ScaleX = scale,
                                                           ScaleY = scale
                                                       },
                                        Filename = backImageResult[0]["filename"].ToObject<string>(),
                                        Format = backImageResult[0]["format"].ToObject<string>(),
                                        Image = backImageResult[0]["image"].ToObject<string>(),
                                        Resolution = new Dictionary<string, int>()
                                                     {
                                                         {"width", backImageResult[0]["resolution"]["width"].ToObject<int>()},
                                                         {"height", backImageResult[0]["resolution"]["height"].ToObject<int>()}
                                                     },
                                        Sha1 = backImageResult[0]["sha1"].ToObject<string>(),
                                        Url = backImageResult[0]["url"].ToObject<string>()
                                    });

                using (var stream = new MemoryStream())
                {
                    var tempImage = PhotoshopHelper.CreateThumbnail(backPath,
                                                                    side["drawable_width_px"].ToObject<int>() * 2,
                                                                    side["drawable_height_px"].ToObject<int>() * 2,
                                                                    backLeftAlign, backTopAlign);
                    tempImage.Save(stream, backImage.RawFormat);
                    var imageBytes = stream.ToArray();
                    var codec = ImageCodecInfo.GetImageDecoders().First(c => c.FormatID == backImage.RawFormat.Guid);
                    back.Base64Image = imageBytes.ToBase64(codec.MimeType);
                    stream.Close();
                    tempImage.Dispose();
                }

                back.SideId = sides.First(i => i["name"].ToObject<string>().ToLower() == "back")["id"].ToObject<int>();
            }
            else
            {
                // Set empty image
                if (sides.Any(x => x["name"].ToObject<string>().ToLower() == "back"))
                {
                    back = new TeezilyDrawableArea()
                           {
                               Base64Image = null,
                               SaveObject = new List<TeezilySaveObject>(),
                               SideId = sides.First(x => x["name"].ToObject<string>().ToLower() == "back")["id"].ToObject<int>()
                           };
                }
                else
                {
                    back = null;
                }
            }

            if (front != null)
            {
                item.DrawableAreas.Add(front);
            }
            if (back != null)
            {
                item.DrawableAreas.Add(back);
            }

            item.Currency = currency;
            item.DaysLimit = duration;
            item.Name = title;
            item.Description = description;
            item.HashTags = (keywords ?? "").Split(new char[] {',', ' '}, StringSplitOptions.RemoveEmptyEntries).Select(x => x.Trim()).Take(15).ToArray();
            item.Slug = url;
            item.Url = $"http://www.teezily.com/{url}";
            item.Links["show"] = $"http://www.teezily.com/{url}";
            item.SalesGoal = goal;
            item.Relaunchable = autoRestart;
            item.InMarketplace = !isPrivate;
            item.PublishedToken = GeneratePublishToken(campaign.AppToken);
            var categories = (teezilyCategory ?? "").Split(new char[] {';'}, StringSplitOptions.RemoveEmptyEntries);
            if (categories.Length > 0)
            {
                item.MarketplaceCategoryIds = new List<int>();
                foreach (var cat in categories)
                {
                    if (int.TryParse(cat, out int num))
                    {
                        item.MarketplaceCategoryIds.Add(num);
                    }
                }
            }

            var result = Teezily.UploadCampaign(item, campaign.Token, teezilyCookies);
            if (result != null)
            {
                Logger.WriteLog("upload result: " + result.ToString());
                result = JsonConvert.DeserializeObject<JToken>(result.ToString());
                var launchResult = Teezily.LaunchCampaign(result["redirect_to"]["publish"].ToObject<string>(), campaign.CampaignId, teezilyCookies);

                if (!string.IsNullOrEmpty(facebookPixel))
                {
                    Teezily.UpdateFacebookPixel(campaign.CampaignId, facebookPixel, campaign.Token, teezilyCookies);
                }

                if (autoRestart)
                {
                    Teezily.UpdateRelaunch(campaign.CampaignId, campaign.Token, teezilyCookies);
                }

                return (true, "Teezily - Upload to Teezily successfully.", new[] {$"http://www.teezily.com/{url}"});
            }

            return (false, "Teezily - Error happens while uploading design. Please check information and price. Detail error: ", null);
        }

#endif

        #endregion

        #region Platform Gearbubble

        #endregion

        #region Mockups creation

#if MOCKUP

        private void InitMockup()
        {
            FileStream fileStream;
            if (File.Exists("mockups.txt"))
            {
                fileStream = new FileStream("mockups.txt", FileMode.Open, FileAccess.Read, FileShare.None);
                mockupTemplates = Mockup.LoadMockupTemplates(fileStream);
                fileStream.Close();
            }
            else
            {
                mockupTemplates = new List<MockupTemplate>();
            }

            try
            {
                var updateMockups = Mockup.UpdateMockupTemplates(
                                                                 License.Email,
                                                                 License.LicenseKey,
                                                                 License.GetMachineId(),
#if DEBUG
                                                                 "B0A1-6552-36D3-CCB7-04E5-0812-63F7-DB64");
#else
                                                                 License.GetFileChecksum());
#endif

                foreach (var item in updateMockups)
                {
                    var oldItem = mockupTemplates.FirstOrDefault(x => x.Id == item.Id);
                    if (oldItem == null)
                    {
                        mockupTemplates.Add(item);
                    }
                    else if (oldItem.UpdatedOn < item.UpdatedOn)
                    {
                        oldItem.FilePath = "";
                        oldItem.ThumbnailPath = "";
                        oldItem.UpdatedOn = item.UpdatedOn;
                        oldItem.Category = item.Category;
                        oldItem.Name = item.Name;
                    }
                    else
                    {
                        oldItem.Category = item.Category;
                        oldItem.Name = item.Name;
                    }
                }

                mockupTemplates.OrderBy(x => x.Category).ThenBy(x => x.Name);
            }
            catch (Exception exc)
            {
                MessageBox.Show(exc.Message, "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            ImageListMockups.Images.Clear();
            ListViewMockupTemplates.Items.Clear();
            ListViewMockupTemplates.Groups.Clear();

            var groups = mockupTemplates.Select(x => x.Category).Distinct().OrderBy(x => x);
            foreach (var group in groups)
            {
                ListViewMockupTemplates.Groups.Add(string.IsNullOrEmpty(group) ? "Default" : group, string.IsNullOrEmpty(group) ? "Default" : group);
            }

            foreach (var mockup in mockupTemplates)
            {
                // Load thumbnail
                if (string.IsNullOrEmpty(mockup.ThumbnailPath))
                {
                    // Download
                    if (!Directory.Exists("Mockups/Thumbnails/"))
                    {
                        Directory.CreateDirectory("Mockups/Thumbnails/");
                    }

                    var outputStream = new FileStream($"Mockups/Thumbnails/{mockup.Id}.jpg", FileMode.Create, FileAccess.Write);
                    Common.DownloadFile(string.Format(Mockup.DownloadThumbnailUrl, mockup.Id), outputStream);
                    outputStream.Close();

                    mockup.ThumbnailPath = Path.GetFullPath($"Mockups/Thumbnails/{mockup.Id}.jpg");
                }

                var thumbImage = PhotoshopHelper.CreateThumbnail(mockup.ThumbnailPath, ImageListMockups.ImageSize.Width, ImageListMockups.ImageSize.Height);
                if (thumbImage == null)
                {
                    thumbImage = new Bitmap(ImageListMockups.ImageSize.Width, ImageListMockups.ImageSize.Height);
                }
                ImageListMockups.Images.Add(thumbImage);
                var item = ListViewMockupTemplates.Items.Add(mockup.Id, mockup.Name, ImageListMockups.Images.Count - 1);
                foreach (ListViewGroup group in ListViewMockupTemplates.Groups)
                {
                    if (group.Name == mockup.Category || (string.IsNullOrEmpty(mockup.Category) && group.Name == "Default"))
                    {
                        item.Group = group;
                        break;
                    }
                }
                item.SubItems.Add(string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath) ? "Not download" : "Downloaded");
            }

            fileStream = new FileStream("mockups.txt", FileMode.Create, FileAccess.Write, FileShare.None);
            Mockup.SaveMockupTemplates(fileStream, mockupTemplates);
            fileStream.Close();
        }

        private void ButtonCreateMockups_Click(object sender, EventArgs e)
        {
            // Add current designs to mockup creation
            foreach (var design in designList)
            {
                AddDesignMockup(design[0], design[1], design[2], design[3], design[4]);
            }

            // Move to mockup tab
            MainTabControl.SelectTab(1);
        }

        private void ButtonDownloadMissingTemplates_Click(object sender, EventArgs e)
        {
            // Start downloading missing mockup templates
            var needToUpdate = new List<string>();
            foreach (var mockup in mockupTemplates)
            {
                if (string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath))
                {
                    needToUpdate.Add(mockup.Id);
                }
            }
            afterDownloadMockupTemplate = 0;
            BackgroundWorkerDownloadMockupTemplates.RunWorkerAsync(needToUpdate);
            loadingForm.LabelLoadingDescription.Text = "Downloading mockup templates. This will take long time because of big size of files. Please be patient.";
            try
            {
                loadingForm.ShowDialog();
            }
            catch (Exception exc)
            {
            }
        }

        private void ButtonCheckTemplatesUpdate_Click(object sender, EventArgs e)
        {
            InitMockup();
        }

        private void TextBoxSearchMockupTemplates_TextChanged(object sender, EventArgs e)
        {
            // Filter list
            ListViewMockupTemplates.Items.Clear();
            ListViewMockupTemplates.Groups.Clear();

            var groups = mockupTemplates.Where(x => (x.Category ?? "").ToLower().Contains(TextBoxSearchMockupTemplates.Text.ToLower()) ||
                                                    x.Name.ToLower().Contains(TextBoxSearchMockupTemplates.Text.ToLower()))
                                        .Select(x => x.Category)
                                        .Distinct()
                                        .OrderBy(x => x);
            foreach (var group in groups)
            {
                ListViewMockupTemplates.Groups.Add(string.IsNullOrEmpty(group) ? "Default" : group, string.IsNullOrEmpty(group) ? "Default" : group);
            }

            for (var i = 0; i < mockupTemplates.Count; i++)
            {
                if (mockupTemplates[i].Name.ToLower().Contains(TextBoxSearchMockupTemplates.Text.ToLower())
                    || (mockupTemplates[i].Category ?? "").ToLower().Contains(TextBoxSearchMockupTemplates.Text.ToLower()))
                {
                    var item = ListViewMockupTemplates.Items.Add(mockupTemplates[i].Id, mockupTemplates[i].Name, i);
                    foreach (ListViewGroup group in ListViewMockupTemplates.Groups)
                    {
                        if (group.Name == mockupTemplates[i].Category || (string.IsNullOrEmpty(mockupTemplates[i].Category) && group.Name == "Default"))
                        {
                            item.Group = group;
                            break;
                        }
                    }
                    item.SubItems.Add(string.IsNullOrEmpty(mockupTemplates[i].FilePath) || !File.Exists(mockupTemplates[i].FilePath) ? @"Not download" : @"Downloaded");
                }
            }
        }

        private void ButtonAddDesign_Click(object sender, EventArgs e)
        {
            if (OpenFileDialogImages.ShowDialog() == DialogResult.OK)
            {
                foreach (var file in OpenFileDialogImages.FileNames)
                {
                    AddDesignMockup(file);
                }
            }
        }

        private void ButtonRemoveDesigns_Click(object sender, EventArgs e)
        {
            foreach (ListViewItem designItem in ListViewDesigns.CheckedItems)
            {
                designItem.Remove();
            }
        }

        private void ButtonAddMockups_Click(object sender, EventArgs e)
        {
            if (ListViewMockupTemplates.CheckedItems.Count == 0)
            {
                MessageBox.Show("You must select at least 1 mockup template", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }
            if (ListViewDesigns.CheckedItems.Count == 0)
            {
                MessageBox.Show("You must select at least 1 design", "Auto Upload", MessageBoxButtons.OK, MessageBoxIcon.Error);
                return;
            }

            // Add combination of mockup templates and design
            foreach (ListViewItem mockupTemplateItem in ListViewMockupTemplates.CheckedItems)
            {
                foreach (ListViewItem designItem in ListViewDesigns.CheckedItems)
                {
                    var row = new object[]
                              {
                                  mockupTemplateItem.Name,
                                  mockupTemplateItem.Text,
                                  designItem.Name,
                                  designItem.Text,
                                  string.IsNullOrEmpty(designItem.SubItems[1]?.Text) ? "Center" : designItem.SubItems[1].Text,
                                  string.IsNullOrEmpty(designItem.SubItems[2]?.Text) ? "Middle" : designItem.SubItems[2].Text,
                                  "No color",
                                  "",
                                  "",
                                  "",
                                  "",
                                  "",
                                  designItem.SubItems.Count < 5 || string.IsNullOrEmpty(designItem.SubItems[4]?.Text) ? "" : designItem.SubItems[4].Text,
                                  "",
                              };
                    GridViewMockupResults.Rows.Add(row);
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].ContextMenuStrip = ContextMenuStripMockups;
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["DesignBackgroundColor"].Style.BackColor = new Color();
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["DesignBackgroundColor"].Style.SelectionBackColor = Color.White;
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["ShirtColor"].Style.BackColor = Color.White;
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["ShirtColor"].Style.SelectionBackColor = Color.White;
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["LaceColor"].Style.BackColor = Color.White;
                    GridViewMockupResults.Rows[GridViewMockupResults.Rows.Count - 1].Cells["LaceColor"].Style.SelectionBackColor = Color.White;
                }
            }
        }

        private void ButtonRemoveMockups_Click(object sender, EventArgs e)
        {
            if (GridViewMockupResults.SelectedCells.Count > 0)
            {
                var rows = new List<DataGridViewRow>();
                foreach (DataGridViewCell cell in GridViewMockupResults.SelectedCells)
                {
                    if (!rows.Contains(cell.OwningRow))
                    {
                        rows.Add(cell.OwningRow);
                    }
                }
                rows = rows.OrderBy(x => x.Index).ToList();
                foreach (var row in rows)
                {
                    GridViewMockupResults.Rows.Remove(row);
                }
            }
        }

        private void ButtonSaveToFolder_Click(object sender, EventArgs e)
        {
            if (GridViewMockupResults.Rows.Count == 0)
            {
                return;
            }

            if (FolderBrowserDialogMockups.ShowDialog() == DialogResult.OK)
            {
                // Check if need to download
                var needToUpdate = new List<string>();
                foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                {
                    row.Cells["Status"].Value = "";
                    var id = row.Cells["MockupTemplateId"].Value.ToString();
                    var mockup = mockupTemplates.FirstOrDefault(x => x.Id == id);
                    if (mockup == null)
                    {
                        continue;
                    }

                    if (string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath))
                    {
                        needToUpdate.Add(mockup.Id);
                    }
                }

                needToUpdate = needToUpdate.Distinct().ToList();

                GridViewMockupResults.HorizontalScrollingOffset = GridViewMockupResults.GetColumnDisplayRectangle(7, false).X;

                if (needToUpdate.Count > 0)
                {
                    afterDownloadMockupTemplate = 1;
                    BackgroundWorkerDownloadMockupTemplates.RunWorkerAsync(needToUpdate);
                    loadingForm.LabelLoadingDescription.Text = "Downloading mockup templates. This will take long time because of big size of files. Please be patient.";
                    try
                    {
                        loadingForm.ShowDialog();
                    }
                    catch (Exception exc)
                    {
                    }
                }
                else
                {
                    BackgroundWorkerCreateMockups.RunWorkerAsync();
                    loadingForm.LabelLoadingDescription.Text = "Creating mockups. This will take long time. Please be patient.";
                    try
                    {
                        loadingForm.ShowDialog();
                    }
                    catch (Exception exc)
                    {
                    }
                }
            }
        }

        private void BackgroundWorkerDownloadMockupTemplates_DoWork(object sender, DoWorkEventArgs e)
        {
            var list = e.Argument as List<string>;
            if (list == null)
            {
                return;
            }

            if (!Directory.Exists("Mockups/Thumbnails/"))
            {
                Directory.CreateDirectory("Mockups/Thumbnails/");
            }
            if (!Directory.Exists("Mockups/"))
            {
                Directory.CreateDirectory("Mockups/");
            }

            foreach (var id in list)
            {
                var mockup = mockupTemplates.FirstOrDefault(x => x.Id == id);

                var outputStream = new FileStream($"Mockups/Thumbnails/{mockup.Id}.jpg", FileMode.Create, FileAccess.Write);
                Common.DownloadFile(string.Format(Mockup.DownloadThumbnailUrl, mockup.Id), outputStream);
                outputStream.Close();
                mockup.ThumbnailPath = Path.GetFullPath($"Mockups/Thumbnails/{mockup.Id}.jpg");
                ListViewItem listViewItem = null;
                if (ListViewMockupTemplates.InvokeRequired)
                {
                    ListViewMockupTemplates.Invoke(
                                                   new MethodInvoker(
                                                                     delegate
                                                                     {
                                                                         // Execute the following code on the GUI thread.
                                                                         listViewItem = ListViewMockupTemplates.Items.Find(mockup.Id, false).FirstOrDefault();
                                                                     }));
                }
                else
                {
                    listViewItem = ListViewMockupTemplates.Items.Find(mockup.Id, false).FirstOrDefault();
                }
                if (listViewItem != null)
                {
                    ImageListMockups.Images[listViewItem.ImageIndex] =
                        PhotoshopHelper.CreateThumbnail(mockup.ThumbnailPath, ImageListMockups.ImageSize.Width, ImageListMockups.ImageSize.Height);
                }

                if (string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath))
                {
                    // Download
                    BackgroundWorkerDownloadMockupTemplates.ReportProgress(0, id);
                    outputStream = new FileStream($"Mockups/{ToSeoFriendly(mockup.Name)}.tips", FileMode.Create, FileAccess.Write);
                    Common.DownloadFile(string.Format(Mockup.DownloadMockupUrl, mockup.Id), outputStream);
                    outputStream.Close();

                    mockup.FilePath = Path.GetFullPath($"Mockups/{ToSeoFriendly(mockup.Name)}.tips");
                    BackgroundWorkerDownloadMockupTemplates.ReportProgress(100, id);
                }
            }

            var fileStream = new FileStream("mockups.txt", FileMode.Create, FileAccess.Write, FileShare.None);
            Mockup.SaveMockupTemplates(fileStream, mockupTemplates);
            fileStream.Close();

            e.Result = list;
        }

        private void BackgroundWorkerDownloadMockupTemplates_ProgressChanged(object sender, ProgressChangedEventArgs e)
        {
            if (e.UserState == null)
            {
                return;
            }

            var item = ListViewMockupTemplates.Items.Find(e.UserState.ToString(), true).FirstOrDefault();
            if (item != null)
            {
                ListViewMockupTemplates.FocusedItem = item;
                item.Selected = true;
                item.EnsureVisible();
                ListViewMockupTemplates.Select();
                item.SubItems[1].Text = e.ProgressPercentage == 0 ? "Downloading" : "Downloaded";
            }
        }

        private void BackgroundWorkerDownloadMockupTemplates_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            loadingForm.LabelLoadingDescription.Text = "Loading resources from platforms. This will take long time. Please be patient.";
            loadingForm.Hide();

            var list = e.Result as List<string>;

            if (list == null || list.Count == 0)
            {
                return;
            }

            if (afterDownloadMockupTemplate == 1)
            {
                // Start creating mockups
                BackgroundWorkerCreateMockups.RunWorkerAsync();
                loadingForm.LabelLoadingDescription.Text = "Creating mockups. This will take long time. Please be patient.";
                try
                {
                    loadingForm.ShowDialog();
                }
                catch (Exception exc)
                {
                }
            }
            else if (afterDownloadMockupTemplate == 2)
            {
                var item = mockupTemplates.FirstOrDefault(x => x.Id == list[0]);
                Preview(item);
            }
            else if (afterDownloadMockupTemplate == 3)
            {
                var facebookForm = new FormPostFacebook()
                                   {
                                       LicenseData = licenseData
                                   };
                foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                {
                    var mockup = mockupTemplates.FirstOrDefault(x => x.Id == row.Cells["MockupTemplateId"].Value.ToString());
                    if (mockup != null)
                    {
                        row.Cells["MockupTemplateFile"].Value = mockup;
                        facebookForm.Designs.Add(row);
                    }
                }
                facebookForm.ShowDialog();
            }
        }

        private void GridViewMockupResults_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            var cell = GridViewMockupResults.Rows[e.RowIndex].Cells[e.ColumnIndex];
            if (cell is DataGridViewButtonCell)
            {
                if (ColorDialogChooser.ShowDialog() == DialogResult.OK)
                {
                    cell.Value = "";
                    cell.Style.BackColor = ColorDialogChooser.Color;
                    cell.Style.SelectionBackColor = ColorDialogChooser.Color;
                }
            }
        }

        private void GridViewMockupResults_MouseMove(object sender, MouseEventArgs e)
        {
            selectedMockupCell = new Point(-1, -1);
            for (var col = 0; col < GridViewMockupResults.Columns.Count; col++)
            {
                var colRectangle = GridViewMockupResults.GetColumnDisplayRectangle(col, true);
                if (colRectangle.Left <= e.X && colRectangle.Right >= e.X)
                {
                    for (var row = 0; row < GridViewMockupResults.Rows.Count; row++)
                    {
                        var cellRectangle = GridViewMockupResults.GetCellDisplayRectangle(col, row, true);
                        if (cellRectangle.Top <= e.Y && cellRectangle.Bottom >= e.Y)
                        {
                            selectedMockupCell = new Point(col, row);
                        }
                    }
                }
            }
        }

        private void BackgroundWorkerCreateMockups_DoWork(object sender, DoWorkEventArgs e)
        {
            foreach (DataGridViewRow row in GridViewMockupResults.Rows)
            {
                var mockup = mockupTemplates.FirstOrDefault(x => x.Id == row.Cells["MockupTemplateId"].Value.ToString());
                if (mockup == null)
                {
                    BackgroundWorkerCreateMockups.ReportProgress(100, new Dictionary<string, object>()
                                                                      {
                                                                          {"Row", row.Index},
                                                                          {"Message", "Cannot load mockup template"}
                                                                      });
                    continue;
                }

                if (string.IsNullOrEmpty(mockup.TempFilePath))
                {
                    mockup.TempFilePath =
                        License.DecodeTipsFile(mockup.FilePath, licenseData["mockup"]["key"].ToObject<string>(), licenseData["mockup"]["iv"].ToObject<string>());
                }
                if (!string.IsNullOrEmpty(mockup.TempFilePath))
                {
                    BackgroundWorkerCreateMockups.ReportProgress(0, new Dictionary<string, object>()
                                                                    {
                                                                        {"Row", row.Index},
                                                                        {"Message", "Creating"}
                                                                    });
                    var designs = row.Cells["DesignFiles"].Value.ToString().Split(new char[] {';'}, StringSplitOptions.RemoveEmptyEntries);
                    try
                    {
                        foreach (var design in designs)
                        {
                            var shirtColorName = row.Cells["ShirtColor"].Style.BackColor.Name;
                            var outputFile = Path.Combine(FolderBrowserDialogMockups.SelectedPath,
                                                          $@"{Path.GetFileNameWithoutExtension(mockup.FilePath)}-{
                                                                  ToSeoFriendly(Path.GetFileNameWithoutExtension(design))
                                                              }-{shirtColorName}.jpg");
                            if (File.Exists(outputFile))
                            {
                                outputFile = Path.Combine(FolderBrowserDialogMockups.SelectedPath,
                                                          $@"{Path.GetFileNameWithoutExtension(mockup.FilePath)}-{
                                                                  ToSeoFriendly(Path.GetFileNameWithoutExtension(design))
                                                              }-{shirtColorName}-{DateTime.Now.ToString("yyyyMMdd-HHmmss")}.jpg");
                            }
                            PhotoshopHelper.CreateMockup(mockup.TempFilePath, design, outputFile,
                                                         row.Cells["DesignBackgroundColor"].Style.BackColor, row.Cells["ShirtColor"].Style.BackColor,
                                                         null, row.Cells["LaceColor"].Style.BackColor, 0, 0,
                                                         row.Cells["HorizontalAlign"].Value as string, row.Cells["VerticalAlign"].Value as string);
                        }
                        BackgroundWorkerCreateMockups.ReportProgress(100, new Dictionary<string, object>()
                                                                          {
                                                                              {"Row", row.Index},
                                                                              {"Message", "Create mockups completely"}
                                                                          });
                    }
                    catch (Exception exc)
                    {
                        mockup.TempFilePath = "";
                        BackgroundWorkerCreateMockups.ReportProgress(100, new Dictionary<string, object>()
                                                                          {
                                                                              {"Row", row.Index},
                                                                              {
                                                                                  "Message",
                                                                                  "Create mockups failed with error: " + exc.Message
                                                                              }
                                                                          });
                    }
                }
                else
                {
                    BackgroundWorkerCreateMockups.ReportProgress(100, new Dictionary<string, object>()
                                                                      {
                                                                          {"Row", row.Index},
                                                                          {
                                                                              "Message",
                                                                              "Mockup template file has wrong format. Please delete old file and download again."
                                                                          }
                                                                      });
                }
            }
        }

        private void BackgroundWorkerCreateMockups_ProgressChanged(object sender, ProgressChangedEventArgs e)
        {
            var state = e.UserState as Dictionary<string, object>;
            if (state != null)
            {
                var row = state["Row"];
                if (row == null)
                {
                    return;
                }
                if (e.ProgressPercentage == 0)
                {
                    GridViewMockupResults.Rows[(int) row].Cells["Status"].Value = "Creating";
                }
                else
                {
                    GridViewMockupResults.Rows[(int) row].Cells["Status"].Value = (state["Message"] as string);
                }
            }
        }

        private void BackgroundWorkerCreateMockups_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            loadingForm.LabelLoadingDescription.Text = "Loading resources from platforms. This will take long time. Please be patient.";
            loadingForm.Hide();
        }

        private int Preview(MockupTemplate item, int designIndex = 0)
        {
            if (item != null)
            {
                var row = GridViewMockupResults.CurrentRow;
                if (row == null)
                {
                    return designIndex;
                }

                if (string.IsNullOrEmpty(item.TempFilePath))
                {
                    item.TempFilePath =
                        License.DecodeTipsFile(item.FilePath, licenseData["mockup"]["key"].ToObject<string>(), licenseData["mockup"]["iv"].ToObject<string>());
                }
                if (!string.IsNullOrEmpty(item.TempFilePath))
                {
                    var designs = row.Cells["DesignFiles"].Value.ToString().Split(new char[] {';'}, StringSplitOptions.RemoveEmptyEntries);
                    if (designs.Length > 0)
                    {
                        if (designIndex < 0 || designIndex >= designs.Length)
                        {
                            designIndex = 0;
                        }
                        PictureBoxPreview.Image = null;
                        PictureBoxPreview.Cursor = Cursors.WaitCursor;
                        var backgroundWorker = new BackgroundWorker();
                        backgroundWorker.DoWork += (object sender, DoWorkEventArgs e) =>
                                                   {
                                                       var outputFile = Path.GetTempFileName() + ".jpg";
                                                       try
                                                       {
                                                           PhotoshopHelper.CreateMockup(item.TempFilePath, designs[designIndex], outputFile,
                                                                                        row.Cells["DesignBackgroundColor"].Style.BackColor,
                                                                                        row.Cells["ShirtColor"].Style.BackColor,
                                                                                        null, row.Cells["LaceColor"].Style.BackColor, 0, 0,
                                                                                        row.Cells["HorizontalAlign"].Value as string,
                                                                                        row.Cells["VerticalAlign"].Value as string);
                                                           e.Result = outputFile;
                                                       }
                                                       catch (Exception exc)
                                                       {
                                                           item.TempFilePath = "";
                                                           MessageBox.Show($"{exc.Message}. Please remove file and re-download file.", "Auto Upload",
                                                                           MessageBoxButtons.OK, MessageBoxIcon.Error);
                                                       }
                                                   };
                        backgroundWorker.RunWorkerCompleted += (object sender, RunWorkerCompletedEventArgs e) =>
                                                               {
                                                                   PictureBoxPreview.Cursor = Cursors.Default;
                                                                   if (e.Result != null)
                                                                   {
                                                                       PictureBoxPreview.Image = Image.FromFile(e.Result.ToString());
                                                                   }
                                                               };
                        backgroundWorker.RunWorkerAsync();
                    }
                }
            }

            return designIndex;
        }

        private void ButtonPreviewMockup_Click(object sender, EventArgs e)
        {
            var row = GridViewMockupResults.CurrentRow;
            if (row == null)
            {
                return;
            }

            // Check if this mockup template is downloaded
            var id = row.Cells["MockupTemplateId"].Value.ToString();
            var mockup = mockupTemplates.FirstOrDefault(x => x.Id == id);
            if (mockup == null)
            {
                return;
            }

            ButtonPreviewMockup.Tag = id;
            ButtonNextDesign.Tag = 0;
            if (string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath))
            {
                // Download
                afterDownloadMockupTemplate = 2;
                BackgroundWorkerDownloadMockupTemplates.RunWorkerAsync(new List<string> {id});
                loadingForm.LabelLoadingDescription.Text =
                    "Downloading mockup templates for preview. This will take long time because of big size of file. Please be patient.";
                try
                {
                    loadingForm.ShowDialog();
                }
                catch (Exception exc)
                {
                }
            }
            else
            {
                Preview(mockup);
            }
        }

        private void ButtonPreviousDesign_Click(object sender, EventArgs e)
        {
            var prevRow = GridViewMockupResults.CurrentCell.RowIndex - 1;
            if (prevRow < 0)
            {
                prevRow = GridViewMockupResults.Rows.Count - 1;
            }
            GridViewMockupResults.CurrentCell = GridViewMockupResults.Rows[prevRow].Cells[GridViewMockupResults.CurrentCell.ColumnIndex];
            ButtonPreviewMockup.PerformClick();
        }

        private void ButtonNextDesign_Click(object sender, EventArgs e)
        {
            var nextRow = GridViewMockupResults.CurrentCell.RowIndex + 1;
            if (nextRow >= GridViewMockupResults.Rows.Count)
            {
                nextRow = 0;
            }
            GridViewMockupResults.CurrentCell = GridViewMockupResults.Rows[nextRow].Cells[GridViewMockupResults.CurrentCell.ColumnIndex];
            ButtonPreviewMockup.PerformClick();
        }

        private void AddDesignMockup(string designFile, string horizontalAlign = "Center", string verticalAlign = "Middle", params string[] otherParameters)
        {
            if (ListViewDesigns.Items.Find(designFile, true).Length > 0)
            {
                return;
            }

            ImageListDesigns.Images.Add(PhotoshopHelper.CreateThumbnail(designFile, ImageListDesigns.ImageSize.Width, ImageListDesigns.ImageSize.Height));
            var item = ListViewDesigns.Items.Add(designFile, Path.GetFileNameWithoutExtension(designFile), ImageListDesigns.Images.Count - 1);
            item.SubItems.Add(horizontalAlign);
            item.SubItems.Add(verticalAlign);
            if (otherParameters != null)
            {
                foreach (var parameter in otherParameters)
                {
                    item.SubItems.Add(parameter);
                }
            }
        }

        private void ToolStripMenuItemRedownloadTemplate_Click(object sender, EventArgs e)
        {
            if (ListViewMockupTemplates.SelectedItems.Count == 0)
            {
                return;
            }

            var item = ListViewMockupTemplates.SelectedItems[0];
            var mockup = mockupTemplates.FirstOrDefault(x => x.Id == item.Name);
            mockup.FilePath = "";
            afterDownloadMockupTemplate = 0;
            BackgroundWorkerDownloadMockupTemplates.RunWorkerAsync(new List<string>() {mockup.Id});
            loadingForm.LabelLoadingDescription.Text = "Downloading mockup templates. This will take long time because of big size of files. Please be patient.";
            try
            {
                loadingForm.ShowDialog();
            }
            catch (Exception exc)
            {
            }
        }

        private void ToolStripMenuItemClearColor_Click(object sender, EventArgs e)
        {
            if (selectedMockupCell.Y >= 0 && selectedMockupCell.Y < GridViewMockupResults.Rows.Count &&
                selectedMockupCell.X >= 0 && selectedMockupCell.X < GridViewMockupResults.Columns.Count)
            {
                var cell = GridViewMockupResults.Rows[selectedMockupCell.Y].Cells[selectedMockupCell.X];
                if (cell is DataGridViewButtonCell)
                {
                    cell.Value = "No color";
                    cell.Style.BackColor = new Color();
                    cell.Style.SelectionBackColor = Color.White;
                }
            }
        }

        public void ToolStripMenuItemCopyColorToSameDesign_Click(object sender, EventArgs e)
        {
            if (selectedMockupCell.Y >= 0 && selectedMockupCell.Y < GridViewMockupResults.Rows.Count &&
                selectedMockupCell.X >= 0 && selectedMockupCell.X < GridViewMockupResults.Columns.Count)
            {
                var designs = GridViewMockupResults.Rows[selectedMockupCell.Y].Cells["DesignFiles"].Value.ToString().ToLower();
                var cell = GridViewMockupResults.Rows[selectedMockupCell.Y].Cells[selectedMockupCell.X];
                if (cell is DataGridViewButtonCell)
                {
                    var color = cell.Style.BackColor;
                    foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                    {
                        if (row.Cells["DesignFiles"].Value.ToString().ToLower() == designs)
                        {
                            row.Cells[selectedMockupCell.X].Value = cell.Value;
                            row.Cells[selectedMockupCell.X].Style.BackColor = color;
                            row.Cells[selectedMockupCell.X].Style.SelectionBackColor = color;
                        }
                    }
                }
                else if (cell is DataGridViewComboBoxCell)
                {
                    var value = cell.Value;
                    foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                    {
                        if (row.Cells["DesignFiles"].Value.ToString().ToLower() == designs)
                        {
                            row.Cells[selectedMockupCell.X].Value = value;
                        }
                    }
                }
            }
        }

        public void ToolStripMenuItemCopyColorToAllDesigns_Click(object sender, EventArgs e)
        {
            if (selectedMockupCell.Y >= 0 && selectedMockupCell.Y < GridViewMockupResults.Rows.Count &&
                selectedMockupCell.X >= 0 && selectedMockupCell.X < GridViewMockupResults.Columns.Count)
            {
                var cell = GridViewMockupResults.Rows[selectedMockupCell.Y].Cells[selectedMockupCell.X];
                if (cell is DataGridViewButtonCell)
                {
                    var color = cell.Style.BackColor;
                    foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                    {
                        row.Cells[selectedMockupCell.X].Value = cell.Value;
                        row.Cells[selectedMockupCell.X].Style.BackColor = color;
                        row.Cells[selectedMockupCell.X].Style.SelectionBackColor = color;
                    }
                }
                else if (cell is DataGridViewComboBoxCell)
                {
                    var value = cell.Value;
                    foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                    {
                        row.Cells[selectedMockupCell.X].Value = value;
                    }
                }
            }
        }

        private void ButtonPostToFacebook_Click(object sender, EventArgs e)
        {
            if (GridViewMockupResults.Rows.Count == 0)
            {
                return;
            }

            // Check if need to download
            var needToUpdate = new List<string>();
            foreach (DataGridViewRow row in GridViewMockupResults.Rows)
            {
                row.Cells["Status"].Value = "";
                var id = row.Cells["MockupTemplateId"].Value.ToString();
                var mockup = mockupTemplates.FirstOrDefault(x => x.Id == id);
                if (mockup == null)
                {
                    continue;
                }

                if (string.IsNullOrEmpty(mockup.FilePath) || !File.Exists(mockup.FilePath))
                {
                    needToUpdate.Add(mockup.Id);
                }
            }

            needToUpdate = needToUpdate.Distinct().ToList();

            GridViewMockupResults.HorizontalScrollingOffset = GridViewMockupResults.GetColumnDisplayRectangle(7, false).X;

            if (needToUpdate.Count > 0)
            {
                afterDownloadMockupTemplate = 3;
                BackgroundWorkerDownloadMockupTemplates.RunWorkerAsync(needToUpdate);
                loadingForm.LabelLoadingDescription.Text = "Downloading mockup templates. This will take long time because of big size of files. Please be patient.";
                try
                {
                    loadingForm.ShowDialog();
                }
                catch (Exception exc)
                {
                }
            }
            else
            {
                var facebookForm = new FormPostFacebook()
                                   {
                                       LicenseData = licenseData
                                   };
                foreach (DataGridViewRow row in GridViewMockupResults.Rows)
                {
                    var mockup = mockupTemplates.FirstOrDefault(x => x.Id == row.Cells["MockupTemplateId"].Value.ToString());
                    if (mockup != null)
                    {
                        row.Cells["MockupTemplateFile"].Value = mockup;
                        facebookForm.Designs.Add(row);
                    }
                }
                facebookForm.ShowDialog();
            }
        }

#endif

        #endregion
    }
}
